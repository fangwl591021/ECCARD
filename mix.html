<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··åˆå¤šé ç®¡ç† - Mixer Pro</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        .sidebar-container { background-color: #1e2124; height: 100vh; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; overflow: hidden; }
        .w-expanded { width: 256px; }
        .w-collapsed { width: 80px; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        .chat-room-bg { background-color: #7988a0; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 40px 10px; }
        .carousel-preview-container { display: flex; gap: 15px; padding: 20px; width: 100%; overflow-x: auto; scroll-snap-type: x mandatory; }
        .preview-bubble { flex: 0 0 280px; scroll-snap-align: center; background: white; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: flex; flex-direction: column; position: relative; min-height: 480px; }
        .flex-badge-preview { position: absolute; top: 10px; color: white; padding: 7px 20px; border-radius: 30px; font-size: 11px; font-weight: bold; z-index: 20; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; white-space: nowrap; width: auto; line-height: 1; }
        .badge-right { right: 10px; }
        .badge-left { left: 10px; }
        .header-box { padding: 10px; display: flex; align-items: center; gap: 8px; }
        .hero-box { position: relative; background: #000; width: 100%; aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; padding: 5px; }
        .grid-item { padding: 8px; border-radius: 8px; text-align: center; }
        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .sidebar-link-text { transition: opacity 0.2s; white-space: nowrap; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <aside :class="isSidebarCollapsed ? 'w-collapsed' : 'w-expanded'" class="sidebar-container text-gray-400 shadow-2xl">
        <div class="h-16 flex items-center border-b border-gray-700 shrink-0 overflow-hidden" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'">
            <i class="fab fa-line text-3xl line-green"></i>
            <span v-if="!isSidebarCollapsed" class="ml-4 text-white font-bold uppercase font-mono tracking-tighter sidebar-link-text">Mixer Pro</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <a href="index.html" class="flex items-center py-4 hover:bg-gray-700 transition-all text-gray-400" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas fa-file-alt w-8 text-center text-lg"></i><span v-if="!isSidebarCollapsed" class="ml-2 font-medium sidebar-link-text">æ¨™æº–ç‰ˆæ’ä»¶é–‹ç™¼</span></a>
            <a href="card.html" class="flex items-center py-4 hover:bg-gray-700 transition-all text-gray-400" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas fa-id-card w-8 text-center text-lg"></i><span v-if="!isSidebarCollapsed" class="ml-2 font-medium sidebar-link-text">å•†å‹™å‹åç‰‡é–‹ç™¼</span></a>
            <a href="ec.html" class="flex items-center py-4 hover:bg-gray-700 transition-all text-gray-400" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas fa-shopping-cart w-8 text-center text-lg"></i><span v-if="!isSidebarCollapsed" class="ml-2 font-medium sidebar-link-text">é›»å•†æ’ä»¶é–‹ç™¼</span></a>
            <div class="sidebar-item-active flex items-center py-4 transition-all" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas fa-clone w-8 text-center text-lg"></i><span v-if="!isSidebarCollapsed" class="ml-2 font-medium sidebar-link-text">æ··åˆå¤šé é–‹ç™¼</span></div>
            <a href="project.html" class="flex items-center py-4 hover:bg-gray-700 transition-all text-gray-400 mt-4 border-t border-gray-800" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas fa-box w-8 text-center text-lg"></i><span v-if="!isSidebarCollapsed" class="ml-2 font-medium sidebar-link-text">å°ˆæ¡ˆç®¡ç†ç³»çµ±</span></a>
        </nav>
        <button @click="isSidebarCollapsed = !isSidebarCollapsed" class="p-4 w-full flex items-center border-t border-gray-700 hover:text-white bg-gray-900/30" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'"><i class="fas" :class="isSidebarCollapsed ? 'fa-indent text-xl' : 'fa-outdent text-lg'"></i><span v-if="!isSidebarCollapsed" class="ml-3 text-xs font-bold uppercase tracking-widest">æ”¶åˆé¸å–®</span></button>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">å¤šé æ··åˆé–‹ç™¼ç®¡ç† <span class="px-2 py-0.5 bg-green-100 text-green-600 text-[10px] rounded uppercase font-bold tracking-widest">Mixer Pro</span></h2>
            <div class="flex items-center gap-4">
                <button @click="showSaveModal = true" class="px-5 py-2 border border-line-green text-line-green rounded-xl text-sm font-bold hover:bg-green-50 flex items-center gap-2 transition-all"><i class="fas fa-cloud-upload-alt"></i> å„²å­˜å°ˆæ¡ˆ</button>
                <button @click="pushMix" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-blue-600 flex items-center gap-2 transition-all"><i class="fas fa-paper-plane"></i> ğŸš€ å¤šé æ¨æ’­</button>
            </div>
        </header>

        <div class="flex-grow flex overflow-hidden">
            <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
                <div class="max-w-4xl mx-auto space-y-8 pb-20">
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 mb-8 shadow-sm">
                        <label class="input-label text-blue-800">èŠå¤©å®¤é€šçŸ¥æ–‡å­— (altText)</label>
                        <input type="text" v-model="carousel.altText" class="w-full px-4 py-2 border rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-200">
                    </div>

                    <div class="flex items-center gap-2 mb-8 overflow-x-auto pb-4 no-scrollbar border-b">
                        <div v-for="(bubble, index) in carousel.bubbles" :key="bubble.id" class="relative group shrink-0 flex flex-col items-center gap-1">
                            <button @click="activeIndex = index" :class="activeIndex === index ? 'bg-line-green text-white shadow-md' : 'bg-gray-100 text-gray-500'" class="w-32 py-2 rounded-xl text-xs font-bold truncate px-3 transition-all">{{ index + 1 }}. {{ getTypeName(bubble.type) }}</button>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button @click.stop="moveLeft(index)" v-if="index > 0" class="w-5 h-5 bg-white border rounded text-[8px] shadow-sm"><i class="fas fa-chevron-left"></i></button>
                                <button @click.stop="removeBubble(index)" v-if="carousel.bubbles.length > 1" class="w-5 h-5 bg-red-100 text-red-500 border border-red-200 rounded text-[8px] shadow-sm"><i class="fas fa-trash"></i></button>
                                <button @click.stop="moveRight(index)" v-if="index < carousel.bubbles.length - 1" class="w-5 h-5 bg-white border rounded text-[8px] shadow-sm"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <button @click="showAddModal = true" class="flex items-center gap-2 px-4 h-10 border-2 border-dashed border-line-green text-line-green bg-green-50 rounded-xl hover:bg-line-green hover:text-white transition-all shrink-0 shadow-sm self-start">
                            <i class="fas fa-plus-circle"></i><span class="text-xs font-bold">æ–°å¢åˆ†é </span>
                        </button>
                    </div>

                    <div v-if="activeBubble" class="space-y-8 animate-in fade-in duration-300">
                        <div class="flex items-center justify-between border-b pb-4">
                            <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2"><i :class="getTypeIcon(activeBubble.type)" class="text-line-green"></i> åˆ†é  {{ activeIndex + 1 }}ï¼š{{ getTypeName(activeBubble.type) }}</h3>
                            <div class="flex items-center gap-2 bg-white p-1 rounded-lg border border-slate-200 px-3 shadow-sm"><span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Footer èƒŒæ™¯</span><input type="color" v-model="activeBubble.footerBgColor"></div>
                        </div>

                        <!-- 1. æ¨™æº–ç‰ˆå‹æ¨¡çµ„ (ç§»æ¤ç¤¾ç¾¤æŒ‰éˆ•) -->
                        <div v-if="activeBubble.type === 'standard'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                                <div><label class="input-label">ä¸»åœ–é€£çµ (æ”¯æ´å‹•ç•«)</label><input type="text" v-model="activeBubble.imageUrl" class="w-full px-4 py-2 border rounded-xl text-sm shadow-sm focus:ring-1 focus:ring-line-green outline-none"></div>
                                <div class="bg-white/50 p-4 rounded-lg border border-dashed space-y-4">
                                    <label class="text-xs font-bold text-gray-600 flex items-center gap-2 cursor-pointer"><input type="checkbox" v-model="activeBubble.showBadge" class="accent-line-green"> é¡¯ç¤ºæ¨™ç±¤</label>
                                    <div v-if="activeBubble.showBadge" class="grid grid-cols-2 gap-3 pl-6 animate-in slide-in-from-top-2">
                                        <input type="text" v-model="activeBubble.badgeText" maxlength="10" class="border rounded p-1.5 text-xs" placeholder="æ–‡å­—"><input type="color" v-model="activeBubble.badgeColor" class="w-full h-8">
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <input type="text" v-model="activeBubble.title" maxlength="30" class="w-full px-4 py-2 border rounded-xl text-sm font-bold shadow-sm" placeholder="æ¨™é¡Œ">
                                    <textarea v-model="activeBubble.subtitle" rows="6" class="w-full px-4 py-2 border rounded-xl text-sm shadow-sm" placeholder="æè¿°å…§å®¹..."></textarea>
                                </div>
                                <!-- ç§»æ¤ï¼šç¤¾ç¾¤æŒ‰éˆ•è¨­å®š -->
                                <div class="border-t pt-4">
                                    <label class="flex items-center gap-2 cursor-pointer mb-3"><input type="checkbox" v-model="activeBubble.social.enabled" class="accent-line-green"><span class="text-xs font-bold text-gray-600">å•Ÿç”¨ç¤¾ç¾¤æŒ‰éˆ•åˆ—</span></label>
                                    <div v-if="activeBubble.social.enabled" class="grid grid-cols-2 gap-3 animate-in fade-in">
                                        <div v-for="(val, key) in socialTypes" :key="key" class="p-2 bg-white border rounded-xl flex items-center gap-2">
                                            <div :style="{ backgroundColor: val.color }" class="w-6 h-6 rounded flex items-center justify-center text-white text-[10px]"><i :class="val.icon"></i></div>
                                            <input type="text" v-model="activeBubble.social.links[key]" class="flex-1 text-[10px] outline-none" :placeholder="val.label">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. å•†å‹™å‹åç‰‡æ¨¡çµ„ -->
                        <div v-if="activeBubble.type === 'card'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-6">
                                <h4 class="text-sm font-bold text-gray-700 flex items-center gap-2"><i class="fas fa-id-card text-line-green"></i> å“ç‰Œèº«ä»½èˆ‡ Header é…è‰²</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <input type="text" v-model="activeBubble.headerName" placeholder="å§“å" class="w-full border rounded p-2 text-sm shadow-sm">
                                    <input type="text" v-model="activeBubble.headerDescription" maxlength="50" placeholder="è·ç¨± (50å­—)" class="w-full border rounded p-2 text-sm shadow-sm">
                                    <input type="text" v-model="activeBubble.headerImg" placeholder="é ­åƒç¶²å€" class="col-span-2 w-full border rounded p-2 text-sm">
                                    <div class="flex items-center gap-2"><span class="text-[9px]">Headeråº•è‰²</span><input type="color" v-model="activeBubble.headerBgColor" class="w-full"></div>
                                    <div class="flex items-center gap-2"><span class="text-[9px]">æ–‡å­—é¡è‰²</span><input type="color" v-model="activeBubble.headerTextColor" class="w-full"></div>
                                    <input type="text" v-model="activeBubble.imageUrl" placeholder="å½¢è±¡ä¸»åœ–é€£çµ" class="col-span-2 w-full border rounded p-2 text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- 3. é›»å•†å•†åŸå‹ -->
                        <div v-if="activeBubble.type === 'ecommerce'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                                <h4 class="text-sm font-bold">é›»å•†å•†å“ç¶²æ ¼</h4>
                                <div class="grid grid-cols-2 gap-4 border-b pb-4">
                                    <input type="text" v-model="activeBubble.imageUrl" placeholder="é ‚éƒ¨ Hero åœ–ç‰‡" class="w-full border rounded p-2 text-xs">
                                    <div class="flex items-center gap-2"><span class="text-[9px]">èƒŒæ™¯è‰²</span><input type="color" v-model="activeBubble.bgColor" class="w-full"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div v-for="(item, idx) in activeBubble.items" :key="idx" class="p-2 bg-white border rounded-xl flex items-center gap-2 relative shadow-sm group">
                                        <img :src="item.img" class="w-8 h-8 rounded border object-cover">
                                        <input v-model="item.title" class="flex-1 text-[10px] font-bold border-b" placeholder="å“å">
                                        <button @click.stop="activeBubble.items.splice(idx,1)" class="text-red-400 absolute top-1 right-1 opacity-0 group-hover:opacity-100 text-[10px]"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-sm font-bold text-gray-700">åˆ†é åº•éƒ¨æŒ‰éˆ• (å…¨å¯¬æ’åˆ—)</h4>
                                <button @click.stop="activeBubble.buttons.push({label:'æŒ‰éˆ•',uri:'https://line.me',color:'#00B900'})" class="text-xs text-line-green font-bold hover:underline">+ æ–°å¢æŒ‰éˆ•</button>
                            </div>
                            <div class="space-y-3">
                                <div v-for="(btn, idx) in activeBubble.buttons" :key="idx" class="flex gap-3 items-center bg-white p-4 rounded-xl border shadow-sm group hover:border-line-green transition-all">
                                    <input type="color" v-model="btn.color" class="shrink-0"><input type="text" v-model="btn.label" class="w-32 border-b p-1 text-sm font-bold" placeholder="æ–‡å­—"><input type="text" v-model="btn.uri" class="flex-1 border-b p-1 text-sm text-gray-400" placeholder="é€£çµ">
                                    <button @click.stop="activeBubble.buttons.splice(idx,1)" class="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-[420px] shrink-0 bg-slate-100 relative flex flex-col shadow-inner overflow-hidden">
                <div class="chat-room-bg no-scrollbar">
                    <div class="carousel-preview-container no-scrollbar">
                        <div v-for="bubble in carousel.bubbles" :key="bubble.id" class="preview-bubble animate-in zoom-in duration-300">
                            <!-- 1. æ¨™æº–ç‰ˆå‹é è¦½ -->
                            <template v-if="bubble.type === 'standard'">
                                <div class="relative w-full shrink-0 overflow-hidden"><img :src="bubble.imageUrl" class="w-full aspect-[20/13] object-cover" onerror="this.src='https://lihi.cc/mwMvo'"><div v-if="bubble.showBadge" class="flex-badge-preview" :class="bubble.badgeAlign==='left'?'badge-left':'badge-right'" :style="{ backgroundColor: bubble.badgeColor }">{{ bubble.badgeText || 'åˆ†äº«' }}</div></div>
                                <div class="p-3 text-center">
                                    <div class="text-base font-bold truncate mt-1">{{ bubble.title || 'æ¨™é¡Œ' }}</div>
                                    <div class="text-[10px] text-gray-500 mt-2 h-12 overflow-hidden leading-tight text-left px-2">{{ bubble.subtitle }}</div>
                                </div>
                            </template>
                            <!-- 2. å•†å‹™å‹é è¦½ -->
                            <template v-else-if="bubble.type === 'card'">
                                <div class="header-box" :style="{ backgroundColor: bubble.headerBgColor }"><img :src="bubble.headerImg" class="w-10 h-10 rounded-full object-cover border border-white/20"><div class="flex flex-col overflow-hidden"><span class="text-[11px] font-bold" :style="{ color: bubble.headerTextColor }">{{ bubble.headerName || 'å§“å' }}</span><span class="text-[8px] truncate" :style="{ color: bubble.headerTextColor, opacity: 0.8 }">{{ bubble.headerDescription }}</span></div></div>
                                <img :src="bubble.imageUrl" class="w-full aspect-video object-cover shrink-0 opacity-80">
                                <div class="grid-box flex-grow" :style="{ backgroundColor: bubble.headerBgColor, padding: '5px !important' }">
                                    <div v-for="grid in bubble.gridButtons" class="grid-item text-[8px] text-gray-300 shadow-sm flex flex-col items-center justify-center transition-all" :style="{ backgroundColor: bubble.gridBgColor }"><div class="text-lg">{{grid.emoji}}</div><div class="truncate w-full uppercase font-bold">{{grid.label}}</div></div>
                                </div>
                            </template>
                            <!-- 3. é›»å•†å‹é è¦½ -->
                            <template v-else-if="bubble.type === 'ecommerce'">
                                <img :src="bubble.imageUrl" class="w-full aspect-video object-cover shrink-0">
                                <div class="p-[5px] flex-grow" :style="{ backgroundColor: bubble.bgColor }">
                                    <div class="grid grid-cols-3 gap-[5px]"><div v-for="item in bubble.items" class="bg-white rounded-sm overflow-hidden shadow-sm flex flex-col"><img :src="item.img" class="w-full aspect-square object-cover"><div class="bg-black text-white text-[5px] font-bold py-0.5 text-center truncate">{{item.title}}</div></div></div>
                                </div>
                            </template>
                            
                            <!-- Footer é è¦½ (ç§»æ¤ç¤¾ç¾¤åˆ—) -->
                            <div class="space-y-2 mt-auto" :style="{ backgroundColor: bubble.footerBgColor, padding: '5px !important' }">
                                <div v-if="bubble.type === 'standard' && bubble.social.enabled" class="flex justify-center gap-3 py-1">
                                    <template v-for="(val, key) in socialTypes">
                                        <div v-if="bubble.social.links[key]" :style="{ backgroundColor: val.color }" class="w-8 h-8 rounded-lg flex items-center justify-center text-white text-[10px] shadow-sm font-bold">
                                            <span v-if="key==='fb'">f</span><span v-else-if="key==='ig'">IG</span><i v-else-if="key==='tel'" class="fas fa-phone-alt scale-75"></i><i v-else-if="key==='web'" class="fas fa-globe scale-75"></i><span v-else>L</span>
                                        </div>
                                    </template>
                                </div>
                                <div class="space-y-1">
                                    <button v-for="btn in bubble.buttons" :style="{ backgroundColor: btn.color }" class="w-full py-1.5 text-white text-[10px] font-bold rounded shadow-sm transition-all active:scale-95">{{ btn.label || 'æŸ¥çœ‹è©³æƒ…' }}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div v-if="showAddModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] backdrop-blur-sm animate-in fade-in duration-200">
        <div class="bg-white rounded-[32px] p-8 max-w-sm w-full shadow-2xl">
            <h3 class="text-xl font-bold mb-6 text-center text-gray-800 tracking-tighter">æ–°å¢åˆ†é æ¨¡çµ„</h3>
            <div class="grid grid-cols-1 gap-3">
                <button @click="addNewBubble('standard')" class="p-4 border-2 rounded-2xl hover:border-line-green hover:bg-green-50 text-left transition-all flex items-center gap-4 group"><i class="fas fa-file-alt text-2xl text-gray-400 group-hover:text-line-green"></i><div class="font-bold text-gray-700 tracking-wide">æ¨™æº–åœ–æ–‡ç‰ˆå‹</div></button>
                <button @click="addNewBubble('card')" class="p-4 border-2 rounded-2xl hover:border-line-green hover:bg-green-50 text-left transition-all flex items-center gap-4 group"><i class="fas fa-id-card text-2xl text-gray-400 group-hover:text-line-green"></i><div class="font-bold text-gray-700 tracking-wide">å•†å‹™å‹åç‰‡ç‰ˆå‹</div></button>
                <button @click="addNewBubble('ecommerce')" class="p-4 border-2 rounded-2xl hover:border-line-green hover:bg-green-50 text-left transition-all flex items-center gap-4 group"><i class="fas fa-shopping-cart text-2xl text-gray-400 group-hover:text-line-green"></i><div class="font-bold text-gray-700 tracking-wide">é›»å•†å•†å“ç¶²æ ¼ç‰ˆå‹</div></button>
            </div>
            <button @click="showAddModal = false" class="w-full mt-8 py-2 text-gray-400 font-bold hover:text-gray-600 text-xs tracking-widest uppercase">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;
const workerUrl = "https://lineoa.fangwl591021.workers.dev";
const forceHttps = (u) => { if (!u || String(u).trim() === "" || u === "#") return "https://line.me"; let url = String(u).trim(); if (url.startsWith("http://")) return url.replace("http://", "https://"); return (url.startsWith("https://") || url.startsWith("line://")) ? url : "https://" + url; };

createApp({
    setup() {
        const isSidebarCollapsed = ref(false);
        const activeIndex = ref(0);
        const showAddModal = ref(false);
        const showSaveModal = ref(false);
        const isSaving = ref(false);
        const projectName = ref('');
        const isLoggedIn = ref(false);
        const userProfile = ref({ userId: '', displayName: '', pictureUrl: '' });

        const socialTypes = {
            fb: { label: 'Facebook', icon: 'fab fa-facebook-f', color: '#1877F2', symbol: 'f' },
            ig: { label: 'Instagram', icon: 'fab fa-instagram', color: '#E4405F', symbol: 'IG' },
            tel: { label: 'TEL é›»è©±', icon: 'fas fa-phone-alt', color: '#34A853', symbol: 'ğŸ“' },
            web: { label: 'WEB å®˜ç¶²', icon: 'fas fa-globe', color: '#555555', symbol: 'ğŸŒ' },
            line: { label: 'LINE å¥½å‹', icon: 'fab fa-line', color: '#00B900', symbol: 'L' }
        };

        const carousel = ref({ altText: 'ç²¾é¸å¤šé æ¨è–¦', bubbles: [{ id: Date.now(), type: 'standard', imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/781206b661aebf645c633e618db3960b.png', title: 'æ¨™æº–ç‰ˆåˆ†é ', subtitle: 'å…§å®¹æè¿°æ–‡å­—...', showBadge: true, badgeText: 'åˆ†äº«', badgeColor: '#FF0000', badgeAlign: 'right', badgeUri: 'https://line.me', footerBgColor: '#FFFFFF', social: { enabled: false, links: { fb: '', ig: '', tel: '', web: '', line: '' } }, buttons: [{ label: 'äº†è§£æ›´å¤š', uri: 'https://line.me', color: '#00B900' }] }] });
        const activeBubble = computed(() => carousel.value.bubbles[activeIndex.value] || null);
        
        const addNewBubble = (type) => {
            const b = { id: Date.now(), type, footerBgColor: '#FFFFFF', buttons: [{ label: 'æŸ¥çœ‹è©³æƒ…', uri: 'https://line.me', color: '#00B900' }] };
            if (type === 'standard') { Object.assign(b, { imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/781206b661aebf645c633e618db3960b.png', title: 'æ–°æ¨™æº–åˆ†é ', subtitle: 'æè¿°æ–‡å­—...', showBadge: true, badgeText: 'HOT', badgeColor: '#FF0000', badgeAlign: 'right', social: { enabled: false, links: { fb: '', ig: '', tel: '', web: '', line: '' } } }); } 
            else if (type === 'card') { Object.assign(b, { imageUrl: 'https://lihi.cc/mwMvo', headerName: 'å•†å‹™ç²¾è‹±', headerDescription: 'å°ˆæ¥­ç³»çµ±é–‹ç™¼', headerImg: 'https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png', headerBgColor: '#1A1B1E', headerTextColor: '#D4AF37', gridBgColor: '#2A2C31', gridButtons: [{emoji:'ğŸ¤–',label:'AI',uri:'https://line.me'},{emoji:'ğŸ¥',label:'å½±',uri:'https://line.me'},{emoji:'ğŸ§¾',label:'å–®',uri:'https://line.me'},{emoji:'ğŸ“',label:'åœ–',uri:'https://line.me'}] }); } 
            else if (type === 'ecommerce') { Object.assign(b, { imageUrl: 'https://lihi.cc/5OXMZ', bgColor: '#F8F8F8', columns: 3, items: [{ title: 'å•†å“A', img: 'https://lihi.cc/mwMvo', url: 'https://line.me' }, { title: 'å•†å“B', img: 'https://lihi.cc/2Nu8G', url: 'https://line.me' }, { title: 'å•†å“C', img: 'https://lihi.cc/mwMvo', url: 'https://line.me' }] }); }
            carousel.value.bubbles.push(b);
            activeIndex.value = carousel.value.bubbles.length - 1;
            showAddModal.value = false;
        };

        const fullFlexJson = computed(() => {
            const contents = carousel.value.bubbles.map(b => {
                const bubble = { type: "bubble", size: "mega" };
                if (b.type === 'standard') {
                    const bodyContents = [{ type: "image", url: forceHttps(b.imageUrl), size: "full", aspectRatio: "20:13", aspectMode: "cover", animated: true }, { type: "box", layout: "vertical", paddingAll: "5px", contents: [{ type: "text", text: b.title || "æ¨™é¡Œ", weight: "bold", size: "xl", align: "center", wrap: true }, { type: "text", text: b.subtitle || "æè¿°", size: "xs", margin: "sm", color: "#666666", wrap: true }] }];
                    if (b.showBadge) { const badge = { type: "box", layout: "vertical", position: "absolute", backgroundColor: b.badgeColor, cornerRadius: "xl", paddingTop: "7px", paddingBottom: "7px", paddingStart: "20px", paddingEnd: "20px", offsetTop: "10px", action: { type: "uri", label: "badge", uri: forceHttps(b.badgeUri) }, contents: [{ type: "text", text: b.badgeText || "åˆ†äº«", color: "#ffffff", size: "10px", weight: "bold" }] }; if (b.badgeAlign === 'left') badge.offsetStart = "10px"; else badge.offsetEnd = "10px"; bodyContents.push(badge); }
                    bubble.body = { type: "box", layout: "vertical", paddingAll: "0px", contents: bodyContents };
                } else if (b.type === 'card') {
                    bubble.header = { type: "box", layout: "horizontal", paddingAll: "8px", backgroundColor: b.headerBgColor, contents: [{ type: "image", url: forceHttps(b.headerImg), size: "xs", aspectRatio: "1:1", aspectMode: "cover", gravity: "center" }, { type: "box", layout: "vertical", flex: 3, margin: "md", contents: [{ type: "text", text: b.headerName || "å§“å", weight: "bold", color: b.headerTextColor, size: "lg" }, { type: "text", text: b.headerDescription || "æ•˜è¿°", size: "xs", color: b.headerTextColor, wrap: true }] }] };
                    bubble.hero = { type: "image", url: forceHttps(b.imageUrl), size: "full", aspectRatio: "16:9", aspectMode: "cover" };
                    bubble.body = { type: "box", layout: "vertical", backgroundColor: b.headerBgColor, paddingAll: "5px", contents: [{ type: "box", layout: "horizontal", spacing: "sm", contents: b.gridButtons.slice(0, 2).map(g => ({ type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: b.gridBgColor, cornerRadius: "12px", action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) }, contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "é¸å–®", size: "sm", align: "center", color: "#E6E6E6" }] })) },{ type: "box", layout: "horizontal", spacing: "sm", margin: "sm", contents: b.gridButtons.slice(2, 4).map(g => ({ type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: b.gridBgColor, cornerRadius: "12px", action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) }, contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "é¸å–®", size: "sm", align: "center", color: "#E6E6E6" }] })) }] };
                } else if (b.type === 'ecommerce') {
                    bubble.hero = { type: "image", url: forceHttps(b.imageUrl), size: "full", aspectRatio: "16:9", aspectMode: "cover" };
                    const bodyRows = [];
                    for (let i = 0; i < (b.items || []).length; i += 3) {
                        const chunk = b.items.slice(i, i + 3);
                        const rowBox = { type: "box", layout: "horizontal", spacing: "sm", margin: "md", contents: [] };
                        chunk.forEach(item => { rowBox.contents.push({ type: "box", layout: "vertical", flex: 1, contents: [{ type: "image", url: forceHttps(item.img), aspectRatio: "1:1", aspectMode: "cover", size: "full" }, { type: "box", layout: "vertical", backgroundColor: "#000000", paddingAll: "xs", contents: [{ type: "text", text: item.title, color: "#FFFFFF", size: "xxs", align: "center", weight: "bold", wrap: true }] }], action: { type: "uri", label: "item", uri: forceHttps(item.url) } }); });
                        while (rowBox.contents.length < 3) rowBox.contents.push({ type: "box", layout: "vertical", flex: 1, contents: [] });
                        bodyRows.push(rowBox);
                    }
                    bubble.body = { type: "box", layout: "vertical", paddingAll: "5px", backgroundColor: b.bgColor || "#F8F8F8", contents: bodyRows };
                }
                const footerContents = [];
                if (b.type === 'standard' && b.social.enabled) {
                    const row = { type: "box", layout: "horizontal", spacing: "md", justifyContent: "center", margin: "sm", contents: [] };
                    Object.keys(socialTypes).forEach(key => { const l = b.social.links[key]; if (l && l.trim()) { row.contents.push({ type: "box", layout: "vertical", width: "32px", height: "32px", backgroundColor: socialTypes[key].color, cornerRadius: "xxl", alignItems: "center", justifyContent: "center", action: { type: "uri", label: key, uri: key==='tel' ? `tel:${l.trim()}` : forceHttps(l) }, contents: [{ type: "text", text: socialTypes[key].symbol, color: "#ffffff", size: "xs", weight: "bold", align: "center", gravity: "center" }] }); } });
                    if (row.contents.length > 0) footerContents.push(row);
                }
                b.buttons.forEach(btn => { footerContents.push({ type: "button", style: "primary", height: "sm", color: btn.color, margin: "sm", action: { type: "uri", label: btn.label, uri: forceHttps(btn.uri) } }); });
                bubble.footer = { type: "box", layout: "vertical", spacing: "sm", paddingAll: "5px", backgroundColor: b.footerBgColor || "#FFFFFF", contents: footerContents };
                return bubble;
            });
            return { type: "carousel", contents: contents };
        });

        const pushMix = () => { if(!liff.isLoggedIn()) { liff.login(); return; } liff.shareTargetPicker([{ type: "flex", altText: carousel.value.altText || "ç²¾é¸æ¨è–¦", contents: fullFlexJson.value }]).then(res => { if(res) alert("æˆåŠŸï¼"); }); };
        onMounted(() => { liff.init({ liffId: "2008924519-1qRqocsa" }).then(() => { if(liff.isLoggedIn()) liff.getProfile().then(p => { userProfile.value = p; isLoggedIn.value = true; }); }); });

        return { isSidebarCollapsed, carousel, activeIndex, activeBubble, showAddModal, addNewBubble, removeBubble: (idx) => { carousel.value.bubbles.splice(idx, 1); if(activeIndex.value >= carousel.value.bubbles.length) activeIndex.value = carousel.value.bubbles.length - 1; }, pushMix, showSaveModal: ref(false), projectName, isSaving, isLoggedIn, userProfile, moveLeft: (idx) => { const b = carousel.value.bubbles.splice(idx, 1)[0]; carousel.value.bubbles.splice(idx-1, 0, b); activeIndex.value = idx-1; }, moveRight: (idx) => { const b = carousel.value.bubbles.splice(idx, 1)[0]; carousel.value.bubbles.splice(idx+1, 0, b); activeIndex.value = idx+1; }, getTypeName: (t) => ({'standard':'æ¨™æº–ç‰ˆå‹','card':'å•†å‹™å‹åç‰‡','ecommerce':'é›»å•†å•†åŸå‹'}[t]), getTypeIcon: (t) => ({'standard':'fa-file-alt','card':'fa-id-card','ecommerce':'fa-shopping-cart'}[t]), socialTypes, hasSocialLinks: computed(() => activeBubble.value && Object.values(activeBubble.value.social.links).some(l => l.trim() !== '')) };
    }
}).mount('#app');
</script>
</body>
</html>
