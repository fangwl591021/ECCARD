<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mix.html</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        .sidebar-container { background-color: #1e2124; height: 100vh; width: 256px; display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        .carousel-preview-container { display: flex; gap: 15px; padding: 20px; overflow-x: auto; width: 100%; scroll-snap-type: x mandatory; }
        .preview-bubble { flex: 0 0 280px; scroll-snap-align: center; background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; flex-direction: column; position: relative; }
        .flex-badge { position: absolute; top: 10px; right: 10px; color: white; padding: 2px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; z-index: 20; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
        .header-box { padding: 10px; display: flex; align-items: center; gap: 8px; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; padding: 10px; }
        .grid-item { padding: 8px; border-radius: 8px; text-align: center; }
        .chat-room-bg { background-color: #7988a0; width: 100%; height: 100%; overflow-y: auto; padding: 40px 10px; }
        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }
        .ratio-btn { @apply px-3 py-1 text-xs border border-gray-200 rounded-md transition-all bg-white hover:border-line-green; }
        .ratio-btn-active { @apply border-line-green bg-green-50 text-line-green font-bold shadow-sm; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <aside class="sidebar-container text-gray-400 shadow-2xl">
        <div class="h-16 flex items-center px-6 border-b border-gray-700 shrink-0">
            <i class="fab fa-line text-3xl line-green"></i>
            <span class="ml-4 text-white font-bold whitespace-nowrap tracking-tighter uppercase font-mono">Mixer Pro</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <a href="index.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors"><i class="fas fa-home w-8 text-center"></i><span class="ml-2 font-medium">è¿”å›å–®é é–‹ç™¼</span></a>
            <a href="video.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors"><i class="fas fa-video w-8 text-center"></i><span class="ml-2 font-medium">å½±ç‰‡åç‰‡é–‹ç™¼</span></a>
            <div class="sidebar-item-active flex items-center py-4 px-6"><i class="fas fa-clone w-8 text-center"></i><span class="ml-2 font-medium">æ··åˆå¤šé é–‹ç™¼</span></div>
        </nav>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">æ··åˆå¤šé æ¨¡çµ„ç®¡ç†</h2>
            <div class="flex items-center gap-4">
                <button @click="copyJson" class="px-5 py-2 bg-slate-700 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-slate-800 flex items-center gap-2 transition-all">
                    <i class="fas fa-copy"></i> è¤‡è£½ JSON
                </button>
                <button @click="pushMix" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg flex items-center gap-2 transition-all">
                    <i class="fas fa-paper-plane"></i> ğŸš€ å¤šé æ¨æ’­æ¸¬è©¦
                </button>
            </div>
        </header>

        <div class="flex-grow flex overflow-hidden">
            <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
                <div class="max-w-4xl mx-auto space-y-8 pb-20">
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 mb-8 shadow-sm">
                        <label class="input-label text-blue-800">é€šçŸ¥æ–‡å­— (altText)</label>
                        <input type="text" v-model="carousel.altText" class="w-full px-4 py-2 border rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-200">
                    </div>

                    <div class="flex items-center gap-2 mb-8 overflow-x-auto pb-4 border-b no-scrollbar">
                        <div v-for="(bubble, index) in carousel.bubbles" :key="bubble.id" class="relative group shrink-0 flex flex-col items-center gap-1">
                            <button @click="activeIndex = index" :class="activeIndex === index ? 'bg-line-green text-white shadow-md' : 'bg-gray-100 text-gray-500'" class="w-28 py-2 rounded-xl text-xs font-bold truncate px-3">{{ index + 1 }}. {{ getTypeName(bubble.type) }}</button>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button @click.stop="moveLeft(index)" v-if="index > 0" class="w-5 h-5 bg-white border rounded text-[8px] hover:bg-gray-100 shadow-sm"><i class="fas fa-chevron-left"></i></button>
                                <button @click.stop="removeBubble(index)" v-if="carousel.bubbles.length > 1" class="w-5 h-5 bg-red-100 text-red-500 border border-red-200 rounded text-[8px] shadow-sm"><i class="fas fa-trash"></i></button>
                                <button @click.stop="moveRight(index)" v-if="index < carousel.bubbles.length - 1" class="w-5 h-5 bg-white border rounded text-[8px] hover:bg-gray-100 shadow-sm"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <button @click="showAddModal = true" class="w-10 h-10 border-2 border-dashed border-gray-300 rounded-xl hover:border-line-green hover:text-line-green transition-all shrink-0 self-start"><i class="fas fa-plus"></i></button>
                    </div>

                    <div v-if="activeBubble" class="space-y-8 animate-in fade-in duration-300">
                        <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2"><i :class="getTypeIcon(activeBubble.type)" class="text-line-green"></i> ç·¨è¼¯ï¼š{{ getTypeName(activeBubble.type) }}</h3>

                        <div v-if="activeBubble.type === 'article'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                                <div><label class="input-label">ä¸»åœ–ç¶²å€</label><input type="text" v-model="activeBubble.imageUrl" class="w-full px-4 py-2 border rounded-xl text-sm focus:border-line-green shadow-sm"></div>
                                <div class="flex items-center gap-3"><label class="input-label mb-0 mr-2">æ¯”ä¾‹ï¼š</label><button v-for="ratio in ['1:1', '20:13', '4:6']" @click="activeBubble.aspectRatio = ratio" :class="activeBubble.aspectRatio === ratio ? 'ratio-btn-active' : ''" class="ratio-btn shadow-sm">{{ ratio }}</button></div>
                                <div class="bg-white/50 p-4 rounded-lg border border-gray-100 space-y-3 shadow-sm">
                                    <label class="text-xs font-bold text-gray-600 flex items-center gap-2 cursor-pointer"><input type="checkbox" v-model="activeBubble.showBadge" class="w-4 h-4 accent-line-green"> é¡¯ç¤ºå³ä¸Šæ¨™ç±¤</label>
                                    <div v-if="activeBubble.showBadge" class="grid grid-cols-2 gap-3 pl-6">
                                        <div><label class="input-label">æ–‡å­—</label><input type="text" v-model="activeBubble.badgeText" maxlength="10" class="w-full border rounded p-1.5 text-xs"></div>
                                        <div><label class="input-label">é¡è‰²</label><input type="color" v-model="activeBubble.badgeColor"></div>
                                        <div class="col-span-2"><label class="input-label">é€£çµ</label><input type="text" v-model="activeBubble.badgeUri" class="w-full border rounded p-1.5 text-xs"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                                <label class="input-label">æ¨™é¡Œå…§å®¹</label><input type="text" v-model="activeBubble.title" class="w-full px-4 py-2 border rounded-xl text-sm font-bold">
                                <label class="input-label">æè¿°å…§å®¹ (é‚Šè· 5px å·²å„ªåŒ–)</label><textarea v-model="activeBubble.subtitle" rows="4" class="w-full px-4 py-2 border rounded-xl text-sm outline-none"></textarea>
                            </div>
                        </div>

                        <div v-if="activeBubble.type === 'card'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-6">
                                <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-id-card mr-2 text-line-green"></i> Header å“ç‰Œèˆ‡é…è‰²</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="input-label">å§“å</label><input type="text" v-model="activeBubble.headerName" class="w-full border rounded p-2 text-sm"></div>
                                    <div><label class="input-label">æ•˜è¿° (20å­—)</label><input type="text" v-model="activeBubble.headerDescription" maxlength="20" class="w-full border rounded p-2 text-sm"></div>
                                    <div class="col-span-2"><label class="input-label">é ­åƒç¶²å€</label><input type="text" v-model="activeBubble.headerImg" class="w-full border rounded p-2 text-sm"></div>
                                    <div><label class="input-label">Header èƒŒæ™¯</label><input type="color" v-model="activeBubble.headerBgColor" class="w-full"></div>
                                    <div><label class="input-label">Header æ–‡å­—</label><input type="color" v-model="activeBubble.headerTextColor" class="w-full"></div>
                                    <div><label class="input-label">Body èƒŒæ™¯</label><input type="color" v-model="activeBubble.bodyBgColor" class="w-full"></div>
                                    <div><label class="input-label">ç¶²æ ¼èƒŒæ™¯</label><input type="color" v-model="activeBubble.gridBgColor" class="w-full"></div>
                                </div>
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4">4 ç¶²æ ¼æŒ‰éˆ•é…ç½®</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div v-for="(grid, idx) in activeBubble.gridButtons" :key="idx" class="p-3 bg-white border rounded-xl space-y-2">
                                        <div class="flex gap-2 mb-1"><input type="text" v-model="grid.emoji" class="w-8 border rounded text-xs text-center"><input type="text" v-model="grid.label" class="flex-1 border rounded p-1 text-xs"></div>
                                        <input type="text" v-model="grid.uri" class="w-full border rounded p-1 text-[10px]" placeholder="HTTPS URL">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="activeBubble.type === 'ecommerce'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>å•†å“ç¶²æ ¼é…ç½®</span><button @click="activeBubble.items.push({title:'å•†å“',img:'https://lihi.cc/mwMvo',url:'https://line.me'})" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div><label class="input-label">æ¬„ä½</label><select v-model="activeBubble.columns" class="w-full border rounded p-1.5 text-sm"><option :value="3">3 æ¬„ä½</option><option :value="4">4 æ¬„ä½</option></select></div>
                                    <div><label class="input-label">Body èƒŒæ™¯</label><input type="color" v-model="activeBubble.bgColor" class="w-full"></div>
                                </div>
                                <div class="p-4 bg-white border rounded-xl mb-4 space-y-3 shadow-sm">
                                    <label class="input-label">èƒŒæ™¯æ¨¡å¼</label>
                                    <div class="flex bg-slate-100 p-1 rounded-lg"><button @click="activeBubble.bgType='color'" :class="activeBubble.bgType==='color'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1.5 text-[10px] font-bold rounded">ç´”è‰²</button><button @click="activeBubble.bgType='image'" :class="activeBubble.bgType==='image'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1.5 text-[10px] font-bold rounded">åœ–ç‰‡</button></div>
                                    <div v-if="activeBubble.bgType==='image'" class="space-y-2 animate-in fade-in"><input type="text" v-model="activeBubble.bg" class="w-full text-xs p-2 border rounded" placeholder="èƒŒæ™¯åœ– HTTPS"><select v-model="activeBubble.bgMode" class="w-full text-xs p-1 border rounded"><option value="cover">å…¨ç‰ˆæ‹‰ä¼¸ (Cover)</option><option value="top">ç­‰æ¯”ç¸®æ”¾ (Fit Width)</option></select></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div v-for="(item, idx) in activeBubble.items" :key="idx" class="p-3 bg-white border rounded-xl flex items-center gap-3 relative shadow-sm hover:border-line-green transition-all"><img :src="item.img" class="w-10 h-10 rounded border"><div class="flex-1"><input v-model="item.title" class="w-full text-xs font-bold border-b mb-1"><input v-model="item.url" class="w-full text-[9px] text-gray-400" placeholder="HTTPSé€£çµ"></div><button @click="activeBubble.items.splice(idx,1)" class="text-red-400 absolute top-1 right-1"><i class="fas fa-times"></i></button></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                            <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>åˆ†é åº•éƒ¨æŒ‰éˆ• (å›ºå®šé«˜åº¦ Sm)</span><button @click="activeBubble.buttons.push({label:'æŒ‰éˆ•',uri:'https://line.me',color:'#00B900'})" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                            <div class="space-y-4">
                                <div v-for="(btn, idx) in activeBubble.buttons" :key="idx" class="p-4 bg-white border rounded-xl flex items-center gap-4 shadow-sm transition-all hover:border-green-100">
                                    <div class="text-center"><label class="text-[9px] block text-gray-400 font-bold uppercase tracking-tight">é…è‰²</label><input type="color" v-model="btn.color"></div>
                                    <div class="w-32"><label class="input-label">æ–‡å­—</label><input type="text" v-model="btn.label" class="w-full border rounded p-1.5 text-sm font-bold"></div>
                                    <div class="flex-1"><label class="input-label">è·³è½‰ç¶²å€ (HTTPS)</label><input type="text" v-model="btn.uri" class="w-full border rounded p-1.5 text-sm"></div>
                                    <button @click="activeBubble.buttons.splice(idx,1)" class="text-gray-300 hover:text-red-500 pt-4 transition-colors"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-[380px] shrink-0 bg-slate-100 relative overflow-hidden flex flex-col shadow-inner">
                <div class="chat-room-bg no-scrollbar flex flex-col items-center">
                    <div class="carousel-preview-container no-scrollbar">
                        <div v-for="bubble in carousel.bubbles" :key="bubble.id" class="preview-bubble">
                            <template v-if="bubble.type === 'article'"><div class="relative"><img :src="bubble.imageUrl" :style="{ aspectRatio: bubble.aspectRatio.replace(':','/') }" class="w-full object-cover"><div v-if="bubble.showBadge" class="flex-badge" :style="{ backgroundColor: bubble.badgeColor }">{{ bubble.badgeText }}</div></div><div class="p-[5px] text-center"><div class="text-sm font-bold truncate">{{ bubble.title }}</div><div class="text-[9px] text-gray-500 mt-1 h-12 overflow-hidden leading-tight">{{ bubble.subtitle }}</div></div></template>
                            <template v-else-if="bubble.type === 'card'"><div class="header-box" :style="{ backgroundColor: bubble.headerBgColor }"><img :src="bubble.headerImg" class="w-8 h-8 rounded-full object-cover shadow-sm"><div class="flex flex-col overflow-hidden"><span class="text-[10px] font-bold uppercase truncate" :style="{ color: bubble.headerTextColor }">{{ bubble.headerName }}</span><span class="text-[7px] leading-tight truncate" :style="{ color: bubble.headerTextColor, opacity: 0.8 }">{{ bubble.headerDescription }}</span></div></div><div class="w-full aspect-[16/9] bg-black"><img :src="bubble.imageUrl" class="w-full h-full object-cover opacity-70"></div><div class="grid-box" :style="{ backgroundColor: bubble.bodyBgColor }"><div v-for="grid in bubble.gridButtons" class="grid-item text-[8px] text-gray-300 uppercase tracking-tighter truncate shadow-sm" :style="{ backgroundColor: bubble.gridBgColor }">{{grid.emoji}} {{grid.label || 'é¸å–®'}}</div></div></template>
                            <template v-else-if="bubble.type === 'ecommerce'"><div class="w-full aspect-[16/9] bg-black shrink-0"><img :src="bubble.imageUrl" class="w-full h-full object-cover"></div><div class="p-2 relative flex-grow" :style="{ backgroundColor: bubble.bgColor }"><img v-if="bubble.bgType==='image' && bubble.bg" :src="bubble.bg" :class="bubble.bgMode === 'top' ? 'object-contain' : 'object-cover'" class="absolute inset-0 w-full h-full z-0 opacity-40"><div :class="bubble.columns === 3 ? 'grid-cols-3' : 'grid-cols-4'" class="relative z-10 grid gap-1"><div v-for="item in bubble.items.slice(0,8)" class="bg-white rounded p-1 border shadow-sm flex flex-col items-center"><img :src="item.img" class="w-full aspect-square object-cover rounded-sm mb-0.5"><div :style="{ backgroundColor: '#000000', color: '#ffffff' }" class="w-full py-0.5 rounded-[2px] truncate text-[5px] font-bold text-center px-0.5">{{item.title}}</div></div></div></div></template>
                            <div class="p-3 border-t bg-white space-y-1.5 mt-auto"><button v-for="btn in bubble.buttons" :style="{ backgroundColor: btn.color }" class="w-full py-1.5 text-white text-[9px] font-bold rounded shadow-sm">{{ btn.label }}</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div v-if="showAddModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] backdrop-blur-sm animate-in fade-in duration-300"><div class="bg-white rounded-[32px] p-8 max-w-sm w-full shadow-2xl"><h3 class="text-xl font-bold mb-6 text-center">é¸æ“‡åˆ†é æ¨¡çµ„</h3><div class="grid grid-cols-1 gap-4"><button v-for="t in ['article','card','ecommerce']" @click="addNewBubble(t)" class="p-4 border-2 rounded-2xl hover:border-line-green hover:bg-green-50 text-left font-bold uppercase transition-all flex items-center gap-4"><i :class="getTypeIcon(t)" class="text-2xl text-gray-400"></i><div><div class="text-gray-700">{{ t }}</div><div class="text-[10px] font-normal text-gray-400">é»æ“Šæ–°å¢æ­¤åˆ†é </div></div></button></div><button @click="showAddModal = false" class="w-full mt-6 py-2 text-gray-400">å–æ¶ˆ</button></div></div>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;
const forceHttps = (u) => { if (!u || u.trim() === "" || u === "#") return "https://line.me"; let url = u.trim(); if (url.startsWith("http://")) return url.replace("http://", "https://"); if (!url.startsWith("https://") && !url.startsWith("line://")) return "https://" + url; return url; };
const cleanJson = (obj) => JSON.parse(JSON.stringify(obj));

createApp({
    setup() {
        const activeIndex = ref(0); const showAddModal = ref(false);
        const carousel = ref({ altText: 'æ··åˆå¤šé è¨Šæ¯', bubbles: [{ id: crypto.randomUUID(), type: 'article', imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', aspectRatio: '20:13', title: 'é¦–é ç²¾é¸', subtitle: 'å…§å®¹...', showBadge: true, badgeText: 'Hot', badgeColor: '#FF0000', badgeUri: 'https://line.me', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: 'https://line.me', color: '#00B900' }] }] });
        const activeBubble = computed(() => carousel.value.bubbles[activeIndex.value] || null);
        const addNewBubble = (type) => {
            const b = { id: crypto.randomUUID(), type, imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: 'https://line.me', color: '#00B900' }] };
            if (type==='article') { b.title='æ–‡ç« æ¨™é¡Œ'; b.subtitle='å…§å®¹...'; b.aspectRatio='20:13'; b.showBadge=true; b.badgeText='åˆ†äº«'; b.badgeColor='#FF0000'; b.badgeUri='https://line.me'; }
            else if (type==='card') { b.headerName='å§“å'; b.headerDescription='æè¿°'; b.headerImg='https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png'; b.headerBgColor='#1A1B1E'; b.headerTextColor='#D4AF37'; b.bodyBgColor='#0F0F10'; b.gridBgColor='#2A2C31'; b.gridButtons=[{emoji:'ğŸ¤–',label:'AI',uri:'https://line.me'},{emoji:'ğŸ¥',label:'å½±',uri:'https://line.me'},{emoji:'ğŸ§¾',label:'å–®',uri:'https://line.me'},{emoji:'ğŸ“',label:'åœ–',uri:'https://line.me'}]; }
            else if (type==='ecommerce') { b.items=[{title:'å•†å“',img:'https://lihi.cc/mwMvo',url:'https://line.me'}]; b.columns=3; b.bgType='color'; b.bgMode='cover'; b.bgColor='#F8F8F8'; b.tagBgColor='#000000'; b.tagTextColor='#FFFFFF'; b.footer={textEnabled:false}; }
            carousel.value.bubbles.push(b); activeIndex.value = carousel.value.bubbles.length - 1; showAddModal.value = false;
        };
        const removeBubble = (idx) => { if (carousel.value.bubbles.length > 1) { carousel.value.bubbles.splice(idx, 1); if (activeIndex.value >= carousel.value.bubbles.length) activeIndex.value = carousel.value.bubbles.length - 1; } };
        const moveLeft = (idx) => { if (idx > 0) { [carousel.value.bubbles[idx], carousel.value.bubbles[idx-1]] = [carousel.value.bubbles[idx-1], carousel.value.bubbles[idx]]; activeIndex.value = idx - 1; } };
        const moveRight = (idx) => { if (idx < carousel.value.bubbles.length - 1) { [carousel.value.bubbles[idx], carousel.value.bubbles[idx+1]] = [carousel.value.bubbles[idx+1], carousel.value.bubbles[idx]]; activeIndex.value = idx + 1; } };
        const fullFlexJson = computed(() => ({ type: "carousel", contents: carousel.value.bubbles.map(b => {
            const bubble = { type: "bubble", size: "mega" };
            if (b.type==='article') {
                const bodyBox = [{type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:b.aspectRatio,aspectMode:"cover"},{type:"box",layout:"vertical",paddingAll:"5px",contents:[{type:"text",text:b.title||"æ¨™é¡Œ",weight:"bold",size:"xl",wrap:true,align:"center"},{type:"text",text:b.subtitle||"æè¿°",size:"sm",margin:"sm",color:"#666666",wrap:true}]}];
                if (b.showBadge) bodyBox.push({type:"box",layout:"vertical",position:"absolute",backgroundColor:b.badgeColor,cornerRadius:"xl",paddingTop:"2px",paddingBottom:"2px",paddingStart:"10px",paddingEnd:"10px",offsetTop:"10px",offsetEnd:"10px",action:{type:"uri",label:"badge",uri:forceHttps(b.badgeUri)},contents:[{type:"text",text:b.badgeText||"åˆ†äº«",color:"#ffffff",size:"10px",weight:"bold"}]});
                bubble.body={type:"box",layout:"vertical",paddingAll:"0px",contents:bodyBox};
            } else if (b.type==='card') {
                bubble.header={type:"box",layout:"horizontal",paddingAll:"8px",backgroundColor:b.headerBgColor,contents:[{type:"image",url:forceHttps(b.headerImg),size:"xs",aspectRatio:"1:1",aspectMode:"cover",gravity:"center"},{type:"box",layout:"vertical",flex:3,margin:"md",contents:[{type:"text",text:b.headerName||"å§“å",weight:"bold",color:b.headerTextColor,size:"lg"},{type:"text",text:b.headerDescription||"æè¿°",size:"xs",color:b.headerTextColor,wrap:true}]}]};
                bubble.hero={type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:"800:500",aspectMode:"cover",action:{type:"uri",label:"hero",uri:"https://line.me"}};
                bubble.body={type:"box",layout:"vertical",backgroundColor:b.bodyBgColor,paddingAll:"8px",contents:[{type:"box",layout:"horizontal",spacing:"sm",contents: b.gridButtons.slice(0,2).map(g=>({type:"box",layout:"vertical",paddingAll:"10px",backgroundColor:b.gridBgColor,cornerRadius:"12px",action:{type:"uri",label:g.label||"grid",uri:forceHttps(g.uri)},contents:[{type:"text",text:g.emoji||"ğŸ”˜",align:"center",size:"xl"},{type:"text",text:g.label||"é¸å–®",size:"sm",align:"center",color:"#E6E6E6"}]}))},{type:"box",layout:"horizontal",spacing:"sm",margin:"sm",contents: b.gridButtons.slice(2,4).map(g=>({type:"box",layout:"vertical",paddingAll:"10px",backgroundColor:b.gridBgColor,cornerRadius:"12px",action:{type:"uri",label:g.label||"grid",uri:forceHttps(g.uri)},contents:[{type:"text",text:g.emoji||"ğŸ”˜",align:"center",size:"xl"},{type:"text",text:g.label||"é¸å–®",size:"sm",align:"center",color:"#E6E6E6"}]}))}]};
            } else if (b.type==='ecommerce') {
                const chunk=(a,s)=>Array.from({length:Math.ceil(a.length/s)},(v,i)=>a.slice(i*s,i*s+s)); 
                const prods={type:"box",layout:"vertical",contents:chunk(b.items||[], b.columns).map((row, rIdx)=>({type:"box",layout:"horizontal",margin:rIdx===0?"none":"sm",contents:row.map(item=>({type:"box",layout:"vertical",width:b.columns===3?"32%":"23%",contents:[{type:"image",url:forceHttps(item.img),aspectRatio:"1:1",aspectMode:"cover"},{type:"box",layout:"vertical",backgroundColor:b.tagBgColor||"#000",paddingAll:"xs",contents:[{type:"text",text:item.title||"å•†å“",size:"xxxs",color:b.tagTextColor||"#fff",align:"center"}]}],action:{type:"uri",label:item.title||"å•†å“",uri:forceHttps(item.url)}}))}))};
                bubble.hero={type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:"16:9",aspectMode:"cover",action:{type:"uri",label:"hero",uri:"https://line.me"}};
                bubble.body={type:"box",layout:"vertical",paddingAll:"none",backgroundColor:b.bgColor||"#f8f8f8",contents: b.bgType==='image' ? [{type:"image",url:forceHttps(b.bg),position:"absolute",size:"full",aspectMode:b.bgMode==='top'?"width":"cover"},prods] : [prods]};
            }
            bubble.footer={type:"box",layout:"vertical",spacing:"sm",paddingAll: "15px",contents: b.buttons.map(btn=>({type:"button",style:"primary",height:"sm",color:btn.color,action:{type:"uri",label:btn.label||"æŒ‰éˆ•",uri:forceHttps(btn.uri)}}))};
            return bubble;
        }) }));
        const copyJson = () => { const raw = JSON.stringify(fullFlexJson.value, null, 2); const el = document.createElement('textarea'); el.value = raw; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert('JSON å·²è¤‡è£½ï¼'); };
        const pushMix = () => { if (!liff.isLoggedIn()) { liff.login(); return; } liff.shareTargetPicker([{ type: "flex", altText: carousel.value.altText, contents: cleanJson(fullFlexJson.value) }]).then(res => { if (res) alert("å¤šé æ¨æ’­æˆåŠŸç™¼é€ï¼"); }).catch(err => alert("ç™¼é€å¤±æ•—ï¼šè«‹æª¢æŸ¥æ‰€æœ‰ç¶²å€ã€‚")); };
        onMounted(async () => { try { await liff.init({ liffId: "2008541971-Wgvz6gD8" }); } catch (e) {} });
        return { carousel, activeIndex, activeBubble, addNewBubble, removeBubble, moveLeft, moveRight, pushMix, copyJson, getTypeName: (t) => ({'article':'æ–‡ç« å‹','card':'åç‰‡åœ–ç‰‡','ecommerce':'é›»å•†å•†åŸ'}[t]), getTypeIcon: (t) => ({'article':'fa-file-alt','card':'fa-id-card','ecommerce':'fa-shopping-cart'}[t]) };
    }
}).mount('#app');
</script>
</body>
</html>
