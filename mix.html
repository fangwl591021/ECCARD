<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINEOA å¤šé æ··åˆé–‹ç™¼å¹³å°</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        
        .sidebar-container { background-color: #1e2124; height: 100vh; width: 256px; display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }

        .carousel-preview-container { display: flex; gap: 15px; padding: 20px; overflow-x: auto; width: 100%; scroll-snap-type: x mandatory; }
        .carousel-preview-container::-webkit-scrollbar { height: 6px; }
        .carousel-preview-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .preview-bubble { flex: 0 0 280px; scroll-snap-align: center; background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; flex-direction: column; position: relative; }

        .header-box { background: #1A1B1E; padding: 10px; display: flex; align-items: center; gap: 8px; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; padding: 10px; background: #0F0F10; }
        .grid-item { background: #2A2C31; padding: 8px; border-radius: 8px; text-align: center; }
        .chat-room-bg { background-color: #7988a0; width: 100%; height: 100%; overflow-y: auto; padding: 40px 10px; }

        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .ratio-btn { @apply px-3 py-1 text-xs border border-gray-200 rounded-md transition-all bg-white hover:border-line-green; }
        .ratio-btn-active { @apply border-line-green bg-green-50 text-line-green font-bold shadow-sm; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <!-- å´é‚Šæ¬„ -->
    <aside class="sidebar-container text-gray-400 shadow-2xl">
        <div class="h-16 flex items-center px-6 border-b border-gray-700 shrink-0">
            <i class="fab fa-line text-3xl line-green"></i>
            <span class="ml-4 text-white font-bold whitespace-nowrap tracking-tighter uppercase font-mono">Mixer Pro</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar">
            <a href="index.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-arrow-left w-8 text-center"></i><span class="ml-2 font-medium">è¿”å›å–®é é–‹ç™¼</span>
            </a>
            <div class="sidebar-item-active flex items-center py-4 px-6"><i class="fas fa-clone w-8 text-center"></i><span class="ml-2 font-medium">æ··åˆå¤šé é–‹ç™¼</span></div>
        </nav>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-3">å¤šé æ··åˆé–‹ç™¼ç®¡ç† <span class="bg-gray-100 text-[10px] px-2 rounded">Carousel</span></h2>
            <div class="flex items-center gap-4">
                <button @click="pushMix" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-blue-600 flex items-center gap-2"><i class="fas fa-paper-plane"></i> ğŸš€ æ¨æ’­ç™¼é€</button>
            </div>
        </header>

        <div class="flex-grow flex overflow-hidden">
            <!-- å·¦å´ç·¨è¼¯å€ -->
            <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 mb-8 shadow-sm">
                        <label class="input-label text-blue-800">èŠå¤©å®¤é€šçŸ¥æ–‡å­— (altText)</label>
                        <input type="text" v-model="carousel.altText" class="w-full px-4 py-2 border rounded-xl text-sm focus:ring-2 focus:ring-blue-300 outline-none">
                    </div>

                    <!-- åˆ†é å°è¦½ + æ’åºäº¤æ›åŠŸèƒ½ -->
                    <div class="flex items-center gap-2 mb-8 overflow-x-auto pb-4 no-scrollbar border-b">
                        <div v-for="(bubble, index) in carousel.bubbles" :key="bubble.id" class="relative group shrink-0 flex flex-col items-center gap-1">
                            <button @click="activeIndex = index" 
                                :class="activeIndex === index ? 'bg-line-green text-white shadow-md' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'"
                                class="w-28 py-2 rounded-xl text-xs font-bold transition-all truncate px-3">
                                é é¢ {{ index + 1 }}
                            </button>
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button @click.stop="moveLeft(index)" v-if="index > 0" class="w-5 h-5 bg-white border rounded text-[8px] hover:bg-gray-100 shadow-sm"><i class="fas fa-chevron-left"></i></button>
                                <button @click.stop="removeBubble(index)" v-if="carousel.bubbles.length > 1" class="w-5 h-5 bg-red-100 text-red-500 border border-red-200 rounded text-[8px] hover:bg-red-200 shadow-sm"><i class="fas fa-trash"></i></button>
                                <button @click.stop="moveRight(index)" v-if="index < carousel.bubbles.length - 1" class="w-5 h-5 bg-white border rounded text-[8px] hover:bg-gray-100 shadow-sm"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <button @click="showAddModal = true" v-if="carousel.bubbles.length < 12" class="w-10 h-10 border-2 border-dashed border-gray-300 text-gray-400 rounded-xl hover:border-line-green hover:text-line-green transition-all shrink-0 self-start"><i class="fas fa-plus"></i></button>
                    </div>

                    <!-- å…·é«”åˆ†é ç·¨è¼¯å™¨ -->
                    <div v-if="activeBubble" class="space-y-8 pb-20">
                        <div class="flex items-center justify-between">
                            <h3 class="font-bold text-gray-800 text-lg flex items-center gap-2"><i :class="getTypeIcon(activeBubble.type)" class="text-line-green"></i> æ­£åœ¨ç·¨è¼¯ï¼š{{ getTypeName(activeBubble.type) }}</h3>
                            <span class="text-[10px] text-gray-400 font-mono">MOD_ID: {{ activeIndex + 1 }}</span>
                        </div>

                        <!-- æ–‡ç« å‹ç·¨è¼¯å€ -->
                        <div v-if="activeBubble.type === 'article'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <label class="input-label">ä¸»è¦–è¦ºåœ–ç‰‡ç¶²å€</label>
                                <input type="text" v-model="activeBubble.imageUrl" class="w-full px-4 py-2 border rounded-xl text-sm focus:border-line-green shadow-sm mb-4">
                                <div class="flex items-center gap-3">
                                    <label class="input-label mb-0 mr-2">é¡¯ç¤ºæ¯”ä¾‹ï¼š</label>
                                    <button v-for="ratio in ['1:1', '20:13', '4:6']" @click="activeBubble.aspectRatio = ratio" :class="activeBubble.aspectRatio === ratio ? 'ratio-btn-active' : ''" class="ratio-btn shadow-sm">{{ ratio }}</button>
                                </div>
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <label class="input-label">æ¨™é¡Œå…§å®¹</label><input type="text" v-model="activeBubble.title" class="w-full px-4 py-2 border rounded-xl text-sm font-bold mb-4 focus:border-line-green shadow-sm">
                                <label class="input-label">æè¿°æ–‡å­—</label><textarea v-model="activeBubble.subtitle" rows="5" class="w-full px-4 py-3 border rounded-xl text-sm outline-none focus:border-line-green shadow-sm"></textarea>
                            </div>
                        </div>

                        <!-- åç‰‡å‹ç·¨è¼¯å€ (é–å®šåœ–ç‰‡æ¨¡å¼) -->
                        <div v-if="activeBubble.type === 'card'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-id-card mr-2 text-line-green"></i> Header å“ç‰Œè¨­å®š</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="input-label">å§“å</label><input type="text" v-model="activeBubble.headerName" class="w-full px-4 py-2 border rounded-lg text-sm"></div>
                                    <div><label class="input-label">ç¨±è™Ÿ</label><input type="text" v-model="activeBubble.headerTitle" class="w-full px-4 py-2 border rounded-lg text-sm"></div>
                                    <div class="col-span-2"><label class="input-label">é ­åƒç¶²å€</label><input type="text" v-model="activeBubble.headerImg" class="w-full px-4 py-2 border rounded-lg text-sm"></div>
                                </div>
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <label class="input-label">ä¸»è¦–è¦ºåœ–ç‰‡ç¶²å€</label>
                                <input type="text" v-model="activeBubble.imageUrl" class="w-full px-4 py-2 border rounded-xl text-sm focus:border-line-green shadow-sm">
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4">ç¶²æ ¼æŒ‰éˆ•è¨­å®š</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div v-for="(grid, idx) in activeBubble.gridButtons" :key="idx" class="p-3 bg-white border rounded-xl shadow-sm">
                                        <div class="flex gap-2 mb-2"><input type="text" v-model="grid.emoji" class="w-10 border rounded text-sm text-center"><input type="text" v-model="grid.label" class="flex-1 border rounded px-2 py-1 text-xs"></div>
                                        <label class="input-label">è·³è½‰ç¶²å€</label><input type="text" v-model="grid.uri" class="w-full border rounded px-2 py-1 text-[10px]" placeholder="https://...">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- é›»å•†å‹ç·¨è¼¯å€ (è¦æ ¼é‚„åŸï¼šä¸å†èˆ‡å–®é æ··æ·†) -->
                        <div v-if="activeBubble.type === 'ecommerce'" class="space-y-6">
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-image mr-2 text-line-green"></i> é ‚éƒ¨ Hero è¦–è¦º (åœ–ç‰‡æ¨¡å¼)</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="input-label">åœ–ç‰‡æ¯”ä¾‹</label><select v-model="activeBubble.aspectRatio" class="w-full text-xs p-2 border rounded-lg focus:ring-1 focus:ring-line-green outline-none"><option v-for="a in ['16:9','1:1','4:3','1.91:1','3:4']" :value="a">{{ a }}</option></select></div>
                                    <div><label class="input-label">åœ–ç‰‡é€£çµ</label><input type="text" v-model="activeBubble.imageUrl" class="w-full text-xs p-2 border rounded-lg shadow-sm" placeholder="https://..."></div>
                                </div>
                            </div>
                            <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                                <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>Body å•†å“ç¶²æ ¼é…ç½®</span><button @click="activeBubble.items.push({title:'æ–°å•†å“',img:'https://lihi.cc/mwMvo',url:''})" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div><label class="input-label">æ¯è¡Œé¡¯ç¤ºæ¬„ä½</label><select v-model="activeBubble.columns" class="w-full text-xs p-2 border rounded-lg"><option :value="3">3 æ¬„ä½</option><option :value="4">4 æ¬„ä½</option></select></div>
                                    <div><label class="input-label">èƒŒæ™¯åº•è‰²</label><div class="flex items-center gap-2 bg-white p-1.5 border rounded-lg"><input type="color" v-model="activeBubble.bgColor"><span class="text-[10px] font-mono uppercase">{{activeBubble.bgColor}}</span></div></div>
                                </div>
                                <div class="p-4 bg-white border rounded-xl mb-4">
                                    <label class="input-label">æ»¿ç‰ˆèƒŒæ™¯æ¨¡å¼è¨­å®š</label>
                                    <div class="flex bg-slate-100 p-1 rounded-lg mb-3"><button @click="activeBubble.bgType='color'" :class="activeBubble.bgType==='color'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1 text-[10px] font-bold rounded">ç´”è‰²</button><button @click="activeBubble.bgType='image'" :class="activeBubble.bgType==='image'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1 text-[10px] font-bold rounded">åœ–ç‰‡</button></div>
                                    <div v-if="activeBubble.bgType==='image'" class="space-y-3">
                                        <input type="text" v-model="activeBubble.bg" class="w-full text-xs p-2 border rounded" placeholder="èƒŒæ™¯åœ– HTTPS ç¶²å€">
                                        <select v-model="activeBubble.bgMode" class="w-full text-xs p-1 border rounded"><option value="cover">å…¨ç‰ˆæ‹‰ä¼¸ (Cover)</option><option value="top">ç­‰æ¯”ç¸®æ”¾ (Fit Width)</option></select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div v-for="(item, idx) in activeBubble.items" :key="idx" class="p-3 bg-white border rounded-xl flex items-center gap-3 relative shadow-sm hover:border-line-green transition-all"><img :src="item.img" class="w-10 h-10 rounded border"><div class="flex-1"><label class="input-label">å“å</label><input v-model="item.title" class="w-full text-xs font-bold border-b focus:outline-none mb-1"><label class="input-label">é€£çµ</label><input v-model="item.url" class="w-full text-[10px] text-gray-400 focus:outline-none" placeholder="https://..."></div><button @click="activeBubble.items.splice(idx,1)" class="text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-times"></i></button></div>
                                </div>
                            </div>
                        </div>

                        <!-- åº•éƒ¨é€šç”¨æŒ‰éˆ•è¨­å®š (å…¨æ¨¡çµ„æ”¯æ´ç¨ç«‹é…è‰²) -->
                        <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                            <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>åˆ†é åº•éƒ¨è¡Œç‚ºæŒ‰éˆ• (å›ºå®š Sm)</span><button v-if="activeBubble.buttons.length < 3" @click="activeBubble.buttons.push({label:'æŒ‰éˆ•',uri:'',color:'#00B900'})" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                            <div class="space-y-4">
                                <div v-for="(btn, idx) in activeBubble.buttons" :key="idx" class="p-4 bg-white border rounded-xl flex items-center gap-4 shadow-sm transition-all hover:border-green-100">
                                    <div class="text-center"><label class="text-[9px] block text-gray-400 font-bold uppercase">é…è‰²</label><input type="color" v-model="btn.color"></div>
                                    <div class="w-32"><label class="input-label">æ–‡å­—</label><input type="text" v-model="btn.label" class="w-full border rounded p-1.5 text-sm font-bold"></div>
                                    <div class="flex-1"><label class="input-label">é€£çµç¶²å€</label><input type="text" v-model="btn.uri" class="w-full border rounded p-1.5 text-sm" placeholder="https://..."></div>
                                    <button @click="activeBubble.buttons.splice(idx,1)" class="text-gray-300 hover:text-red-500 transition-colors pt-4"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´é è¦½å€ (Carousel æ»¾å‹•é è¦½) -->
            <div class="w-[380px] shrink-0 bg-slate-100 relative overflow-hidden flex flex-col shadow-inner">
                <div class="chat-room-bg no-scrollbar flex flex-col items-center">
                    <div class="text-center mb-6"><span class="bg-black/20 text-white text-[10px] px-3 py-1 rounded-full backdrop-blur-sm shadow-sm">Mixed Carousel Preview</span></div>
                    
                    <div class="carousel-preview-container no-scrollbar">
                        <div v-for="bubble in carousel.bubbles" :key="bubble.id" class="preview-bubble">
                            <!-- é è¦½æ¨¡çµ„: æ–‡ç« å‹ -->
                            <template v-if="bubble.type === 'article'">
                                <img :src="bubble.imageUrl" :style="{ aspectRatio: bubble.aspectRatio.replace(':','/') }" class="w-full object-cover">
                                <div class="p-4 text-center"><div class="text-sm font-bold truncate">{{ bubble.title || 'æ¨™é¡Œ' }}</div><div class="text-[9px] text-gray-500 mt-1 h-12 overflow-hidden leading-relaxed">{{ bubble.subtitle || 'è«‹è¼¸å…¥æè¿°...' }}</div></div>
                            </template>

                            <!-- é è¦½æ¨¡çµ„: åç‰‡å‹ -->
                            <template v-else-if="bubble.type === 'card'">
                                <div class="header-box"><img :src="bubble.headerImg" class="w-8 h-8 rounded-full object-cover border border-gray-700 shadow-sm"><div class="flex flex-col"><span class="text-[10px] font-bold" style="color:#D4AF37">{{ bubble.headerName || 'å§“å' }}</span><span class="text-[7px] text-gray-400">{{ bubble.headerTitle || 'è·ä½' }}</span></div></div>
                                <div class="w-full aspect-[16/9] bg-black"><img :src="bubble.imageUrl" class="w-full h-full object-cover opacity-70"></div>
                                <div class="grid-box"><div v-for="grid in bubble.gridButtons" class="grid-item text-[8px] text-gray-300 uppercase tracking-tighter truncate">{{grid.emoji}} {{grid.label || 'é¸å–®'}}</div></div>
                            </template>

                            <!-- é è¦½æ¨¡çµ„: é›»å•†å‹ (å…¨åŠŸèƒ½æ¢å¾©) -->
                            <template v-else-if="bubble.type === 'ecommerce'">
                                <div class="w-full aspect-[16/9] bg-black shrink-0"><img :src="bubble.imageUrl" class="w-full h-full object-cover"></div>
                                <div class="p-3 relative" :style="{ backgroundColor: bubble.bgColor }">
                                    <img v-if="bubble.bgType==='image'" :src="bubble.bg" :class="bubble.bgMode === 'top' ? 'object-contain' : 'object-cover'" class="absolute inset-0 w-full h-full z-0 opacity-40">
                                    <div :class="bubble.columns === 3 ? 'grid-cols-3' : 'grid-cols-4'" class="relative z-10 grid gap-1">
                                        <div v-for="item in bubble.items.slice(0,8)" class="bg-white rounded p-1 border border-slate-50 text-[6px] text-center shadow-sm flex flex-col items-center">
                                            <img :src="item.img" class="w-full aspect-square object-cover rounded-sm mb-0.5">
                                            <div :style="{ backgroundColor: bubble.tagBgColor, color: bubble.tagTextColor }" class="w-full py-0.5 rounded-[2px] truncate px-0.5 font-bold">{{item.title}}</div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- åˆ†é åº•éƒ¨æŒ‰éˆ• (Sm) -->
                            <div class="p-3 border-t bg-white space-y-1.5 mt-auto">
                                <button v-for="btn in bubble.buttons" :style="{ backgroundColor: btn.color }" class="w-full py-1.5 text-white text-[9px] font-bold rounded shadow-sm transition hover:brightness-110">{{ btn.label }}</button>
                            </div>
                        </div>
                    </div>
                    <div class="text-gray-300 text-[10px] mt-4 font-bold"><i class="fas fa-arrows-alt-h mr-1"></i> å·¦å³æ»‘å‹•åˆ‡æ›é è¦½åˆ†é </div>
                </div>
            </div>
        </div>
    </main>

    <!-- å½ˆçª—: é¸æ“‡åˆ†é æ¨¡çµ„é¡å‹ -->
    <div v-if="showAddModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] backdrop-blur-sm animate-in fade-in duration-300">
        <div class="bg-white rounded-[32px] p-8 max-w-sm w-full shadow-2xl">
            <h3 class="text-xl font-bold mb-6 text-center text-gray-800">é¸æ“‡åˆ†é é¡å‹</h3>
            <div class="grid grid-cols-1 gap-4">
                <button @click="addNewBubble('article')" class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-2xl hover:border-line-green hover:bg-green-50 transition-all text-left group">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-line-green text-xl group-hover:scale-110 transition-transform"><i class="fas fa-file-alt"></i></div>
                    <div><div class="font-bold text-gray-700">å–®é æ–‡ç« </div><div class="text-[10px] text-gray-400">å¤§åœ–å±•ç¤ºã€æ¨™é¡Œèˆ‡æè¿°å…§å®¹</div></div>
                </button>
                <button @click="addNewBubble('card')" class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-2xl hover:border-line-green hover:bg-green-50 transition-all text-left group">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-purple-600 text-xl group-hover:scale-110 transition-transform"><i class="fas fa-id-card"></i></div>
                    <div><div class="font-bold text-gray-700">åç‰‡åœ–ç‰‡</div><div class="text-[10px] text-gray-400">å“ç‰Œåç‰‡ã€åŠŸèƒ½ç¶²æ ¼é¸å–®</div></div>
                </button>
                <button @click="addNewBubble('ecommerce')" class="flex items-center gap-4 p-4 border-2 border-gray-100 rounded-2xl hover:border-line-green hover:bg-green-50 transition-all text-left group">
                    <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600 text-xl group-hover:scale-110 transition-transform"><i class="fas fa-shopping-cart"></i></div>
                    <div><div class="font-bold text-gray-700">é›»å•†å•†å“</div><div class="text-[10px] text-gray-400">å•†åŸå‹æ…‹ã€å¤šå•†å“ç¶²æ ¼èˆ‡é«˜ç´šèƒŒæ™¯</div></div>
                </button>
            </div>
            <button @click="showAddModal = false" class="w-full mt-6 py-2 text-gray-400 font-bold hover:text-gray-600 uppercase text-[10px] tracking-widest">Cancel / å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

/* å¼·åˆ¶ HTTPS ä¿®æ­£ */
const forceHttps = (u) => {
    if (!u || u.trim() === "" || u === "#") return "https://line.me";
    let url = u.trim();
    if (url.startsWith("http://")) return url.replace("http://", "https://");
    if (!url.startsWith("https://") && !url.startsWith("line://")) return "https://" + url;
    return url;
};

createApp({
    setup() {
        const activeIndex = ref(0);
        const showAddModal = ref(false);
        const carousel = ref({ altText: 'æ··åˆå¤šé è¨Šæ¯', bubbles: [{ id: crypto.randomUUID(), type: 'article', imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', aspectRatio: '20:13', title: 'é¦–é ç²¾é¸', subtitle: 'é€™æ˜¯æ‚¨çš„æ··åˆå¤šé è¨Šæ¯ã€‚æ‚¨å¯ä»¥è‡ªç”±æ’åºé é¢ã€‚', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: '', color: '#00B900' }] }] });

        // ä¿®å¾©: ç¢ºä¿ activeBubble æ­£ç¢ºå®šç¾©ä¸¦è¢« setup è¿”å›
        const activeBubble = computed(() => carousel.value.bubbles[activeIndex.value] || null);

        const addNewBubble = (type) => {
            const b = { id: crypto.randomUUID(), type, imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: '', color: '#00B900' }] };
            if (type==='card') { b.headerName='å§“å'; b.headerTitle='ç¨±è™Ÿ'; b.headerImg='https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png'; b.gridButtons=[{emoji:'ğŸ¤–',label:'AI',uri:''},{emoji:'ğŸ›’',label:'è³¼',uri:''},{emoji:'ğŸ§¾',label:'å–®',uri:''},{emoji:'ğŸ“',label:'åœ–',uri:''}]; }
            else if (type==='ecommerce') { b.items=[{title:'å•†å“1',img:'https://lihi.cc/mwMvo',url:''},{title:'å•†å“2',img:'https://lihi.cc/2Nu8G',url:''}]; b.columns=3; b.bgType='color'; b.bgMode='cover'; b.bgColor='#F8F8F8'; b.tagBgColor='#000000'; b.tagTextColor='#FFFFFF'; b.footer={textEnabled:false, text:'', textAlign:'center', textColor:'#666666'}; }
            carousel.value.bubbles.push(b); activeIndex.value = carousel.value.bubbles.length - 1; showAddModal.value = false;
        };

        const removeBubble = (idx) => { if (carousel.value.bubbles.length > 1) { carousel.value.bubbles.splice(idx, 1); if (activeIndex.value >= carousel.value.bubbles.length) activeIndex.value = carousel.value.bubbles.length - 1; } };
        
        // é é¢äº¤æ›åŠŸèƒ½
        const moveLeft = (idx) => { if (idx > 0) { [carousel.value.bubbles[idx], carousel.value.bubbles[idx-1]] = [carousel.value.bubbles[idx-1], carousel.value.bubbles[idx]]; activeIndex.value = idx - 1; } };
        const moveRight = (idx) => { if (idx < carousel.value.bubbles.length - 1) { [carousel.value.bubbles[idx], carousel.value.bubbles[idx+1]] = [carousel.value.bubbles[idx+1], carousel.value.bubbles[idx]]; activeIndex.value = idx + 1; } };

        const fullFlexJson = computed(() => {
            const contents = carousel.value.bubbles.map(b => {
                const bubble = { type: "bubble", size: "mega" };
                if (b.type==='article') bubble.body={type:"box",layout:"vertical",paddingAll:"0px",contents:[{type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:b.aspectRatio,aspectMode:"cover"},{type:"box",layout:"vertical",paddingAll:"20px",contents:[{type:"text",text:b.title||"æ¨™é¡Œ",weight:"bold",size:"xl",wrap:true},{type:"text",text:b.subtitle||"å…§å®¹",size:"sm",margin:"md",color:"#666666",wrap:true}]}]};
                else if (b.type==='card') { bubble.header={type:"box",layout:"horizontal",paddingAll:"8px",backgroundColor:"#1A1B1E",contents:[{type:"image",url:forceHttps(b.headerImg),size:"xs",aspectRatio:"1:1",aspectMode:"cover"},{type:"box",layout:"vertical",flex:3,margin:"md",contents:[{type:"text",text:b.headerName,weight:"bold",color:"#D4AF37"},{type:"text",text:b.headerTitle,size:"xs",color:"#E6E6E6"}]}]}; bubble.hero={type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:"800:500",aspectMode:"cover"}; bubble.body={type:"box",layout:"vertical",backgroundColor:"#0F0F10",paddingAll:"8px",contents:[{type:"box",layout:"horizontal",spacing:"sm",contents:b.gridButtons.slice(0,2).map(g=>({type:"box",layout:"vertical",paddingAll:"8px",backgroundColor:"#2A2C31",cornerRadius:"md",action:{type:"uri",label:g.label,uri:forceHttps(g.uri)},contents:[{type:"text",text:g.emoji,align:"center"},{type:"text",text:g.label,size:"xxs",align:"center",color:"#E6E6E6"}]}))}]}; }
                else if (b.type==='ecommerce') { 
                    const chunk=(a,s)=>Array.from({length:Math.ceil(a.length/s)},(v,i)=>a.slice(i*s,i*s+s)); 
                    const products={type:"box",layout:"vertical",contents:chunk(b.items, b.columns).map((row, rIdx)=>({type:"box",layout:"horizontal",margin:rIdx===0?"none":"sm",contents:row.map(item=>({type:"box",layout:"vertical",width:b.columns===3?"32%":"23%",contents:[{type:"image",url:forceHttps(item.img),aspectRatio:"1:1",aspectMode:"cover"},{type:"box",layout:"vertical",backgroundColor:b.tagBgColor,paddingAll:"xs",contents:[{type:"text",text:item.title,size:"xxxs",color:b.tagTextColor,align:"center"}]}],action:{type:"uri",uri:forceHttps(item.url)}}))}))};
                    bubble.hero={type:"image",url:forceHttps(b.imageUrl),size:"full",aspectRatio:b.aspectRatio||"16:9",aspectMode:"cover"};
                    bubble.body={type:"box",layout:"vertical",paddingAll:"md",backgroundColor:b.bgColor,contents: b.bgType==='image' ? [{type:"image",url:forceHttps(b.bg),position:"absolute",size:"full",aspectMode:b.bgMode==='top'?"width":"cover"},products] : [products]};
                }
                bubble.footer={type:"box",layout:"vertical",spacing:"sm",paddingAll: "10px",contents:b.buttons.map(btn=>({type:"button",style:"primary",height:"sm",color:btn.color,action:{type:"uri",label:btn.label||"æŒ‰éˆ•",uri:forceHttps(btn.uri)}}))};
                return bubble;
            });
            return { type: "carousel", contents };
        });

        const pushMix = () => { if (!liff.isLoggedIn()) { liff.login(); return; } liff.shareTargetPicker([{ type: "flex", altText: carousel.value.altText, contents: fullFlexJson.value }]).then(res => { if (res) alert("å¤šé æ¨æ’­æˆåŠŸï¼"); }).catch(err => alert("ç™¼é€å¤±æ•—ï¼šè«‹ç¢ºèªç¶²å€æ ¼å¼ã€‚")); };

        onMounted(async () => { try { await liff.init({ liffId: "2008541971-Wgvz6gD8" }); if (window.lucide) window.lucide.createIcons(); } catch (e) {} });

        return { carousel, activeIndex, activeBubble, showAddModal, addNewBubble, removeBubble, moveLeft, moveRight, pushMix, getTypeName: (t) => ({'article':'æ–‡ç« å‹','card':'åç‰‡åœ–ç‰‡','ecommerce':'é›»å•†å•†å“'}[t]), getTypeIcon: (t) => ({'article':'fa-file-alt','card':'fa-id-card','ecommerce':'fa-shopping-cart'}[t]), fullFlexJson, getAspectClass: (a) => ({ '1:1':'aspect-1-1','16:9':'aspect-16-9','20:13':'aspect-20-13'}[a] || 'aspect-16-9') };
    }
}).component('json-viewer', { props: ['json'], template: `<div class="mt-8 mb-4"><span class="input-label">Carousel JSON é è¦½</span><div class="bg-gray-50 rounded-xl p-4 border overflow-hidden"><pre class="text-[10px] text-gray-600 h-24 overflow-y-auto no-scrollbar font-mono">{{ JSON.stringify(json, null, 2) }}</pre></div></div>` }).mount('#app');
</script>
</body>
</html>
