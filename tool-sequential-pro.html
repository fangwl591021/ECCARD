<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequential Pro - 修正版 v2.9.1</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; margin: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #06C755; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .chat-room-bg { background-color: #7988a0; background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
        .control-panel { background: white; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .master-slider { accent-color: #f59e0b; height: 10px; }
        .preview-text-multiline { white-space: pre-wrap; word-break: break-all; }
        input, select, textarea, button { font-size: 14px !important; }
        .color-input-group { display: flex; align-items: center; gap: 8px; }
        .color-preview { width: 36px; height: 36px; border-radius: 6px; border: 2px solid #e2e8f0; cursor: pointer; }
        .hex-input { font-family: 'Courier New', monospace; letter-spacing: 1px; }
        .section-title { font-size: 15px; font-weight: 900; }
        .control-label { font-size: 13px; font-weight: 700; color: #475569; }
        .social-icon-container { transition: all 0.2s; }
        .social-icon-container:hover { transform: scale(1.05); }
        .slider-value-display { font-size: 12px; font-weight: 900; background: #f59e0b; color: white; padding: 2px 8px; border-radius: 10px; }
        .sticky-section { position: sticky; top: 0; background: white; z-index: 10; padding-top: 10px; padding-bottom: 10px; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid #e2e8f0; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // 常數定義
        const CONSTANTS = {
            SOCIAL_DATA: {
                NONE: { url: "https://vos.line-scdn.net/bot-designer-template-images/bot-designer-icon.png", label: "無" },
                FB: { url: "https://cdn-icons-png.flaticon.com/512/733/733547.png", label: "Facebook" },
                IG: { url: "https://cdn-icons-png.flaticon.com/512/2111/2111463.png", label: "Instagram" },
                TIKTOK: { url: "https://cdn-icons-png.flaticon.com/512/3046/3046121.png", label: "TikTok" },
                LINE: { url: "https://cdn-icons-png.flaticon.com/512/124/124027.png", label: "LINE" },
                PHONE: { url: "https://cdn-icons-png.flaticon.com/512/3616/3616215.png", label: "電話" },
                MAIL: { url: "https://cdn-icons-png.flaticon.com/512/732/732200.png", label: "Email" },
                MAP: { url: "https://cdn-icons-png.flaticon.com/512/355/355980.png", label: "地圖" }
            },
            RADIUS_OPTIONS: [
                { value: "none", label: "無圓角" },
                { value: "xs", label: "小圓角" },
                { value: "sm", label: "中小圓角" },
                { value: "md", label: "中圓角" },
                { value: "lg", label: "大圓角" },
                { value: "xl", label: "超大圓角" },
                { value: "xxl", label: "最大圓角" }
            ],
            DEFAULT_DATA: {
                url: "https://aiwe.cc/wp-content/uploads/2025/12/cf75e54791dd1f49f918345fdfe2430b.png",
                animated: false,
                badgeText: "PREMIUM",
                badgeBg: "#D4AF37",
                badgeRadius: "xs",
                badgeTop: 20,
                badgePos: "offsetEnd",
                avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200",
                avatarTop: 60,
                avatarAnimated: false,
                name: "張志明",
                nameTop: 155,
                nameColor: "#000000",
                nameWeight: "bold",
                label1: "行銷總監 / 品牌顧問",
                label1Top: 190,
                label1Bg: "#FFFFFF33",
                label1Color: "#000000",
                label1Weight: "bold",
                desc: "致力於協助企業品牌數位轉型\n擁有超過 15 年的跨國行銷經驗",
                descTop: 275,
                descColor: "#000000",
                descWeight: "regular",
                descAlign: "center",
                socialTop: 215,
                icons: [
                    { type: "PHONE", uri: "tel:0900000000" },
                    { type: "LINE", uri: "https://line.me/R/ti/p/@example" }
                ],
                footerBg: "#111111",
                footerLabel: "聯繫我了解更多",
                footerUri: "https://line.me",
                footerThemeColor: "#D4AF37",
                footerTextColor: "#000000",
                footerWeight: "bold"
            }
        };

        // 工具函數
        const Utils = {
            cleanUri: (uri) => {
                if (!uri || typeof uri !== 'string') return "https://line.me";
                const trimmed = uri.trim();
                if (trimmed === "" || trimmed === "https://" || trimmed === "http://") return "https://line.me";
                if (trimmed.startsWith('tel:') || trimmed.startsWith('mailto:') || 
                    trimmed.startsWith('https://') || trimmed.startsWith('http://')) {
                    return trimmed;
                }
                return `https://${trimmed}`;
            },
            
            toPx: (val) => {
                const s = String(val);
                return s.endsWith('px') ? s : `${s}px`;
            },
            
            updateNestedState: (prev, path, value) => {
                const next = { ...prev };
                const keys = path.split('.');
                let current = next;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    if (!current[keys[i]] || typeof current[keys[i]] !== 'object') {
                        current[keys[i]] = {};
                    } else {
                        current[keys[i]] = { ...current[keys[i]] };
                    }
                    current = current[keys[i]];
                }
                
                current[keys[keys.length - 1]] = value;
                return next;
            },
            
            isValidHex: (color) => {
                return /^#[0-9A-F]{6}$/i.test(color);
            },
            
            rgbaToHex: (rgba) => {
                if (rgba.startsWith('#')) return rgba;
                if (rgba.startsWith('rgba')) {
                    const match = rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
                    if (match) {
                        const r = parseInt(match[1]).toString(16).padStart(2, '0');
                        const g = parseInt(match[2]).toString(16).padStart(2, '0');
                        const b = parseInt(match[3]).toString(16).padStart(2, '0');
                        return `#${r}${g}${b}`.toUpperCase();
                    }
                }
                return "#000000";
            },
            
            hexToRgba: (hex, alpha = 1) => {
                if (!hex || !hex.startsWith('#')) return hex;
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return alpha < 1 ? `rgba(${r}, ${g}, ${b}, ${alpha})` : `rgb(${r}, ${g}, ${b})`;
            }
        };

        // 主要組件
        const App = () => {
            const [data, setData] = useState(CONSTANTS.DEFAULT_DATA);
            const [activeTab, setActiveTab] = useState('editor');
            const leftPanelRef = useRef(null);

            // 更新數據的簡化函數 - 不觸發滾動重置
            const updateData = useCallback((path, value) => {
                setData(prev => {
                    const newData = Utils.updateNestedState(prev, path, value);
                    // 即時同步到父窗口
                    setTimeout(() => {
                        const json = buildJsonFromData(newData);
                        window.parent.postMessage({ 
                            type: 'SYNC_FLEX_DATA', 
                            json: JSON.stringify(json)
                        }, '*');
                    }, 0);
                    return newData;
                });
            }, []);

            // 直接從數據生成 JSON（避免依賴問題）
            const buildJsonFromData = useCallback((currentData) => {
                const d = currentData || data;
                const SOCIAL = CONSTANTS.SOCIAL_DATA;
                
                return {
                    type: "bubble",
                    size: "mega",
                    body: {
                        type: "box",
                        layout: "vertical",
                        paddingAll: "0px",
                        contents: [
                            {
                                type: "image",
                                url: d.url || SOCIAL.NONE.url,
                                size: "full",
                                aspectRatio: "2:3",
                                aspectMode: "cover",
                                animated: !!d.animated
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.badgeTop),
                                [d.badgePos === 'offsetStart' ? 'offsetStart' : 'offsetEnd']: "20px",
                                backgroundColor: d.badgeBg || "#000000",
                                cornerRadius: d.badgeRadius || "xs",
                                paddingAll: "2px",
                                paddingStart: "8px",
                                paddingEnd: "8px",
                                contents: [{
                                    type: "text",
                                    text: d.badgeText || "TAG",
                                    color: "#ffffff",
                                    size: "xxs",
                                    weight: "bold"
                                }]
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.avatarTop),
                                offsetStart: "0px",
                                offsetEnd: "0px",
                                alignItems: "center",
                                contents: [{
                                    type: "box",
                                    layout: "vertical",
                                    width: "85px",
                                    height: "85px",
                                    cornerRadius: "100px",
                                    borderWidth: "3px",
                                    borderColor: "#ffffff",
                                    contents: [{
                                        type: "image",
                                        url: d.avatar || SOCIAL.NONE.url,
                                        size: "full",
                                        aspectMode: "cover",
                                        animated: !!d.avatarAnimated
                                    }]
                                }]
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.nameTop),
                                offsetStart: "0px",
                                offsetEnd: "0px",
                                contents: [{
                                    type: "text",
                                    text: d.name || "姓名",
                                    weight: d.nameWeight || "bold",
                                    size: "xxl",
                                    color: d.nameColor || "#000000",
                                    align: "center"
                                }]
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.label1Top),
                                offsetStart: "40px",
                                offsetEnd: "40px",
                                backgroundColor: d.label1Bg || "#FFFFFF33",
                                cornerRadius: "md",
                                paddingAll: "4px",
                                contents: [{
                                    type: "text",
                                    text: d.label1 || "職稱",
                                    size: "xs",
                                    color: d.label1Color || "#000000",
                                    align: "center",
                                    weight: d.label1Weight || "bold"
                                }]
                            },
                            {
                                type: "box",
                                layout: "horizontal",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.socialTop),
                                offsetStart: "0px",
                                offsetEnd: "0px",
                                justifyContent: "center",
                                spacing: "md",
                                contents: (d.icons || []).map(icon => ({
                                    type: "box",
                                    layout: "vertical",
                                    width: "50px",
                                    height: "50px",
                                    cornerRadius: "100px",
                                    backgroundColor: "#ffffff1a",
                                    paddingAll: "10px",
                                    action: {
                                        type: "uri",
                                        uri: Utils.cleanUri(icon.uri)
                                    },
                                    contents: [{
                                        type: "image",
                                        url: SOCIAL[icon.type]?.url || SOCIAL.NONE.url,
                                        size: "full"
                                    }]
                                }))
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                position: "absolute",
                                offsetTop: Utils.toPx(d.descTop),
                                offsetStart: "10px",
                                offsetEnd: "10px",
                                contents: [{
                                    type: "text",
                                    text: d.desc || " ",
                                    wrap: true,
                                    size: "sm",
                                    color: d.descColor || "#000000",
                                    align: d.descAlign || "center",
                                    lineHeight: "1.6",
                                    weight: d.descWeight || "regular"
                                }]
                            }
                        ]
                    },
                    footer: {
                        type: "box",
                        layout: "vertical",
                        paddingAll: "15px",
                        backgroundColor: d.footerBg || "#111111",
                        contents: [{
                            type: "box",
                            layout: "vertical",
                            backgroundColor: d.footerThemeColor || "#D4AF37",
                            paddingAll: "12px",
                            cornerRadius: "md",
                            action: {
                                type: "uri",
                                uri: Utils.cleanUri(d.footerUri)
                            },
                            contents: [{
                                type: "text",
                                text: d.footerLabel || "聯繫我",
                                color: d.footerTextColor || "#000000",
                                align: "center",
                                weight: d.footerWeight || "bold",
                                size: "sm"
                            }]
                        }]
                    }
                };
            }, [data]);

            // 主連動位移函數
            const handleMasterMove = (newAvatarTop) => {
                const diff = newAvatarTop - data.avatarTop;
                setData(prev => {
                    const newData = {
                        ...prev,
                        avatarTop: newAvatarTop,
                        nameTop: prev.nameTop + diff,
                        label1Top: prev.label1Top + diff,
                        socialTop: prev.socialTop + diff,
                        descTop: prev.descTop + diff
                    };
                    
                    // 即時同步
                    setTimeout(() => {
                        const json = buildJsonFromData(newData);
                        window.parent.postMessage({ 
                            type: 'SYNC_FLEX_DATA', 
                            json: JSON.stringify(json)
                        }, '*');
                    }, 0);
                    
                    return newData;
                });
            };

            // 與父窗口通信
            useEffect(() => {
                const handleMessage = (e) => {
                    if (e.data?.type === 'LOAD_FLEX_DATA') {
                        try {
                            const saved = e.data.json;
                            if (saved) {
                                const parsed = JSON.parse(saved);
                                if (parsed && typeof parsed === 'object') {
                                    setData(prev => ({ ...CONSTANTS.DEFAULT_DATA, ...parsed }));
                                }
                            } else {
                                setData(CONSTANTS.DEFAULT_DATA);
                            }
                        } catch (err) {
                            console.warn('載入數據失敗，使用預設值');
                            setData(CONSTANTS.DEFAULT_DATA);
                        }
                    }
                };

                window.addEventListener('message', handleMessage);
                window.parent.postMessage({ type: 'CHILD_READY' }, '*');
                
                return () => window.removeEventListener('message', handleMessage);
            }, []);

            // 初始化圖標
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [data, activeTab]);

            // 預覽組件
            const Preview = () => {
                const scale = 300 / 400;
                const socialIcons = CONSTANTS.SOCIAL_DATA;
                
                return (
                    <div className="flex justify-center p-4 min-h-full">
                        <div className="rounded-[45px] shadow-2xl overflow-hidden relative border-[10px] border-black bg-white w-[300px]">
                            <div className="relative h-[450px] overflow-hidden">
                                <img src={data.url} className="w-full h-full object-cover" alt="背景" />
                                
                                {/* 徽章 */}
                                <div className="absolute px-3 py-1 text-white font-bold rounded shadow-sm text-[10px]" style={{ 
                                    top: '15px', 
                                    [data.badgePos === 'offsetStart' ? 'left' : 'right']: '15px', 
                                    backgroundColor: data.badgeBg,
                                    borderRadius: data.badgeRadius === 'none' ? '0' : 
                                        data.badgeRadius === 'xs' ? '2px' : 
                                        data.badgeRadius === 'sm' ? '4px' : 
                                        data.badgeRadius === 'md' ? '6px' : 
                                        data.badgeRadius === 'lg' ? '8px' : 
                                        data.badgeRadius === 'xl' ? '12px' : '16px'
                                }}>
                                    {data.badgeText}
                                </div>
                                
                                {/* 頭像 */}
                                <div className="absolute w-full flex justify-center" style={{ top: (data.avatarTop * scale) + 'px' }}>
                                    <img src={data.avatar} className="w-16 h-16 rounded-full border-2 border-white shadow-xl" alt="頭像" />
                                </div>
                                
                                {/* 姓名 */}
                                <div className="absolute w-full text-center px-4" style={{ 
                                    top: (data.nameTop * scale) + 'px', 
                                    color: data.nameColor, 
                                    fontWeight: 900, 
                                    fontSize: '18px' 
                                }}>
                                    {data.name}
                                </div>
                                
                                {/* 職稱 */}
                                <div className="absolute w-full px-10" style={{ top: (data.label1Top * scale) + 'px' }}>
                                    <div className="py-1.5 rounded text-[11px] text-center font-black shadow-sm" style={{ 
                                        backgroundColor: data.label1Bg, 
                                        color: data.label1Color 
                                    }}>
                                        {data.label1}
                                    </div>
                                </div>
                                
                                {/* 社群按鈕 */}
                                <div className="absolute w-full flex justify-center gap-3" style={{ top: (data.socialTop * scale) + 'px' }}>
                                    {data.icons.map((icon, i) => (
                                        <div key={i} className="social-icon-container w-11 h-11 p-2 bg-white/25 rounded-full border border-white/40 flex items-center justify-center shadow-md backdrop-blur-sm">
                                            <img src={socialIcons[icon.type]?.url} className="w-full h-full object-contain" alt="社群圖標" />
                                        </div>
                                    ))}
                                </div>
                                
                                {/* 描述 */}
                                <div className="absolute w-full px-4" style={{ 
                                    top: (data.descTop * scale) + 'px', 
                                    textAlign: data.descAlign 
                                }}>
                                    <p className="text-[12px] preview-text-multiline leading-relaxed" style={{ 
                                        color: data.descColor, 
                                        fontWeight: data.descWeight === 'bold' ? 900 : 400 
                                    }}>
                                        {data.desc}
                                    </p>
                                </div>
                            </div>
                            
                            {/* 底部按鈕 */}
                            <div className="p-4" style={{ backgroundColor: data.footerBg }}>
                                <div className="py-3.5 text-center rounded-xl text-[13px] font-black shadow-md" style={{ 
                                    backgroundColor: data.footerThemeColor, 
                                    color: data.footerTextColor 
                                }}>
                                    {data.footerLabel}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // 控制面板組件
            const ControlPanel = ({ title, icon, children, className = "" }) => (
                <div className={`control-panel space-y-4 ${className}`}>
                    <h3 className="section-title flex items-center gap-2 text-slate-800">
                        <i data-lucide={icon} className="w-5 h-5"></i> {title}
                    </h3>
                    {children}
                </div>
            );

            // 顏色輸入組件（固定十六進位顯示）
            const ColorInput = ({ label, value, onChange, isRgba = false, className = "" }) => {
                const [hexValue, setHexValue] = useState(Utils.rgbaToHex(value));
                const [showPicker, setShowPicker] = useState(false);

                useEffect(() => {
                    setHexValue(Utils.rgbaToHex(value));
                }, [value]);

                const handleHexChange = (e) => {
                    let newValue = e.target.value.toUpperCase();
                    
                    // 確保格式正確
                    if (!newValue.startsWith('#')) {
                        newValue = '#' + newValue;
                    }
                    
                    // 限制長度為7 (#RRGGBB)
                    newValue = newValue.substring(0, 7);
                    setHexValue(newValue);
                    
                    // 如果是有效的十六進位顏色，就更新
                    if (Utils.isValidHex(newValue)) {
                        if (isRgba) {
                            onChange(newValue + '33'); // 加上透明度
                        } else {
                            onChange(newValue);
                        }
                    }
                };

                const handlePickerChange = (e) => {
                    const newHex = e.target.value.toUpperCase();
                    setHexValue(newHex);
                    if (isRgba) {
                        onChange(newHex + '33');
                    } else {
                        onChange(newHex);
                    }
                };

                const togglePicker = () => {
                    setShowPicker(!showPicker);
                };

                return (
                    <div className={`space-y-2 ${className}`}>
                        <label className="control-label block">{label}</label>
                        <div className="flex items-center gap-3">
                            <div className="relative">
                                <div 
                                    className="color-preview hover:border-slate-400 transition-colors"
                                    style={{ backgroundColor: hexValue }}
                                    onClick={togglePicker}
                                    title="點擊開啟調色盤"
                                >
                                    {showPicker && (
                                        <div className="absolute top-full left-0 mt-2 z-50">
                                            <input
                                                type="color"
                                                value={hexValue}
                                                onChange={handlePickerChange}
                                                className="w-32 h-32 cursor-pointer"
                                                onClick={(e) => e.stopPropagation()}
                                            />
                                        </div>
                                    )}
                                </div>
                            </div>
                            <div className="flex-1">
                                <input
                                    type="text"
                                    value={hexValue}
                                    onChange={handleHexChange}
                                    className="hex-input w-full p-3 border border-slate-300 rounded text-sm font-mono"
                                    placeholder="#000000"
                                    maxLength="7"
                                />
                                <div className="text-xs text-slate-500 mt-1">十六進位色碼</div>
                            </div>
                        </div>
                    </div>
                );
            };

            // 社群按鈕輸入組件
            const SocialIconInput = ({ index, icon, updateData }) => {
                const [isExpanded, setIsExpanded] = useState(false);

                return (
                    <div className="social-icon-container bg-slate-50 p-3 rounded-lg border border-slate-200 space-y-2">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 p-1.5 bg-white rounded-full border border-slate-300">
                                    <img src={CONSTANTS.SOCIAL_DATA[icon.type]?.url} className="w-full h-full object-contain" alt="圖標" />
                                </div>
                                <span className="font-bold text-sm">
                                    {CONSTANTS.SOCIAL_DATA[icon.type]?.label}
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <button 
                                    onClick={() => setIsExpanded(!isExpanded)} 
                                    className="text-slate-500 hover:text-slate-700"
                                >
                                    <i data-lucide={isExpanded ? "chevron-up" : "chevron-down"} className="w-4 h-4"></i>
                                </button>
                                <button 
                                    onClick={() => {
                                        const newIcons = data.icons.filter((_, i) => i !== index);
                                        updateData('icons', newIcons);
                                    }} 
                                    className="text-red-500 hover:text-red-700"
                                >
                                    <i data-lucide="trash-2" className="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        
                        {isExpanded && (
                            <div className="pt-2 space-y-2 border-t border-slate-200">
                                <div>
                                    <label className="control-label block mb-2">社群平台</label>
                                    <select 
                                        value={icon.type} 
                                        onChange={e => {
                                            const newIcons = [...data.icons];
                                            newIcons[index].type = e.target.value;
                                            updateData('icons', newIcons);
                                        }} 
                                        className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                    >
                                        {Object.keys(CONSTANTS.SOCIAL_DATA).map(key => (
                                            <option key={key} value={key}>{CONSTANTS.SOCIAL_DATA[key].label}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="control-label block mb-2">連結網址</label>
                                    <input 
                                        type="text" 
                                        value={icon.uri} 
                                        onChange={e => {
                                            const newIcons = [...data.icons];
                                            newIcons[index].uri = e.target.value;
                                            updateData('icons', newIcons);
                                        }} 
                                        className="w-full p-3 border border-slate-300 rounded text-sm font-mono" 
                                        placeholder="tel:0912345678 或 https://..." 
                                    />
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // 滑桿組件
            const SliderInput = ({ label, value, min, max, onChange, unit = "px" }) => (
                <div className="space-y-2">
                    <div className="flex justify-between items-center">
                        <label className="control-label">{label}</label>
                        <span className="slider-value-display">{value}{unit}</span>
                    </div>
                    <input
                        type="range"
                        min={min}
                        max={max}
                        value={value}
                        onChange={(e) => onChange(parseInt(e.target.value))}
                        className="w-full master-slider"
                    />
                </div>
            );

            // 簡單文字輸入組件
            const TextInput = ({ label, value, onChange, placeholder, type = "text", className = "" }) => (
                <div className={`space-y-2 ${className}`}>
                    <label className="control-label block">{label}</label>
                    <input
                        type={type}
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        className="w-full p-3 border border-slate-300 rounded text-sm"
                        placeholder={placeholder}
                    />
                </div>
            );

            return (
                <div className="flex h-screen bg-slate-100 overflow-hidden">
                    {/* 左側控制面板 */}
                    <div className="w-1/2 bg-white border-r border-slate-300 flex flex-col shadow-lg">
                        <div className="sticky-section">
                            <h1 className="text-2xl font-black text-slate-800 flex items-center gap-3">
                                <i data-lucide="award" className="w-8 h-8 text-green-600"></i> 
                                <span>Sequential Pro Master</span>
                                <span className="text-xs font-normal bg-green-100 text-green-800 px-2 py-1 rounded">v2.9.1</span>
                            </h1>
                        </div>
                        
                        <div 
                            ref={leftPanelRef}
                            className="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar"
                            style={{ scrollBehavior: 'smooth' }}
                        >
                            {/* 1. 底圖與標籤 */}
                            <ControlPanel title="1. 底圖與標籤設定" icon="image">
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <label className="control-label">底圖設定</label>
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={data.animated} 
                                                onChange={e => updateData('animated', e.target.checked)} 
                                                className="w-5 h-5 accent-green-600"
                                            />
                                            <span className="text-sm font-bold text-green-600">動畫圖片</span>
                                        </label>
                                    </div>
                                    
                                    <TextInput 
                                        label="底圖網址" 
                                        value={data.url} 
                                        onChange={(value) => updateData('url', value)} 
                                        placeholder="https://example.com/image.jpg" 
                                    />
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <TextInput 
                                            label="標籤文字" 
                                            value={data.badgeText} 
                                            onChange={(value) => updateData('badgeText', value)} 
                                            placeholder="PREMIUM" 
                                        />
                                        <div>
                                            <label className="control-label block mb-2">圓角樣式</label>
                                            <select 
                                                value={data.badgeRadius} 
                                                onChange={e => updateData('badgeRadius', e.target.value)} 
                                                className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                            >
                                                {CONSTANTS.RADIUS_OPTIONS.map(opt => (
                                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <ColorInput 
                                            label="標籤背景色" 
                                            value={data.badgeBg} 
                                            onChange={(value) => updateData('badgeBg', value)} 
                                        />
                                        <div>
                                            <label className="control-label block mb-2">標籤位置</label>
                                            <select 
                                                value={data.badgePos} 
                                                onChange={e => updateData('badgePos', e.target.value)} 
                                                className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                            >
                                                <option value="offsetStart">靠左顯示</option>
                                                <option value="offsetEnd">靠右顯示</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </ControlPanel>

                            {/* 2. 連動位移 */}
                            <div className="control-panel border-l-4 border-amber-500 bg-gradient-to-r from-amber-50 to-white">
                                <h3 className="section-title flex items-center gap-2 text-amber-700">
                                    <i data-lucide="move-vertical" className="w-5 h-5"></i> 2. 主控連動位移
                                </h3>
                                <div className="space-y-4">
                                    <SliderInput 
                                        label="所有元素垂直位置" 
                                        value={data.avatarTop} 
                                        min={0} 
                                        max={800} 
                                        onChange={handleMasterMove} 
                                    />
                                    <div className="text-xs text-slate-500 bg-slate-100 p-3 rounded">
                                        <div className="font-bold mb-1">連動說明：</div>
                                        <div>調整此滑桿會同步移動所有相關元素的位置，包括：</div>
                                        <div className="grid grid-cols-2 gap-1 mt-1">
                                            <div>• 頭像位置</div>
                                            <div>• 姓名位置</div>
                                            <div>• 職稱位置</div>
                                            <div>• 社群按鈕</div>
                                            <div>• 描述文字</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 3. 身份資料設定 */}
                            <ControlPanel title="3. 身份資料設定" icon="user">
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <label className="control-label">頭像設定</label>
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={data.avatarAnimated} 
                                                onChange={e => updateData('avatarAnimated', e.target.checked)} 
                                                className="w-5 h-5 accent-green-600"
                                            />
                                            <span className="text-sm font-bold text-green-600">動畫頭像</span>
                                        </label>
                                    </div>
                                    
                                    <TextInput 
                                        label="頭像網址" 
                                        value={data.avatar} 
                                        onChange={(value) => updateData('avatar', value)} 
                                        placeholder="https://example.com/avatar.jpg" 
                                    />
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <TextInput 
                                            label="姓名" 
                                            value={data.name} 
                                            onChange={(value) => updateData('name', value)} 
                                            placeholder="姓名" 
                                        />
                                        <ColorInput 
                                            label="姓名顏色" 
                                            value={data.nameColor} 
                                            onChange={(value) => updateData('nameColor', value)} 
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="control-label block mb-2">姓名粗細</label>
                                        <select 
                                            value={data.nameWeight} 
                                            onChange={e => updateData('nameWeight', e.target.value)} 
                                            className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                        >
                                            <option value="bold">粗體文字</option>
                                            <option value="regular">一般文字</option>
                                        </select>
                                    </div>
                                    
                                    <div className="border-t border-slate-200 pt-4 space-y-4">
                                        <TextInput 
                                            label="職稱/頭銜" 
                                            value={data.label1} 
                                            onChange={(value) => updateData('label1', value)} 
                                            placeholder="行銷總監 / 品牌顧問" 
                                        />
                                        
                                        <div className="grid grid-cols-3 gap-4">
                                            <ColorInput 
                                                label="文字顏色" 
                                                value={data.label1Color} 
                                                onChange={(value) => updateData('label1Color', value)} 
                                            />
                                            <ColorInput 
                                                label="背景顏色" 
                                                value={data.label1Bg} 
                                                onChange={(value) => updateData('label1Bg', value, true)} 
                                                isRgba={true}
                                            />
                                            <div>
                                                <label className="control-label block mb-2">文字粗細</label>
                                                <select 
                                                    value={data.label1Weight} 
                                                    onChange={e => updateData('label1Weight', e.target.value)} 
                                                    className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                                >
                                                    <option value="bold">粗體文字</option>
                                                    <option value="regular">一般文字</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ControlPanel>

                            {/* 4. 社群按鈕 */}
                            <ControlPanel title="4. 社群連結設定" icon="share-2">
                                <div className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <label className="control-label">社群媒體連結</label>
                                        <button 
                                            onClick={() => {
                                                if (data.icons.length < 6) {
                                                    updateData('icons', [...data.icons, { type: 'LINE', uri: 'https://line.me' }]);
                                                }
                                            }} 
                                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                                            disabled={data.icons.length >= 6}
                                        >
                                            <i data-lucide="plus" className="w-4 h-4"></i>
                                            <span className="text-sm font-bold">新增社群按鈕</span>
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        {data.icons.map((icon, i) => (
                                            <SocialIconInput 
                                                key={i} 
                                                index={i} 
                                                icon={icon} 
                                                updateData={updateData}
                                            />
                                        ))}
                                    </div>
                                    
                                    {data.icons.length === 0 && (
                                        <div className="text-center py-8 text-slate-400 border-2 border-dashed border-slate-300 rounded-lg">
                                            <i data-lucide="share-2" className="w-12 h-12 mx-auto mb-3"></i>
                                            <div className="font-bold mb-1">尚未設定社群連結</div>
                                            <div className="text-sm">點擊上方按鈕新增社群媒體連結</div>
                                        </div>
                                    )}
                                    
                                    {data.icons.length >= 6 && (
                                        <div className="text-amber-600 bg-amber-50 p-3 rounded text-sm">
                                            <i data-lucide="alert-circle" className="w-4 h-4 inline mr-2"></i>
                                            已達最大社群按鈕數量（6個）
                                        </div>
                                    )}
                                </div>
                            </ControlPanel>

                            {/* 5. 說明區設定 */}
                            <ControlPanel title="5. 說明文字設定" icon="align-left">
                                <div className="space-y-4">
                                    <div>
                                        <label className="control-label block mb-2">文字對齊</label>
                                        <div className="flex bg-slate-100 p-1 rounded-lg gap-1">
                                            {[
                                                { value: 'start', label: '靠左', icon: 'align-left' },
                                                { value: 'center', label: '置中', icon: 'align-center' },
                                                { value: 'end', label: '靠右', icon: 'align-right' }
                                            ].map(align => (
                                                <button 
                                                    key={align.value}
                                                    onClick={() => updateData('descAlign', align.value)} 
                                                    className={`flex-1 py-3 rounded-lg flex flex-col items-center justify-center gap-1 ${data.descAlign === align.value ? 'bg-white shadow text-green-600' : 'text-slate-500'}`}
                                                >
                                                    <i data-lucide={align.icon} className="w-4 h-4"></i>
                                                    <span className="text-xs font-bold">{align.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="control-label block mb-2">介紹內容</label>
                                        <textarea 
                                            value={data.desc} 
                                            onChange={e => updateData('desc', e.target.value)} 
                                            className="w-full p-3 border border-slate-300 rounded-lg text-sm h-32" 
                                            placeholder="輸入介紹內容...（支援多行）"
                                            rows="4"
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <ColorInput 
                                            label="文字顏色" 
                                            value={data.descColor} 
                                            onChange={(value) => updateData('descColor', value)} 
                                        />
                                        <div>
                                            <label className="control-label block mb-2">文字粗細</label>
                                            <select 
                                                value={data.descWeight} 
                                                onChange={e => updateData('descWeight', e.target.value)} 
                                                className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                            >
                                                <option value="regular">一般文字</option>
                                                <option value="bold">粗體文字</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </ControlPanel>

                            {/* 6. 底部按鈕設定 */}
                            <ControlPanel title="6. 底部按鈕設定" icon="mouse-pointer-2">
                                <div className="space-y-4">
                                    <ColorInput 
                                        label="底部背景顏色" 
                                        value={data.footerBg} 
                                        onChange={(value) => updateData('footerBg', value)} 
                                    />
                                    
                                    <TextInput 
                                        label="按鈕文字" 
                                        value={data.footerLabel} 
                                        onChange={(value) => updateData('footerLabel', value)} 
                                        placeholder="聯繫我了解更多" 
                                    />
                                    
                                    <TextInput 
                                        label="按鈕連結" 
                                        value={data.footerUri} 
                                        onChange={(value) => updateData('footerUri', value)} 
                                        placeholder="https://line.me 或 tel:0912345678" 
                                    />
                                    
                                    <div className="grid grid-cols-3 gap-4">
                                        <ColorInput 
                                            label="按鈕背景色" 
                                            value={data.footerThemeColor} 
                                            onChange={(value) => updateData('footerThemeColor', value)} 
                                        />
                                        <ColorInput 
                                            label="按鈕文字色" 
                                            value={data.footerTextColor} 
                                            onChange={(value) => updateData('footerTextColor', value)} 
                                        />
                                        <div>
                                            <label className="control-label block mb-2">文字粗細</label>
                                            <select 
                                                value={data.footerWeight} 
                                                onChange={e => updateData('footerWeight', e.target.value)} 
                                                className="w-full p-3 border border-slate-300 rounded text-sm bg-white"
                                            >
                                                <option value="bold">粗體文字</option>
                                                <option value="regular">一般文字</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </ControlPanel>
                        </div>
                    </div>

                    {/* 右側預覽區域 */}
                    <div className="flex-1 flex flex-col chat-room-bg overflow-hidden">
                        <div className="h-[80px] bg-white border-b border-slate-300 flex items-center px-10 gap-10 shrink-0">
                            <TabButton active={activeTab === 'editor'} onClick={() => setActiveTab('editor')} icon="eye">
                                視覺預覽
                            </TabButton>
                            <TabButton active={activeTab === 'json'} onClick={() => setActiveTab('json')} icon="code">
                                JSON 代碼
                            </TabButton>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto custom-scrollbar">
                            {activeTab === 'editor' ? (
                                <div className="py-12 flex flex-col items-center">
                                    <div className="mb-8 px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-500 text-white rounded-full text-sm tracking-wider font-black uppercase shadow-lg">
                                        <i data-lucide="smartphone" className="w-4 h-4 inline mr-2"></i>
                                        LINE Flex 即時預覽模式
                                    </div>
                                    <Preview />
                                </div>
                            ) : (
                                <div className="p-10">
                                    <div className="mb-6 flex items-center justify-between">
                                        <div>
                                            <h3 className="text-xl font-black text-white mb-1">LINE Flex Message JSON</h3>
                                            <p className="text-slate-300">可直接複製到 LINE Developers 使用</p>
                                        </div>
                                        <button 
                                            onClick={() => {
                                                const json = JSON.stringify(buildJsonFromData(), null, 2);
                                                navigator.clipboard.writeText(json);
                                            }}
                                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                                        >
                                            <i data-lucide="copy" className="w-4 h-4"></i>
                                            <span className="font-bold">複製 JSON</span>
                                        </button>
                                    </div>
                                    <pre className="bg-slate-900 p-8 rounded-2xl text-green-400 text-sm overflow-x-auto leading-relaxed shadow-2xl border border-white/10 font-mono">
                                        {JSON.stringify(buildJsonFromData(), null, 2)}
                                    </pre>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 可複用的小組件
        const TabButton = ({ active, onClick, children, icon }) => (
            <button 
                onClick={onClick} 
                className={`h-full border-b-2 flex items-center gap-3 transition-all text-lg font-bold px-2 ${active ? 'text-green-600 border-green-600' : 'text-slate-500 border-transparent hover:text-slate-700'}`}
            >
                <i data-lucide={icon} className={`w-5 h-5 ${active ? 'text-green-600' : 'text-slate-400'}`}></i>
                {children}
            </button>
        );

        // 渲染應用
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
