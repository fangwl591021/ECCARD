<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINEOA æ’ä»¶ç®¡ç†å¹³å°</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        
        /* å´é‚Šæ¬„æ¨£å¼ */
        .sidebar-container { background-color: #1e2124; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); height: 100vh; display: flex; flex-direction: column; flex-shrink: 0; overflow: hidden; z-index: 50; }
        .w-expanded { width: 256px !important; }
        .w-collapsed { width: 80px !important; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        .submenu-item-active { color: #00B900; font-weight: bold; }
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        .preview-window { width: 300px; height: 560px; background: #0F0F10; border: 10px solid #333; border-radius: 32px; overflow-y: auto; position: relative; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); }
        .preview-window::-webkit-scrollbar { width: 0px; }
        .flex-bubble { background: #FFFFFF; border-radius: 12px; overflow: hidden; width: 250px; margin: 0 auto; border: 1px solid #333; }
        .flex-bubble-dark { background: #1F2024; color: white; }
        .flex-badge { position: absolute; top: 10px; right: 10px; color: white; padding: 2px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; z-index: 20; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
        
        .header-box { padding: 10px; display: flex; align-items: center; gap: 10px; }
        .video-hero { position: relative; background: #000; width: 100%; aspect-ratio: 800/500; display: flex; align-items: center; justify-content: center; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .grid-item { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; text-align: center; }

        .chat-room-bg { background-color: #7988a0; width: 100%; height: 100%; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .flex-bubble-container { width: 100%; max-width: 350px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        
        .ratio-btn { @apply px-3 py-1 text-xs border border-gray-200 rounded-md transition-all cursor-pointer bg-white hover:border-line-green; }
        .ratio-btn-active { @apply border-line-green bg-green-50 text-line-green font-bold shadow-sm; }
        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 26px; height: 26px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }

        .aspect-1-1 { aspect-ratio: 1/1; }
        .aspect-16-9 { aspect-ratio: 16/9; }
        .aspect-4-3 { aspect-ratio: 4/3; }
        .aspect-1_91-1 { aspect-ratio: 1.91/1; }
        .aspect-3-4 { aspect-ratio: 3 / 4; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <aside :class="isSidebarCollapsed ? 'w-collapsed' : 'w-expanded'" class="sidebar-container text-gray-400 shadow-2xl sidebar-transition">
        <div class="h-16 flex items-center border-b border-gray-700 overflow-hidden shrink-0 sidebar-transition" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'">
            <i class="fab fa-line text-3xl line-green"></i>
            <span v-if="!isSidebarCollapsed" class="text-white text-xl font-bold ml-4 whitespace-nowrap tracking-tighter uppercase font-mono">LINEOA PLUG</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <sidebar-item icon="fas fa-chart-pie" label="å„€è¡¨æ¿ç¸½è¦½" :active="currentTab === 'dashboard'" @click="currentTab = 'dashboard'"></sidebar-item>
            <div class="py-1">
                <sidebar-item icon="fas fa-layer-group" label="æ’ä»¶é–‹ç™¼ç®¡ç†" :active="currentTab === 'messages'" @click="toggleMenu"></sidebar-item>
                <div v-if="isMessageMenuOpen && !isSidebarCollapsed" class="bg-black/20 py-2">
                    <sub-item label="å–®é æ–‡ç«  Flex" :active="currentSubTab === 'single'" @click="switchSubTab('messages', 'single')"></sub-item>
                    <sub-item label="å½±ç‰‡åç‰‡æ’ä»¶" :active="currentSubTab === 'video'" @click="switchSubTab('messages', 'video')"></sub-item>
                    <sub-item label="é›»å•†å‹æ’ä»¶" :active="currentSubTab === 'ecommerce'" @click="switchSubTab('messages', 'ecommerce')"></sub-item>
                    <a href="mix.html" class="flex items-center pl-16 py-2.5 text-sm text-orange-400 hover:text-white transition-colors sidebar-transition font-bold">
                        å¤šé æ··åˆæ’ä»¶ <i class="fas fa-external-link-alt ml-2 text-[10px]"></i>
                    </a>
                </div>
            </div>
            <sidebar-item icon="fas fa-box" label="å°ˆæ¡ˆç®¡ç†" :active="currentTab === 'projects'" @click="currentTab = 'projects'"></sidebar-item>
        </nav>
        <button @click="isSidebarCollapsed = !isSidebarCollapsed" class="p-4 w-full flex items-center justify-center border-t border-gray-700 hover:text-white bg-gray-900/30 transition-all">
            <i class="fas" :class="isSidebarCollapsed ? 'fa-indent text-xl' : 'fa-outdent text-xl'"></i>
        </button>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <h2 class="text-xl font-bold text-gray-800">{{ pageTitle }}</h2>
            <div class="flex items-center gap-4">
                <div v-if="isLoggedIn" class="flex items-center gap-2 px-4 py-1.5 bg-green-50 rounded-full border border-green-100 shadow-sm">
                    <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(0,185,0,0.6)]"></div>
                    <span class="text-[10px] text-green-700 font-bold uppercase">Connected</span>
                </div>
                <div v-else @click="login" class="flex items-center gap-2 px-4 py-1.5 bg-yellow-50 rounded-full border border-yellow-200 text-yellow-700 text-xs font-bold cursor-pointer hover:bg-yellow-100 transition-all">
                    <i class="fas fa-sign-in-alt"></i> ç™»å…¥ LINE
                </div>
                <div class="w-10 h-10 rounded-xl bg-line-green text-white flex items-center justify-center font-bold shadow-md">T</div>
            </div>
        </header>

        <div class="flex-grow overflow-hidden">
            <div v-if="currentTab === 'messages'" class="h-full">
                <article-editor v-if="currentSubTab === 'single'" :initial-data="flexData" @save="handleSave" @push="handlePush"></article-editor>
                <video-editor v-if="currentSubTab === 'video'" :initial-data="flexData" @save="handleSave" @push="handlePush"></video-editor>
                <ecommerce-editor v-if="currentSubTab === 'ecommerce'" :initial-data="ecomState" @save="handleSave" @push="handlePush"></ecommerce-editor>
            </div>
            <div v-if="currentTab === 'dashboard'" class="p-10 text-center flex flex-col items-center justify-center h-full">
                <i class="fab fa-line text-6xl text-line-green mb-6"></i>
                <h3 class="text-3xl font-bold text-gray-700">LINEOA PLUG ç³»çµ±</h3>
                <p class="text-gray-400 mt-3 text-lg">é¸æ“‡å·¦å´é–‹ç™¼æ¨¡çµ„ï¼Œå³å¯é–‹å§‹è¨­è¨ˆé«˜è³ªæ„Ÿçš„ Flex è¨Šæ¯ã€‚</p>
            </div>
        </div>
    </main>
</div>

<!-- ==========================================
     æ¨¡çµ„ 1: æ–‡ç« å‹ç·¨è¼¯å™¨ (æ¨™ç±¤èˆ‡å°é½Šå„ªåŒ–)
     ========================================== -->
<script type="text/x-template" id="article-editor-template">
<div class="flex h-full w-full overflow-hidden">
    <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
        <div class="max-w-4xl mx-auto">
            <editor-header title="æ–‡ç« å‹ Flex é–‹ç™¼" @save="$emit('save', data)" @push="$emit('push', { json: flexJson, altText: data.altText })"></editor-header>
            <div class="space-y-6 mt-8">
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                    <label class="input-label text-blue-800">èŠå¤©å®¤é€šçŸ¥æ–‡å­— (altText)</label>
                    <input type="text" v-model="data.altText" class="w-full px-4 py-2 border rounded-xl text-sm focus:ring-2 focus:ring-blue-300 outline-none">
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-image mr-2 text-line-green"></i> è¦–è¦ºå…§å®¹è¨­å®š</h4>
                    <div class="space-y-4">
                        <div><label class="input-label">ä¸»è¦–è¦ºåœ–ç‰‡ç¶²å€ (HTTPS)</label><input type="text" v-model="data.imageUrl" class="w-full px-4 py-2 border rounded-xl text-sm focus:border-line-green shadow-sm"></div>
                        <div class="flex items-center gap-3"><label class="input-label mb-0 mr-2">æ¯”ä¾‹ï¼š</label><button v-for="ratio in ['1:1', '20:13', '4:6']" @click="data.aspectRatio = ratio" :class="data.aspectRatio === ratio ? 'ratio-btn-active' : ''" class="ratio-btn shadow-sm">{{ ratio }}</button></div>
                        
                        <div class="bg-white/50 p-4 rounded-lg border border-gray-100 space-y-3 shadow-sm">
                            <label class="text-xs font-bold text-gray-600 flex items-center gap-2 cursor-pointer"><input type="checkbox" v-model="data.showBadge" class="w-4 h-4 accent-line-green"> é¡¯ç¤ºå³ä¸Šåˆ†äº«æ¨™ç±¤</label>
                            <div v-if="data.showBadge" class="grid grid-cols-2 gap-3 pl-6 animate-in fade-in duration-300">
                                <div><label class="input-label">æ¨™ç±¤æ–‡å­— (é™10å­—)</label><input type="text" v-model="data.badgeText" maxlength="10" class="w-full border rounded p-1.5 text-xs focus:border-line-green outline-none"></div>
                                <div><label class="input-label">æ¨™ç±¤åº•è‰²</label><div class="flex items-center gap-2"><input type="color" v-model="data.badgeColor"><span class="text-[10px] font-mono">{{data.badgeColor}}</span></div></div>
                                <div class="col-span-2"><label class="input-label">æ¨™ç±¤é€£çµ (HTTPS)</label><input type="text" v-model="data.badgeUri" class="w-full border rounded p-1.5 text-xs focus:border-line-green outline-none" placeholder="https://..."></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between items-end">
                                <label class="input-label">æ¨™é¡Œå…§å®¹</label>
                                <div class="flex bg-slate-100 p-0.5 rounded border mb-1">
                                    <button v-for="a in ['start','center','end']" @click="data.titleAlign=a" :class="data.titleAlign===a?'bg-white text-line-green shadow-sm':'text-slate-500'" class="p-1 px-2 text-[9px] uppercase font-bold transition-all"><i :class="'fas fa-align-' + (a==='start'?'left':a==='center'?'center':'right')"></i></button>
                                </div>
                            </div>
                            <input type="text" v-model="data.title" class="w-full px-4 py-2 border border-gray-200 rounded-xl text-sm font-bold focus:border-line-green shadow-sm" placeholder="æ–‡ç« æ¨™é¡Œ">
                        </div>

                        <div><label class="input-label">å…§å®¹æ–‡å­— (é‚Šè· 5px å·²å„ªåŒ–)</label><textarea v-model="data.subtitle" rows="6" class="w-full px-4 py-3 border rounded-xl text-sm outline-none focus:border-line-green shadow-sm"></textarea></div>
                    </div>
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>åº•éƒ¨è¡Œç‚ºæŒ‰éˆ•è¨­å®š</span><button v-if="data.buttons.length < 3" @click="addButton" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                    <div class="space-y-3">
                        <div v-for="(btn, idx) in data.buttons" :key="idx" class="flex gap-3 items-center bg-white p-3 rounded-xl border shadow-sm transition-all hover:border-green-100">
                            <div class="text-center"><label class="text-[9px] block text-gray-400 uppercase">é¡è‰²</label><input type="color" v-model="btn.color"></div>
                            <div class="w-32"><label class="input-label">æ–‡å­—</label><input type="text" v-model="btn.label" class="w-full border rounded p-1 text-sm font-bold"></div>
                            <div class="flex-1"><label class="input-label">é€£çµ</label><input type="text" v-model="btn.uri" class="w-full border rounded p-1 text-sm" placeholder="https://..."></div>
                            <button @click="data.buttons.splice(idx,1)" class="text-gray-300 hover:text-red-500 pt-5 transition-colors"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <json-viewer :json="flexJson"></json-viewer>
        </div>
    </div>
    <div class="w-[360px] shrink-0 bg-gray-50 flex items-center justify-center py-8 shadow-inner overflow-y-auto no-scrollbar">
        <div class="preview-window">
            <div class="p-3 border-b border-gray-800 bg-[#1A1B1E] flex items-center gap-2 sticky top-0 z-50">
                <i class="fas fa-chevron-left text-gray-600 text-xs"></i>
                <span class="text-[9px] font-bold text-gray-500 uppercase tracking-tighter">LINE Preview</span>
            </div>
            <div class="p-4">
                <div class="flex-bubble shadow-xl relative overflow-hidden">
                    <div class="relative">
                        <img :src="data.imageUrl" :style="{ aspectRatio: data.aspectRatio.replace(':', '/') }" class="w-full object-cover">
                        <div v-if="data.showBadge" class="flex-badge" :style="{ backgroundColor: data.badgeColor }">{{ data.badgeText || 'åˆ†äº«' }}</div>
                    </div>
                    <div class="p-[5px]">
                        <div class="text-base font-bold truncate" :class="{'text-left': data.titleAlign==='start', 'text-center': data.titleAlign==='center', 'text-right': data.titleAlign==='end'}">{{ data.title || 'æ¨™é¡Œ' }}</div>
                        <div class="text-[10px] text-gray-500 mt-2 whitespace-pre-wrap leading-relaxed">{{ data.subtitle || 'è«‹è¼¸å…¥æè¿°...' }}</div>
                    </div>
                    <div class="p-3 pt-0 space-y-1.5"><button v-for="btn in data.buttons" class="w-full py-1.5 text-white text-[10px] font-bold rounded shadow-sm opacity-95" :style="{ backgroundColor: btn.color }">{{ btn.label }}</button></div>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

<!-- ==========================================
     æ¨¡çµ„ 2: å½±ç‰‡åç‰‡ç·¨è¼¯å™¨ (å®Œå…¨åŒæ­¥ TONY JSON)
     ========================================== -->
<script type="text/x-template" id="video-editor-template">
<div class="flex h-full w-full overflow-hidden">
    <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
        <div class="max-w-4xl mx-auto">
            <editor-header title="åç‰‡å‹æ¨¡çµ„é–‹ç™¼" @save="$emit('save', data)" @push="$emit('push', { json: flexJson, altText: data.altText })"></editor-header>
            <div class="space-y-6 mt-8">
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                    <label class="input-label text-blue-800">é€šçŸ¥æ–‡å­— (altText)</label>
                    <input type="text" v-model="data.altText" class="w-full px-4 py-2 border rounded-xl text-sm focus:ring-2 focus:ring-blue-300 outline-none shadow-sm">
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-id-card mr-2 text-line-green"></i> Header å“ç‰Œèˆ‡èƒŒæ™¯è‰²</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="input-label">å§“å</label><input type="text" v-model="data.headerName" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                        <div><label class="input-label">æè¿° (é™20å­—)</label><input type="text" v-model="data.headerDescription" maxlength="20" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                        <div class="col-span-2"><label class="input-label">é ­åƒç¶²å€</label><input type="text" v-model="data.headerImg" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                        <div><label class="input-label">Header èƒŒæ™¯è‰²</label><input type="color" v-model="data.headerBgColor" class="w-full"></div>
                        <div><label class="input-label">Body èƒŒæ™¯è‰²</label><input type="color" v-model="data.bodyBgColor" class="w-full"></div>
                    </div>
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-film mr-2 text-line-green"></i> è¦–è¦ºå€æ¨¡å¼</h4>
                    <div class="space-y-4">
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-300">
                            <button @click="data.visualMode = 'video'" :class="data.visualMode === 'video' ? 'bg-white shadow-sm text-line-green' : 'text-slate-500'" class="flex-1 py-1.5 text-xs font-bold rounded transition-all">å½±ç‰‡æ’­æ”¾</button>
                            <button @click="data.visualMode = 'image'" :class="data.visualMode === 'image' ? 'bg-white shadow-sm text-line-green' : 'text-slate-500'" class="flex-1 py-1.5 text-xs font-bold rounded transition-all">éœæ…‹åœ–ç‰‡</button>
                        </div>
                        <div v-if="data.visualMode === 'video'" class="space-y-4">
                            <div><label class="input-label">å½±ç‰‡ç¶²å€ (.mp4)</label><input type="text" v-model="data.videoUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                            <div><label class="input-label">å°é¢åœ–ç¶²å€</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                        </div>
                        <div v-else class="space-y-4">
                            <div><label class="input-label">åœ–ç‰‡ç¶²å€</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green"></div>
                            <div><label class="input-label">é»æ“Šé€£çµ</label><input type="text" v-model="data.imageActionUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green" placeholder="https://..."></div>
                        </div>
                    </div>
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4">ç¶²æ ¼æŒ‰éˆ• (å°‡é¡¯ç¤º 4 å€‹)</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="(grid, idx) in data.gridButtons" :key="idx" class="p-4 bg-white border rounded-xl shadow-sm">
                            <div class="flex gap-2 mb-2"><input type="text" v-model="grid.emoji" class="w-10 border rounded text-sm text-center"><input type="text" v-model="grid.label" class="flex-1 border rounded px-2 py-1 text-xs"></div>
                            <label class="input-label">è·³è½‰ç¶²å€</label><input type="text" v-model="grid.uri" class="w-full border rounded px-2 py-1 text-[10px]" placeholder="https://...">
                        </div>
                    </div>
                </div>
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4">åº•éƒ¨è¡Œç‚ºæŒ‰éˆ•è¨­å®š</h4>
                    <div v-for="(vBtn, idx) in data.videoFooterButtons" :key="idx" class="flex gap-3 items-center mb-3 p-4 bg-white border rounded-xl">
                        <div class="shrink-0 text-center"><label class="text-[9px] block text-gray-400 font-bold uppercase">é…è‰²</label><input type="color" v-model="vBtn.color"></div>
                        <div class="flex-1"><label class="input-label">åç¨±</label><input type="text" v-model="vBtn.label" class="w-full border rounded-lg p-2 text-sm font-bold"></div>
                        <div class="flex-[2]"><label class="input-label">é€£çµ</label><input type="text" v-model="vBtn.uri" class="w-full border rounded-lg p-2 text-sm" placeholder="https://..."></div>
                    </div>
                </div>
            </div>
            <json-viewer :json="flexJson"></json-viewer>
        </div>
    </div>
    <div class="w-[360px] shrink-0 bg-gray-50 flex items-center justify-center py-8 no-scrollbar">
        <div class="preview-window">
            <div class="flex-bubble flex-bubble-dark shadow-2xl mt-8" :style="{ backgroundColor: data.bodyBgColor }">
                <div class="header-box" :style="{ backgroundColor: data.headerBgColor }"><img :src="data.headerImg" class="w-10 h-10 rounded-full object-cover border border-gray-700 shadow-sm"><div class="flex flex-col"><span class="text-[11px] font-bold uppercase" style="color:#D4AF37">{{ data.headerName }}</span><span class="text-[8px] text-gray-400">{{ data.headerDescription }}</span></div></div>
                <div class="video-hero">
                    <img :src="data.previewUrl" class="w-full h-full object-cover opacity-60">
                    <i v-if="data.visualMode === 'video'" class="fas fa-play-circle text-white text-4xl absolute opacity-90 drop-shadow-xl"></i>
                </div>
                <div class="grid-box"><div v-for="grid in data.gridButtons" class="grid-item" :style="{ backgroundColor: 'rgba(255,255,255,0.05)' }"><div class="text-xl mb-1">{{ grid.emoji }}</div><div class="text-[8px] text-gray-300 font-bold uppercase">{{ grid.label }}</div></div></div>
                <div class="p-3 pt-0 space-y-2" :style="{ backgroundColor: data.bodyBgColor }"><button v-for="(vBtn, vI) in data.videoFooterButtons" class="w-full py-2 text-[10px] font-bold rounded shadow-md transition-all active:scale-95" :style="{ backgroundColor: vBtn.color, color: '#fff' }">{{ vBtn.label }}</button></div>
            </div>
        </div>
    </div>
</div>
</script>

<!-- ==========================================
     æ¨¡çµ„ 3: é›»å•†å‹ç·¨è¼¯å™¨ (è¦æ ¼å®Œå…¨æ¢å¾©)
     ========================================== -->
<script type="text/x-template" id="ecommerce-editor-template">
<div class="flex h-full w-full overflow-hidden">
    <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
        <div class="max-w-4xl mx-auto">
            <editor-header title="é›»å•†å‹æ’ä»¶é–‹ç™¼" @save="$emit('save', state)" @push="$emit('push', { json: flexJson, altText: state.altText })"></editor-header>
            <div class="space-y-6 mt-8">
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                    <label class="input-label text-blue-800">é€šçŸ¥æ–‡å­— (altText)</label>
                    <input type="text" v-model="state.altText" class="w-full px-4 py-2 border rounded-xl text-sm focus:ring-2 focus:ring-blue-300 outline-none">
                </div>

                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-image mr-2 text-line-green"></i> é ‚éƒ¨ Hero è¦–è¦º</h4>
                    <div class="space-y-4">
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-300">
                            <button v-for="t in ['image', 'video', 'none']" @click="state.hero.type = t" :class="state.hero.type===t?'bg-white shadow-sm text-line-green':'text-slate-500'" class="flex-1 py-1.5 text-xs font-bold rounded transition-all">{{ t.toUpperCase() }}</button>
                        </div>
                        <div v-show="state.hero.type !== 'none'" class="grid grid-cols-2 gap-4">
                            <div><label class="input-label">æ¯”ä¾‹</label><select v-model="state.hero.aspectRatio" class="w-full text-xs p-2 border rounded-lg focus:ring-1 focus:ring-line-green outline-none"><option v-for="a in ['16:9','1:1','4:3','1.91:1','3:4']" :value="a">{{ a }}</option></select></div>
                            <div><label class="input-label">{{ state.hero.type === 'video' ? 'å°é¢åœ–' : 'åœ–ç‰‡' }}</label><input type="text" v-model="state.hero.url" class="w-full text-xs p-2 border rounded-lg shadow-sm" placeholder="https://..."></div>
                            <div v-if="state.hero.type === 'video'" class="col-span-2"><label class="input-label">å½±ç‰‡é€£çµ (.mp4)</label><input type="text" v-model="state.hero.videoUrl" class="w-full text-xs p-2 border rounded-lg shadow-sm" placeholder="HTTPSå½±ç‰‡é€£çµ"></div>
                        </div>
                    </div>
                </div>

                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>Body å•†å“é…ç½® (é–“è· 5px å·²å„ªåŒ–)</span><button @click="state.body.items.push({title:'æ–°å•†å“',img:'https://lihi.cc/mwMvo',url:''})" class="text-xs text-line-green font-bold">+ æ–°å¢</button></h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="input-label">æ¬„æ•¸</label><select v-model="state.body.columns" class="w-full text-xs p-2 border rounded-lg focus:ring-1 focus:ring-line-green outline-none"><option :value="3">3 æ¬„</option><option :value="4">4 æ¬„</option></select></div>
                            <div><label class="input-label">åº•è‰²</label><div class="flex items-center gap-2 bg-white p-1 border rounded-lg"><input type="color" v-model="state.body.bgColor"><span class="text-[10px] font-mono uppercase tracking-tight">{{state.body.bgColor}}</span></div></div>
                        </div>
                        <div class="p-3 bg-white border rounded-xl space-y-2 shadow-sm">
                            <label class="input-label">æ»¿ç‰ˆèƒŒæ™¯æ¨¡å¼</label>
                            <div class="flex bg-slate-100 p-1 rounded-lg mb-2"><button @click="state.body.bgType='color'" :class="state.body.bgType==='color'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1 text-[10px] font-bold rounded">ç´”è‰²æ¨¡å¼</button><button @click="state.body.bgType='image'" :class="state.body.bgType==='image'?'bg-white text-line-green shadow-sm':'text-slate-500'" class="flex-1 py-1 text-[10px] font-bold rounded">åœ–ç‰‡èƒŒæ™¯</button></div>
                            <div v-if="state.body.bgType==='image'" class="space-y-3">
                                <input type="text" v-model="state.body.bg" class="w-full text-xs p-2 border rounded" placeholder="èƒŒæ™¯åœ–ç¶²å€">
                                <select v-model="state.body.bgMode" class="w-full text-xs p-1.5 border rounded"><option value="cover">å…¨ç‰ˆæ‹‰ä¼¸ (Cover)</option><option value="top">ç­‰æ¯”ç¸®æ”¾ (Fit Width)</option></select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div v-for="(item, idx) in state.body.items" :key="idx" class="p-3 bg-white border rounded-xl flex items-center gap-3 relative shadow-sm hover:border-line-green transition-all">
                                <img :src="item.img" class="w-12 h-12 rounded object-cover border bg-slate-50 shadow-sm">
                                <div class="flex-1"><label class="input-label">å“åæ¨™ç±¤</label><input v-model="item.title" class="w-full text-xs font-bold border-b focus:outline-none mb-1"><label class="input-label">é€£çµ</label><input v-model="item.url" class="w-full text-[10px] text-gray-400 focus:outline-none" placeholder="https://..."></div>
                                <button @click="state.body.items.splice(idx,1)" class="text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex justify-between items-center"><span>åº•éƒ¨å€å¡Šèˆ‡æŒ‰éˆ•</span><label class="flex items-center gap-2 cursor-pointer text-xs font-bold"><input type="checkbox" v-model="state.footer.textEnabled" class="accent-green-500"> èªªæ˜æ–‡å­—</label></h4>
                    <div v-show="state.footer.textEnabled" class="mb-4 space-y-3 p-4 bg-white border rounded-xl shadow-sm animate-in fade-in duration-300">
                        <div class="flex justify-between items-center"><label class="input-label mb-0">æ¨£å¼èˆ‡å°é½Š (5px é–“è·)</label><div class="flex gap-2"><input type="color" v-model="state.footer.textColor"><div class="flex bg-slate-100 p-0.5 rounded border"><button v-for="a in ['start','center','end']" @click="state.footer.textAlign=a" :class="state.footer.textAlign===a?'bg-white text-line-green shadow-sm':'text-slate-500'" class="p-1 px-2 text-[9px] uppercase font-bold">{{a}}</button></div></div></div>
                        <textarea v-model="state.footer.text" rows="3" class="w-full border rounded p-2 text-xs focus:outline-none focus:border-line-green" placeholder="è¼¸å…¥é å°¾èªªæ˜æ–‡å­—..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        <div v-for="bNum in [1, 2]" class="p-4 bg-white border rounded-xl flex items-center gap-4 shadow-sm transition-all hover:border-green-100">
                            <div class="text-center"><label class="text-[9px] block text-gray-400 font-bold uppercase tracking-tighter">é…è‰²</label><input type="color" v-model="state.footer['btn' + bNum].color"></div>
                            <div class="w-40"><label class="input-label">æŒ‰éˆ• {{bNum}} æ–‡å­—</label><input type="text" v-model="state.footer['btn' + bNum].label" class="w-full border rounded p-1.5 text-sm font-bold"></div>
                            <div class="flex-1"><label class="input-label">é€£çµ</label><input type="text" v-model="state.footer['btn' + bNum].uri" class="w-full border rounded p-1.5 text-sm" placeholder="https://..."></div>
                        </div>
                    </div>
                </div>
            </div>
            <json-viewer :json="flexJson"></json-viewer>
        </div>
    </div>
    <div class="w-[360px] shrink-0 bg-gray-50 flex items-center justify-center py-8 shadow-inner overflow-y-auto no-scrollbar">
        <div class="chat-room-bg custom-scrollbar">
            <div class="flex items-start gap-2 mb-8 w-full justify-center">
                <div class="w-8 h-8 rounded-full bg-slate-400 shrink-0 self-start mt-1 shadow-sm"></div>
                <div class="bg-white rounded-xl overflow-hidden flex-bubble-container flex flex-col shadow-xl">
                    <div v-show="state.hero.type !== 'none'" :class="getAspectClass(state.hero.aspectRatio)" class="relative w-full bg-black shrink-0">
                        <img v-show="state.hero.type === 'image'" :src="state.hero.url" class="w-full h-full object-cover">
                        <div v-show="state.hero.type === 'video'" class="absolute inset-0 flex items-center justify-center">
                            <img :src="state.hero.url" class="absolute inset-0 w-full h-full object-cover opacity-70">
                            <div class="relative z-10 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-play text-slate-900 ml-0.5"></i></div>
                        </div>
                    </div>
                    <!-- paddingAll: 5px å„ªåŒ– -->
                    <div class="relative w-full p-[5px]" :style="{ backgroundColor: state.body.bgColor }">
                        <img v-if="state.body.bgType==='image' && state.body.bg" :src="state.body.bg" :class="state.body.bgMode === 'top' ? 'object-contain' : 'object-cover'" class="absolute inset-0 w-full h-full z-0">
                        <div :class="state.body.columns === 3 ? 'grid-cols-3' : 'grid-cols-4'" class="relative z-10 grid gap-2">
                            <div v-for="item in state.body.items" class="bg-white rounded p-1 shadow-sm flex flex-col border border-slate-100">
                                <img :src="item.img" class="w-full aspect-square object-cover rounded-sm mb-1">
                                <div :style="{ backgroundColor: state.body.tagBgColor || '#000', color: state.body.tagTextColor || '#fff' }" class="text-[8px] font-bold text-center py-0.5 truncate rounded-sm">{{ item.title }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 border-t bg-white flex flex-col gap-2" :style="{ backgroundColor: state.footer.bg }">
                        <div v-show="state.footer.textEnabled" :style="{ color: state.footer.textColor }" :class="{'text-left': state.footer.textAlign==='start', 'text-center': state.footer.textAlign==='center', 'text-right': state.footer.textAlign==='end'}" class="text-[10px] whitespace-pre-wrap mb-1 leading-relaxed">{{ state.footer.text }}</div>
                        <div class="flex gap-2">
                            <button v-for="b in [state.footer.btn1, state.footer.btn2]" :style="{ backgroundColor: b.color }" class="flex-1 py-2 rounded text-[10px] font-bold text-white shadow-sm transition hover:brightness-110">{{ b.label }}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

<script>
const { createApp, ref, computed, onMounted } = Vue;

const forceHttps = (u) => {
    if (!u || u.trim() === "" || u === "#") return "https://line.me";
    let url = u.trim();
    if (url.startsWith("http://")) return url.replace("http://", "https://");
    if (!url.startsWith("https://") && !url.startsWith("line://")) return "https://" + url;
    return url;
};

const EditorHeader = {
    props: ['title'],
    template: `<div class="flex items-center justify-between"><div><h3 class="text-2xl font-bold text-gray-800">{{ title }}</h3><p class="text-[10px] text-red-500 font-bold mt-1 uppercase tracking-widest">â€» è‡ªå‹•ä¿®æ­£æ‰€æœ‰ç¶²å€ç‚º HTTPS æ ¼å¼</p></div><div class="flex gap-2"><button @click="$emit('save')" class="px-6 py-2.5 bg-purple-500 text-white rounded-xl text-sm font-bold shadow-lg flex items-center gap-2 hover:bg-purple-600 transition-all"><i class="fas fa-save"></i> å„²å­˜å°ˆæ¡ˆ</button><button @click="$emit('push')" class="px-6 py-2.5 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg flex items-center gap-2 hover:bg-blue-600 transition-all"><i class="fas fa-paper-plane"></i> ğŸš€ æ¨æ’­æ¸¬è©¦</button></div></div>`
};

const JsonViewer = {
    props: ['json'],
    template: `<div class="mt-12 mb-20"><div class="flex items-center justify-between mb-3 px-2"><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Flex JSON Schema</span><button @click="copy" class="text-[10px] text-line-green font-bold uppercase hover:underline">Copy</button></div><div class="bg-[#1e2124] rounded-2xl p-6 border border-gray-700 shadow-xl overflow-hidden"><pre class="text-[11px] text-green-400 font-mono h-48 overflow-y-auto no-scrollbar font-mono">{{ JSON.stringify(json, null, 2) }}</pre></div></div>`,
    methods: { copy() { const el = document.createElement('textarea'); el.value = JSON.stringify(this.json, null, 2); document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert('JSON å·²è¤‡è£½ï¼'); } }
};

const ArticleEditor = {
    props: ['initialData'],
    template: '#article-editor-template',
    components: { 'editor-header': EditorHeader, 'json-viewer': JsonViewer },
    setup(props) {
        const data = ref({ 
            ...JSON.parse(JSON.stringify(props.initialData)), 
            showBadge: props.initialData.showBadge ?? true,
            badgeText: props.initialData.badgeText || 'åˆ†äº«',
            badgeUri: props.initialData.badgeUri || '',
            badgeColor: props.initialData.badgeColor || '#FF0000',
            titleAlign: props.initialData.titleAlign || 'center',
            altText: props.initialData.altText || 'æ‚¨æ”¶åˆ°äº†ä¸€å‰‡ç²¾é¸è¨Šæ¯' 
        });
        const flexJson = computed(() => {
            const bodyContents = [
                { type: "image", url: forceHttps(data.value.imageUrl), size: "full", aspectRatio: data.value.aspectRatio, aspectMode: "cover" },
                { type: "box", layout: "vertical", paddingAll: "5px", contents: [
                    { type: "text", text: data.value.title || "æ¨™é¡Œ", weight: "bold", size: "xl", align: data.value.titleAlign, wrap: true },
                    { type: "text", text: data.value.subtitle || "å…§å®¹æè¿°", size: "sm", margin: "sm", color: "#666666", wrap: true }
                ]}
            ];
            if (data.value.showBadge) {
                bodyContents.push({
                    type: "box", layout: "vertical", position: "absolute", backgroundColor: data.value.badgeColor,
                    cornerRadius: "xl", paddingTop: "2px", paddingBottom: "2px", paddingStart: "10px", paddingEnd: "10px",
                    offsetTop: "10px", offsetEnd: "10px", 
                    action: { type: "uri", uri: forceHttps(data.value.badgeUri) },
                    contents: [{ type: "text", text: data.value.badgeText || "åˆ†äº«", color: "#ffffff", size: "10px", weight: "bold" }]
                });
            }
            return {
                type: "bubble",
                body: { type: "box", layout: "vertical", paddingAll: "0px", contents: bodyContents },
                footer: { type: "box", layout: "vertical", spacing: "sm", paddingAll: "15px", contents: data.value.buttons.map(b => ({
                    type: "button", style: "primary", color: b.color, height: "sm", action: { type: "uri", label: b.label || "äº†è§£æ›´å¤š", uri: forceHttps(b.uri) }
                }))}
            };
        });
        return { data, flexJson, addButton: () => data.value.buttons.push({ label: 'æ–°æŒ‰éˆ•', color: '#00B900', uri: '' }) };
    }
};

const VideoEditor = {
    props: ['initialData'],
    template: '#video-editor-template',
    components: { 'editor-header': EditorHeader, 'json-viewer': JsonViewer },
    setup(props) {
        // ä½¿ç”¨ TONY JSON ä½œç‚ºé è¨­
        const data = ref({
            type: 'video', visualMode: 'video', imageActionUrl: '', altText: 'å½±ç‰‡åç‰‡è¨Šæ¯', 
            headerName: 'TONY', headerDescription: 'ç³»çµ±é–‹ç™¼', headerImg: 'https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png',
            headerBgColor: '#1A1B1E', bodyBgColor: '#0F0F10',
            videoUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/mp4',
            previewUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/m800x1200',
            gridButtons: [ 
                { emoji: 'ğŸ¤–', label: 'AI è«®è©¢', uri: 'https://liff.line.me/2006625044-bPGxrB53/' }, 
                { emoji: 'ğŸ¥', label: 'ç”¢å“ä»‹ç´¹', uri: 'https://example.com/video' }, 
                { emoji: 'ğŸ§¾', label: 'å•†å“å‹éŒ„', uri: 'https://example.com/catalog' }, 
                { emoji: 'ğŸ“', label: 'é–€å¸‚è³‡è¨Š', uri: 'https://example.com/map' } 
            ], 
            videoFooterButtons: [ 
                { label: 'ğŸš€ å•Ÿå‹• AI å°å¹«æ‰‹', uri: 'https://liff.line.me/2006625044-bPGxrB53/index.php/colt_sp/6502/', color: '#C9A24D' }, 
                { label: 'ğŸ“¤ åˆ†äº«å¥½å‹', uri: 'https://liff.line.me/2006625044-J42EzjkZ/index.php/linecard_12/6816/', color: '#2A2C31' } 
            ]
        });
        const flexJson = computed(() => {
            const flex = { type: "bubble", size: "mega", 
                header: { type: "box", layout: "horizontal", spacing: "md", paddingAll: "8px", backgroundColor: data.value.headerBgColor, contents: [ { type: "image", url: forceHttps(data.value.headerImg), size: "xs", aspectRatio: "1:1", aspectMode: "cover", gravity: "center" }, { type: "box", layout: "vertical", spacing: "xs", flex: 3, contents: [ { type: "text", text: data.value.headerName, weight: "bold", size: "lg", color: "#D4AF37" }, { type: "text", text: "LINEè¡ŒéŠ·é”äºº", size: "sm", color: "#E6E6E6" }, { type: "text", text: data.value.headerDescription, size: "xs", color: "#A0A0A0", wrap: true } ] } ] }, 
                body: { type: "box", layout: "vertical", paddingAll: "8px", backgroundColor: data.value.bodyBgColor, contents: [{ type: "box", layout: "vertical", spacing: "sm", paddingAll: "12px", backgroundColor: "rgba(255,255,255,0.05)", cornerRadius: "14px", contents: [ 
                    { type: "box", layout: "horizontal", spacing: "sm", contents: data.value.gridButtons.slice(0,2).map(g => ({ type: "box", layout: "vertical", paddingAll: "12px", backgroundColor: "rgba(255,255,255,0.1)", cornerRadius: "12px", action: { type: "uri", label: g.label, uri: forceHttps(g.uri) }, contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center" }, { type: "text", text: g.label || "æœªå‘½å", size: "sm", align: "center", color: "#E6E6E6" }] })) }, 
                    { type: "box", layout: "horizontal", spacing: "sm", contents: data.value.gridButtons.slice(2,4).map(g => ({ type: "box", layout: "vertical", paddingAll: "12px", backgroundColor: "rgba(255,255,255,0.1)", cornerRadius: "12px", action: { type: "uri", label: g.label, uri: forceHttps(g.uri) }, contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center" }, { type: "text", text: g.label || "æœªå‘½å", size: "sm", align: "center", color: "#E6E6E6" }] })) } 
                ] }] }, 
                footer: { type: "box", layout: "vertical", spacing: "sm", paddingAll: "8px", backgroundColor: data.value.bodyBgColor, contents: data.value.videoFooterButtons.map(b => ({ type: "button", style: "primary", color: b.color, height: "sm", action: { type: "uri", label: b.label || "ç¢ºèª", uri: forceHttps(b.uri) } })) }
            };
            if (data.value.visualMode === 'video') flex.hero = { type: "video", url: forceHttps(data.value.videoUrl), previewUrl: forceHttps(data.value.previewUrl), aspectRatio: "800:500", altContent: { type: "image", url: forceHttps(data.value.previewUrl), size: "full", aspectMode: "cover" } };
            else flex.hero = { type: "image", url: forceHttps(data.value.previewUrl), size: "full", aspectRatio: "800:500", aspectMode: "cover", action: { type: "uri", uri: forceHttps(data.value.imageActionUrl) } };
            return flex;
        });
        return { data, flexJson };
    }
};

const EcommerceEditor = {
    props: ['initialData'],
    template: '#ecommerce-editor-template',
    components: { 'editor-header': EditorHeader, 'json-viewer': JsonViewer },
    setup(props) {
        const state = ref({ ...JSON.parse(JSON.stringify(props.initialData)), altText: props.initialData.altText || 'å•†åŸç‰¹æƒ ä¸­ï¼' });
        const flexJson = computed(() => {
            const cols = state.value.body.columns; 
            const width = cols === 3 ? "32%" : "23%";
            const chunk = (arr, size) => Array.from({ length: Math.ceil(arr.length / size) }, (v, i) => arr.slice(i * size, i * size + size));
            
            const products = { 
                type: "box", layout: "vertical", 
                contents: chunk(state.value.body.items, cols).map((row, idx) => ({ 
                    type: "box", layout: "horizontal", margin: idx===0?"none":"md", 
                    contents: row.map((item, colIdx) => ({ 
                        type: "box", layout: "vertical", width: width, margin: colIdx===0?"none":"md", 
                        contents: [ 
                            { type: "image", url: forceHttps(item.img), aspectRatio: "1:1", size: "full", aspectMode: "cover" }, 
                            { type: "box", layout: "vertical", backgroundColor: state.value.body.tagBgColor || "#000000", paddingAll: "xs", margin: "sm", cornerRadius: "sm", contents: [{ type: "text", text: item.title || "å•†å“", size: "xxs", color: state.value.body.tagTextColor || "#FFFFFF", align: "center", weight: "bold", wrap: true }] } 
                        ], action: { type: "uri", uri: forceHttps(item.url) } 
                    })) 
                })), 
                paddingAll: "md" 
            };
            
            const bodyBox = { type: "box", layout: "vertical", backgroundColor: state.value.body.bgColor, paddingAll: "none", contents: [] };
            if (state.value.body.bgType==='image') {
                bodyBox.contents.push({ type: "box", layout: "vertical", contents: [{ type: "image", url: forceHttps(state.value.body.bg), position: "absolute", size: "full", aspectMode: state.value.body.bgMode === 'top' ? "width" : "cover" }, products] });
            } else {
                bodyBox.contents.push(products);
            }
            
            const footerContents = [];
            if (state.value.footer.textEnabled) {
                footerContents.push({ type: "text", text: state.value.footer.text, size: "xs", wrap: true, align: state.value.footer.textAlign, color: state.value.footer.textColor, margin: "md" });
            }
            footerContents.push({ type: "box", layout: "horizontal", spacing: "md", contents: [ 
                { type: "button", style: "primary", height: "sm", color: state.value.footer.btn1.color, action: { type: "uri", label: state.value.footer.btn1.label || "æŒ‰éˆ• 1", uri: forceHttps(state.value.footer.btn1.uri) } }, 
                { type: "button", style: "primary", height: "sm", color: state.value.footer.btn2.color, action: { type: "uri", label: state.value.footer.btn2.label || "æŒ‰éˆ• 2", uri: forceHttps(state.value.footer.btn2.uri) } } 
            ]});

            return { 
                type: "bubble", size: "mega", 
                body: bodyBox, 
                footer: { type: "box", layout: "vertical", backgroundColor: state.value.footer.bg, paddingAll: "md", contents: footerContents }
            };
        });
        return { state, flexJson, getAspectClass: (a) => ({ '1:1':'aspect-1-1','16:9':'aspect-16-9','4:3':'aspect-4-3','1.91:1':'aspect-1_91-1','3:4':'aspect-3-4' }[a] || 'aspect-16-9') };
    }
};

createApp({
    components: {
        'sidebar-item': { props: ['icon', 'label', 'active'], template: `<a href="#" @click.prevent="$emit('click')" :class="active ? 'sidebar-item-active' : ''" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors sidebar-transition"><i :class="icon" class="w-8 text-center"></i><span class="ml-2 font-medium">{{label}}</span></a>` },
        'sub-item': { props: ['label', 'active'], template: `<a href="#" @click.prevent="$emit('click')" :class="active ? 'submenu-item-active' : ''" class="flex items-center pl-16 py-2.5 text-sm hover:text-white transition-colors sidebar-transition">{{label}}</a>` },
        'article-editor': ArticleEditor, 'video-editor': VideoEditor, 'ecommerce-editor': EcommerceEditor
    },
    setup() {
        const isSidebarCollapsed = ref(false); const isMessageMenuOpen = ref(true);
        const currentTab = ref('dashboard'); const currentSubTab = ref('single');
        const isLoggedIn = ref(false); const user = ref(null);
        
        const flexData = ref({ type: 'standard', showBadge: true, badgeText: 'åˆ†äº«', badgeUri: '', badgeColor: '#FF0000', titleAlign: 'center', altText: 'ç²¾é¸è¨Šæ¯', imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', aspectRatio: '20:13', title: 'æœ€æ–°ç„¦é»', subtitle: 'æ­¡è¿æŸ¥çœ‹æˆ‘å€‘æœ€æ–°ç™¼å¸ƒçš„ç²¾é¸å¤–æ›æ’ä»¶å…§å®¹ã€‚', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: '', color: '#00B900' }] });
        const ecomState = ref({ altText: 'å•†åŸæ´»å‹•', hero: { type: 'video', aspectRatio: '16:9', url: "https://lihi.cc/5OXMZ", videoUrl: "https://lihi.cc/YsmAp" }, body: { columns: 3, bgType: "image", bgMode: "cover", bgColor: "#F8F8F8", bg: "https://lihi.cc/l5qqU", tagBgColor: "#0D0D0D", tagTextColor: "#FFFFFF", items: [{ title: "å•†å“ A", img: "https://lihi.cc/mwMvo", url: "" }, { title: "å•†å“ B", img: "https://lihi.cc/2Nu8G", url: "" }, { title: "å•†å“ C", img: "https://lihi.cc/yRfpn", url: "" }] }, footer: { bg: "#ffffff", textEnabled: false, text: "â€» æ•¸é‡æœ‰é™ã€‚", textColor: "#666666", textAlign: "center", btn1: { label: "å®˜ç¶²", color: "#000000", uri: "" }, btn2: { label: "åˆ†äº«", color: "#000000", uri: "" } } });

        const handlePush = ({ json, altText }) => {
            if (!liff.isLoggedIn()) { liff.login(); return; }
            liff.shareTargetPicker([{ type: "flex", altText: altText || "ç²¾é¸è¨Šæ¯", contents: json }]).then(res => { if (res) alert("æ¨æ’­ç™¼é€æˆåŠŸï¼"); }).catch(err => alert("ç™¼é€å¤±æ•—ï¼šè«‹ç¢ºèªç¶²å€æ ¼å¼æ­£ç¢ºã€‚"));
        };
        onMounted(async () => {
            try { await liff.init({ liffId: "2008541971-Wgvz6gD8" }); isLoggedIn.value = liff.isLoggedIn(); if (isLoggedIn.value) user.value = await liff.getProfile(); if (window.lucide) window.lucide.createIcons(); } catch (e) {}
        });
        return { isSidebarCollapsed, isMessageMenuOpen, currentTab, currentSubTab, isLoggedIn, user, flexData, ecomState, pageTitle: computed(() => currentTab.value === 'dashboard' ? ' CMS ä¸»å„€è¡¨æ¿' : { single:'æ–‡ç« å‹', video:'å½±ç‰‡å‹', ecommerce:'é›»å•†å‹' }[currentSubTab.value]), toggleMenu: () => { if (isSidebarCollapsed.value) isSidebarCollapsed.value = false; isMessageMenuOpen.value = !isMessageMenuOpen.value; }, switchSubTab: (t, s) => { currentTab.value = t; currentSubTab.value = s; }, login: () => liff.login(), handleSave: () => alert("å·²æ¨¡æ“¬å„²å­˜å‹•ä½œ"), handlePush };
    }
}).mount('#app');
</script>
</body>
</html>
