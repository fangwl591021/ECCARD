<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.html</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        
        /* å´é‚Šæ¬„æ¨£å¼ */
        .sidebar-container { background-color: #1e2124; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); height: 100vh; display: flex; flex-direction: column; flex-shrink: 0; overflow: hidden; z-index: 50; }
        .w-expanded { width: 256px !important; }
        .w-collapsed { width: 80px !important; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* é–‹æ”¾å¼é è¦½å€ */
        .open-preview-area { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }
        .chat-room-bg { background-color: #8c9bad; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 60px 20px; }
        
        /* LINE Flex æ°£æ³¡å®¹å™¨ */
        .flex-bubble-container { width: 100%; max-width: 300px; position: relative; }
        .flex-bubble { background: #FFFFFF; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3); }
        
        /* æ¨™ç±¤é è¦½æ¨£å¼ï¼šå¯¬åº¦éš¨æ–‡å­—ä¼¸ç¸®ï¼ŒOffset 10px */
        .flex-badge-preview { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            color: white; 
            padding: 5px 20px 2px 20px; 
            border-radius: 30px; 
            font-size: 11px; 
            font-weight: bold; 
            z-index: 20; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            display: inline-block;
            white-space: nowrap;
            width: auto;
            max-width: calc(100% - 20px);
        }
        
        .ratio-btn { @apply px-3 py-1 text-[10px] border border-gray-200 rounded-md transition-all cursor-pointer bg-white hover:border-line-green font-bold; }
        .ratio-btn-active { @apply border-line-green bg-green-50 text-line-green font-bold shadow-sm; }
        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <!-- å´é‚Šé¸å–® -->
    <aside :class="isSidebarCollapsed ? 'w-collapsed' : 'w-expanded'" class="sidebar-container text-gray-400 shadow-2xl sidebar-transition">
        <div class="h-16 flex items-center border-b border-gray-700 overflow-hidden shrink-0 sidebar-transition" :class="isSidebarCollapsed ? 'justify-center' : 'px-6'">
            <i class="fab fa-line text-3xl line-green"></i>
            <span v-if="!isSidebarCollapsed" class="ml-4 text-white font-bold whitespace-nowrap tracking-tighter uppercase font-mono transition-opacity">LINEOA CMS</span>
        </div>

        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <sidebar-item icon="fas fa-chart-pie" label="å„€è¡¨æ¿ç¸½è¦½" :active="currentTab === 'dashboard'" @click="currentTab = 'dashboard'" :collapsed="isSidebarCollapsed"></sidebar-item>
            <div class="py-1">
                <sidebar-item icon="fas fa-layer-group" label="æ’ä»¶é–‹ç™¼ç®¡ç†" :active="currentTab === 'messages'" @click="toggleSidebarMenu" :collapsed="isSidebarCollapsed"></sidebar-item>
                <div v-if="isMessageMenuOpen && !isSidebarCollapsed" class="bg-black/20 py-2">
                    <sub-item label="å–®é æ–‡ç«  Flex" :active="currentSubTab === 'single'" @click="currentSubTab = 'single'; currentTab = 'messages'"></sub-item>
                    <a href="video.html" class="flex items-center pl-16 py-2.5 text-sm text-purple-400 hover:text-white transition-colors font-bold">å½±ç‰‡åç‰‡æ’ä»¶ <i class="fas fa-external-link-alt ml-2 text-[8px]"></i></a>
                    <sub-item label="é›»å•†å‹æ’ä»¶" :active="currentSubTab === 'ecommerce'" @click="currentSubTab = 'ecommerce'; currentTab = 'messages'"></sub-item>
                    <a href="mix.html" class="flex items-center pl-16 py-2.5 text-sm text-orange-400 hover:text-white transition-colors font-bold">å¤šé æ··åˆæ’ä»¶ <i class="fas fa-external-link-alt ml-2 text-[8px]"></i></a>
                </div>
            </div>
            <sidebar-item icon="fas fa-box" label="å°ˆæ¡ˆç®¡ç†" :active="currentTab === 'projects'" @click="currentTab = 'projects'" :collapsed="isSidebarCollapsed"></sidebar-item>
        </nav>

        <button @click="isSidebarCollapsed = !isSidebarCollapsed" 
            class="p-4 w-full flex items-center justify-center border-t border-gray-700 hover:text-white transition-colors text-gray-500 bg-gray-900 bg-opacity-30 sidebar-transition">
            <i class="fas" :class="isSidebarCollapsed ? 'fa-indent text-xl' : 'fa-outdent text-xl'"></i>
            <span v-if="!isSidebarCollapsed" class="ml-3 text-xs font-bold uppercase tracking-widest">æ”¶åˆé¸å–®</span>
        </button>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <h2 class="text-xl font-bold text-gray-800">{{ pageTitle }}</h2>
            <div class="flex items-center gap-4">
                <div v-if="isLoggedIn" class="flex items-center gap-2 px-4 py-1.5 bg-green-50 rounded-full border border-green-100 shadow-sm">
                    <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-[10px] text-green-700 font-bold uppercase">Connected</span>
                </div>
                <div v-else @click="login" class="flex items-center gap-2 px-4 py-1.5 bg-yellow-50 rounded-full border border-yellow-200 text-yellow-700 text-xs font-bold cursor-pointer hover:bg-yellow-100 transition-all"><i class="fas fa-sign-in-alt"></i> ç™»å…¥ LINE</div>
                <div class="w-10 h-10 rounded-xl bg-line-green text-white flex items-center justify-center font-bold shadow-md">T</div>
            </div>
        </header>

        <div class="flex-grow overflow-hidden">
            <div v-if="currentTab === 'messages'" class="h-full">
                <article-editor v-if="currentSubTab === 'single'" :initial-data="flexData" @push="handlePush"></article-editor>
                <ecommerce-editor v-if="currentSubTab === 'ecommerce'" :initial-data="ecomState" @push="handlePush"></ecommerce-editor>
            </div>
            <div v-else class="p-10 text-center flex flex-col items-center justify-center h-full text-gray-400">
                <i class="fab fa-line text-6xl text-line-green mb-6"></i>
                <h3 class="text-2xl font-bold font-mono uppercase tracking-widest">CMS PRO PANEL</h3>
                <p class="mt-2 text-sm">è«‹å¾å´é‚Šé¸å–®é–‹å•Ÿæ¨¡çµ„é€²è¡Œç·¨è¼¯ã€‚</p>
            </div>
        </div>
    </main>
</div>

<!-- ==========================================
     æ¨¡çµ„ 1: æ–‡ç« å‹ç·¨è¼¯å™¨
     ========================================== -->
<script type="text/x-template" id="article-editor-template">
<div class="flex h-full w-full overflow-hidden">
    <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
        <div class="max-w-4xl mx-auto space-y-8 pb-10">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-gray-800">æ–‡ç« å‹ Flex é–‹ç™¼</h3>
                <div class="flex gap-2">
                    <button @click="copyJson" class="px-5 py-2 bg-slate-700 text-white rounded-xl text-sm font-bold shadow flex items-center gap-2 hover:bg-slate-800 transition-all"><i class="fas fa-copy"></i> è¤‡è£½ JSON</button>
                    <button @click="$emit('push', { json: flexJson, altText: data.altText })" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow flex items-center gap-2 hover:bg-blue-600 transition-all"><i class="fas fa-paper-plane"></i> ğŸš€ ç›´æ¥æ¨æ’­</button>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                    <label class="input-label">ä¸»è¦–è¦ºåœ–ç‰‡é€£çµ</label><input type="text" v-model="data.imageUrl" class="w-full border rounded p-2 text-sm focus:border-line-green shadow-sm">
                    
                    <div class="bg-white/50 p-4 rounded-lg border space-y-3 shadow-sm">
                        <label class="text-xs font-bold text-gray-600 flex items-center gap-2 cursor-pointer"><input type="checkbox" v-model="data.showBadge" class="accent-line-green"> é¡¯ç¤ºå³ä¸Šæ¨™ç±¤ (å¯¬åº¦éš¨æ–‡å­—ä¼¸ç¸®)</label>
                        <div v-if="data.showBadge" class="grid grid-cols-2 gap-3 pl-6">
                            <div><label class="input-label">æ–‡å­— (é™10å­—)</label><input type="text" v-model="data.badgeText" maxlength="10" class="w-full border rounded p-1.5 text-xs focus:border-line-green" placeholder="è¼¸å…¥æ¨™ç±¤"></div>
                            <div><label class="input-label">æ¨™ç±¤èƒŒæ™¯è‰²</label><input type="color" v-model="data.badgeColor" class="w-full"></div>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between items-end"><label class="input-label">æ¨™é¡Œå…§å®¹</label>
                            <div class="flex bg-slate-100 p-0.5 rounded border"><button v-for="a in ['start','center','end']" @click="data.titleAlign=a" :class="data.titleAlign===a?'bg-white text-line-green shadow-sm':'text-slate-500'" class="p-1 px-2 text-[9px] uppercase font-bold transition-all"><i :class="'fas fa-align-' + (a==='start'?'left':a==='center'?'center':'right')"></i></button></div>
                        </div>
                        <input type="text" v-model="data.title" class="w-full border rounded p-2 text-sm font-bold shadow-sm">
                    </div>
                    <div><label class="input-label">å…§å®¹æè¿° (5px å„ªåŒ–)</label><textarea v-model="data.subtitle" rows="6" class="w-full border rounded p-2 text-sm focus:border-line-green shadow-sm"></textarea></div>
                </div>

                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                    <h4 class="text-sm font-bold mb-4 flex justify-between items-center"><span>åº•éƒ¨ä¸»æŒ‰éˆ•è¨­å®š</span><button @click="addButton" class="text-xs text-line-green font-bold">+ æ–°å¢æŒ‰éˆ•</button></h4>
                    <div class="space-y-3">
                        <div v-for="(btn, idx) in data.buttons" :key="idx" class="flex gap-3 items-center bg-white p-3 rounded-xl border group shadow-sm transition-all hover:border-line-green">
                            <input type="color" v-model="btn.color">
                            <input type="text" v-model="btn.label" class="w-32 border rounded p-1 text-sm font-bold">
                            <input type="text" v-model="btn.uri" class="flex-1 border rounded p-1 text-sm">
                            <button @click="data.buttons.splice(idx,1)" class="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <json-viewer :json="flexJson"></json-viewer>
        </div>
    </div>

    <!-- å³å´ï¼šé–‹æ”¾é è¦½å€ -->
    <div class="w-[450px] shrink-0 open-preview-area shadow-inner bg-slate-200/50 overflow-y-auto no-scrollbar">
        <div class="chat-room-bg no-scrollbar">
            <div class="mb-4 text-[10px] font-bold text-white/50 uppercase tracking-[0.2em] w-full text-center">Live Flex Preview</div>
            <div class="flex-bubble-container">
                <div class="flex-bubble">
                    <div class="relative w-full">
                        <img :src="data.imageUrl" class="w-full aspect-[20/13] object-cover">
                        <div v-if="data.showBadge" class="flex-badge-preview" :style="{ backgroundColor: data.badgeColor }">{{ data.badgeText }}</div>
                    </div>
                    <div class="p-[5px] text-center">
                        <div class="text-base font-bold truncate mt-1" :class="{'text-left': data.titleAlign==='start', 'text-center': data.titleAlign==='center', 'text-right': data.titleAlign==='end'}">{{ data.title || 'æœ€æ–°ç„¦é»' }}</div>
                        <div class="text-[10px] text-gray-500 mt-2 whitespace-pre-wrap leading-relaxed px-1">{{ data.subtitle || 'è«‹è¼¸å…¥å…§å®¹æè¿°...' }}</div>
                    </div>
                    <div class="p-3 pt-0 space-y-1.5"><button v-for="btn in data.buttons" class="w-full py-1.5 text-white text-[10px] font-bold rounded shadow-sm" :style="{ backgroundColor: btn.color }">{{ btn.label }}</button></div>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

<!-- ==========================================
     æ¨¡çµ„ 2: é›»å•†å‹ç·¨è¼¯å™¨ (ä¿®å¾© JSON èˆ‡é è¨­å€¼)
     ========================================== -->
<script type="text/x-template" id="ecommerce-editor-template">
<div class="flex h-full w-full overflow-hidden">
    <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
        <div class="max-w-4xl mx-auto space-y-8 pb-10">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-bold text-gray-800 font-mono">ECOMMERCE_PRO</h3>
                <div class="flex gap-2">
                    <button @click="copyJson" class="px-5 py-2 bg-slate-700 text-white rounded-xl text-sm font-bold shadow flex items-center gap-2 hover:bg-slate-800 transition-all"><i class="fas fa-copy"></i> è¤‡è£½ JSON</button>
                    <button @click="$emit('push', { json: flexJson, altText: state.altText })" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow flex items-center gap-2 hover:bg-blue-600 transition-all"><i class="fas fa-paper-plane"></i> ğŸš€ ç›´æ¥æ¨æ’­</button>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Hero é…ç½® -->
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                    <h4 class="text-sm font-bold flex items-center"><i class="fas fa-image mr-2 text-line-green"></i> é ‚éƒ¨è¦–è¦º (Hero)</h4>
                    <div class="flex bg-slate-100 p-1 rounded-lg border">
                        <button v-for="t in ['image', 'video', 'none']" @click="state.hero.type = t" :class="state.hero.type===t?'bg-white shadow-sm text-line-green':'text-slate-400'" class="flex-1 py-1.5 text-xs font-bold rounded transition-all">{{ t.toUpperCase() }}</button>
                    </div>
                    <div v-if="state.hero.type !== 'none'" class="grid grid-cols-2 gap-4 animate-in fade-in">
                        <div><label class="input-label">é¡¯ç¤ºæ¯”ä¾‹</label><select v-model="state.hero.aspectRatio" class="w-full border rounded p-2 text-xs shadow-sm"><option v-for="a in ['16:9','1:1','1.91:1']" :value="a">{{ a }}</option></select></div>
                        <div><label class="input-label">{{ state.hero.type === 'video' ? 'é è¦½å°é¢åœ– (HTTPS)' : 'åœ–ç‰‡é€£çµ (HTTPS)' }}</label><input type="text" v-model="state.hero.url" class="w-full border rounded p-2 text-xs shadow-sm" placeholder="https://..."></div>
                        <div v-if="state.hero.type === 'video'" class="col-span-2 animate-in slide-in-from-top-2">
                            <label class="input-label text-blue-600">å½±ç‰‡æª”æ¡ˆé€£çµ (.mp4)</label>
                            <input type="text" v-model="state.hero.videoUrl" class="w-full border-2 border-blue-100 rounded p-2 text-xs shadow-sm focus:border-blue-400 outline-none" placeholder="https://...">
                        </div>
                    </div>
                </div>

                <!-- å•†å“é…ç½® -->
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                    <div class="flex justify-between items-center">
                        <h4 class="text-sm font-bold">å•†å“ç¶²æ ¼èˆ‡é¡¯ç¤º</h4>
                        <button @click.stop="addEcomItem" class="text-xs text-line-green font-bold hover:underline">+ æ–°å¢å•†å“</button>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div><label class="input-label">æ¯è¡Œæ¬„æ•¸</label><select v-model="state.body.columns" class="w-full border rounded p-2 text-xs shadow-sm"><option :value="3">3 æ¬„</option><option :value="4">4 æ¬„</option></select></div>
                        <div><label class="input-label">åœ–ç‰‡æ¯”ä¾‹</label>
                            <div class="flex bg-white p-1 border rounded shadow-sm h-[34px]"><button @click="state.body.productRatio = '1:1'" :class="state.body.productRatio==='1:1'?'bg-line-green text-white':'text-gray-400'" class="flex-1 text-[9px] font-bold rounded transition-all">1:1</button><button @click="state.body.productRatio = '16:9'" :class="state.body.productRatio==='16:9'?'bg-line-green text-white':'text-gray-400'" class="flex-1 text-[9px] font-bold rounded ml-1 transition-all">16:9</button></div>
                        </div>
                        <div><label class="input-label">ç¶²æ ¼èƒŒæ™¯è‰²</label><div class="flex items-center gap-2 bg-white p-1 border rounded shadow-sm h-[34px] px-2"><input type="color" v-model="state.body.bgColor"><span class="text-[10px] font-mono uppercase">{{state.body.bgColor}}</span></div></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div v-for="(item, idx) in state.body.items" :key="idx" class="p-4 bg-white border rounded-2xl relative shadow-sm hover:border-line-green transition-all group">
                            <button @click="state.body.items.splice(idx,1)" class="text-gray-300 hover:text-red-500 absolute top-2 right-2 transition-colors"><i class="fas fa-times-circle"></i></button>
                            <div class="flex gap-4 mb-3">
                                <img :src="item.img" class="w-14 h-14 rounded-lg object-cover border" onerror="this.src='https://via.placeholder.com/100?text=Error'">
                                <div class="flex-1"><label class="input-label">å“å</label><input v-model="item.title" class="w-full border-b text-sm font-bold focus:border-line-green outline-none" placeholder="è¼¸å…¥åç¨±"></div>
                            </div>
                            <div class="space-y-2">
                                <label class="input-label">åœ–ç‰‡ç¶²å€</label><input v-model="item.img" class="w-full border rounded p-1.5 text-[10px] bg-slate-50 focus:bg-white transition-all shadow-inner">
                                <label class="input-label">è·³è½‰é€£çµ</label><input v-model="item.url" class="w-full border rounded p-1.5 text-[10px] bg-slate-50 focus:bg-white transition-all shadow-inner">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨è¨­å®š -->
                <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                    <h4 class="text-sm font-bold flex justify-between items-center">
                        <span>åº•éƒ¨è¡Œç‚ºè¨­å®š</span>
                        <label class="flex items-center gap-2 cursor-pointer text-xs font-bold text-blue-600"><input type="checkbox" v-model="state.footer.textEnabled" class="accent-blue-600"> é¡¯ç¤ºèªªæ˜æ–‡å­—</label>
                    </h4>
                    
                    <div v-show="state.footer.textEnabled" class="mb-4 space-y-3 p-4 bg-white border rounded-xl shadow-sm animate-in fade-in duration-300">
                        <div class="flex justify-between items-center">
                            <label class="input-label mb-0">æ¨£å¼è¨­å®š</label>
                            <div class="flex gap-2">
                                <input type="color" v-model="state.footer.textColor">
                                <div class="flex bg-slate-100 p-0.5 rounded border">
                                    <button v-for="a in ['start','center','end']" @click="state.footer.textAlign=a" :class="state.footer.textAlign===a?'bg-white text-line-green shadow-sm':'text-slate-400'" class="p-1 px-2 text-[9px] uppercase font-bold">{{a}}</button>
                                </div>
                            </div>
                        </div>
                        <textarea v-model="state.footer.text" rows="3" class="w-full border rounded p-2 text-xs focus:outline-none focus:border-line-green shadow-inner" placeholder="è«‹è¼¸å…¥åº•éƒ¨èªªæ˜æ–‡å­—..."></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div v-for="b in ['btn1','btn2']" :key="b" class="p-4 bg-white border rounded-xl shadow-sm transition-all hover:border-line-green">
                            <div class="flex items-center justify-between mb-2"><label class="input-label mb-0">æŒ‰éˆ•é¡è‰²</label><input type="color" v-model="state.footer[b].color"></div>
                            <input type="text" v-model="state.footer[b].label" class="w-full border rounded p-2 text-sm font-bold mb-2 shadow-sm">
                            <input type="text" v-model="state.footer[b].uri" class="w-full border rounded p-2 text-[10px] shadow-sm" placeholder="https://...">
                        </div>
                    </div>
                </div>
            </div>
            <json-viewer :json="flexJson"></json-viewer>
        </div>
    </div>

    <!-- å³å´ï¼šé–‹æ”¾é è¦½å€ -->
    <div class="w-[450px] shrink-0 open-preview-area shadow-inner bg-slate-200/50 overflow-y-auto no-scrollbar">
        <div class="chat-room-bg no-scrollbar">
            <div class="mb-4 text-[10px] font-bold text-white/50 uppercase tracking-[0.2em] w-full text-center">Live Ecommerce Preview</div>
            <div class="flex-bubble-container">
                <div class="flex-bubble flex flex-col bg-white shadow-2xl">
                    <!-- é è¦½ Hero -->
                    <div v-show="state.hero.type !== 'none'" :class="getAspectClass(state.hero.aspectRatio)" class="w-full bg-black shrink-0 overflow-hidden relative">
                        <img :src="state.hero.url" class="w-full h-full object-cover">
                        <div v-if="state.hero.type === 'video'" class="absolute inset-0 flex items-center justify-center bg-black/30">
                            <i class="fas fa-play-circle text-white text-4xl opacity-90"></i>
                        </div>
                    </div>
                    
                    <!-- å¹³å‡ç¶²æ ¼ Body -->
                    <div class="p-[5px]" :style="{ backgroundColor: state.body.bgColor }">
                        <div class="flex flex-col gap-[5px]">
                            <div v-for="(row, rIdx) in chunkedItems" :key="rIdx" class="flex gap-[5px]">
                                <div v-for="(item, iIdx) in row" :key="iIdx" class="flex-1 bg-white rounded-sm overflow-hidden flex flex-col shadow-sm">
                                    <div class="w-full overflow-hidden" :style="{ aspectRatio: state.body.productRatio.replace(':', '/') }"><img :src="item.img" class="w-full h-full object-cover"></div>
                                    <div class="bg-black py-1 px-1"><div class="text-[6px] text-white text-center font-bold truncate">{{ item.title || 'å•†å“' }}</div></div>
                                </div>
                                <div v-for="n in (state.body.columns - row.length)" :key="'empty-'+n" class="flex-1 opacity-0"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div class="p-3 border-t bg-white flex flex-col gap-2">
                        <div v-if="state.footer.textEnabled" :style="{ color: state.footer.textColor }" :class="{'text-left': state.footer.textAlign==='start', 'text-center': state.footer.textAlign==='center', 'text-right': state.footer.textAlign==='end'}" class="text-[10px] whitespace-pre-wrap mb-1 px-1 font-medium">{{ state.footer.text }}</div>
                        <div class="flex gap-2">
                            <button v-for="b in [state.footer.btn1, state.footer.btn2]" :key="b.label" :style="{ backgroundColor: b.color }" class="flex-1 py-2 rounded text-[10px] font-bold text-white shadow-sm transition hover:brightness-110">{{ b.label }}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

<script>
const { createApp, ref, computed, onMounted } = Vue;

const forceHttps = (u) => { 
    if (!u || u.trim() === "" || u === "#") return "https://line.me"; 
    let url = u.trim(); 
    if (url.startsWith("http://")) return url.replace("http://", "https://"); 
    return url.startsWith("https://") ? url : "https://" + url; 
};

const cleanJson = (obj) => JSON.parse(JSON.stringify(obj));

const ArticleEditor = {
    props: ['initialData'], template: '#article-editor-template',
    setup(props) {
        const data = ref({ ...JSON.parse(JSON.stringify(props.initialData)), badgeText:'åˆ†äº«', badgeUri:'https://line.me', badgeColor:'#FF0000', showBadge: true, titleAlign: 'center', altText: 'ç²¾é¸æ–‡ç« ' });
        const flexJson = computed(() => {
            const visualBox = { type: "box", layout: "vertical", contents: [{ type: "image", url: forceHttps(data.value.imageUrl), size: "full", aspectRatio: data.value.aspectRatio, aspectMode: "cover" }] };
            if (data.value.showBadge) {
                visualBox.contents.push({
                    type: "box", layout: "vertical", position: "absolute", backgroundColor: data.value.badgeColor,
                    cornerRadius: "xl", paddingTop: "5px", paddingBottom: "2px", paddingStart: "20px", paddingEnd: "20px",
                    offsetTop: "10px", offsetEnd: "10px", 
                    action: { type: "uri", label: "badge", uri: forceHttps(data.value.badgeUri) },
                    contents: [{ type: "text", text: data.value.badgeText || "åˆ†äº«", color: "#ffffff", size: "10px", weight: "bold" }]
                });
            }
            return {
                type: "bubble", body: { type: "box", layout: "vertical", paddingAll: "0px", contents: [ visualBox, { type: "box", layout: "vertical", paddingAll: "5px", contents: [{ type: "text", text: data.value.title || "æ¨™é¡Œå…§å®¹", weight: "bold", size: "xl", align: data.value.titleAlign, wrap: true }, { type: "text", text: data.value.subtitle || "æè¿°æ–‡å­—", size: "sm", margin: "sm", color: "#666666", wrap: true }] } ] },
                footer: { type: "box", layout: "vertical", spacing: "sm", paddingAll: "15px", contents: data.value.buttons.map(b => ({ type: "button", style: "primary", color: b.color, height: "sm", action: { type: "uri", label: b.label || "äº†è§£æ›´å¤š", uri: forceHttps(b.uri) } })) }
            };
        });
        const copyJson = () => { const raw = JSON.stringify(flexJson.value, null, 2); const el = document.createElement('textarea'); el.value = raw; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert('JSON å·²è¤‡è£½ï¼'); };
        return { data, flexJson, copyJson, addButton: () => data.value.buttons.push({ label: 'äº†è§£æ›´å¤š', color: '#00B900', uri: 'https://line.me' }) };
    }
};

const EcommerceEditor = {
    props: ['initialData'], template: '#ecommerce-editor-template',
    setup(props) {
        const state = ref({ ...JSON.parse(JSON.stringify(props.initialData)) });
        if (!state.value.body.productRatio) state.value.body.productRatio = '1:1';
        
        const chunkedItems = computed(() => { const size = state.value.body.columns; const res = []; for (let i = 0; i < state.value.body.items.length; i += size) res.push(state.value.body.items.slice(i, i + size)); return res; });
        
        const flexJson = computed(() => {
            const cur = state.value; const cols = cur.body.columns; const rows = [];
            for (let i = 0; i < cur.body.items.length; i += cols) {
                const chunk = cur.body.items.slice(i, i + cols);
                const rowBox = { type: "box", layout: "horizontal", spacing: "sm", margin: i === 0 ? "none" : "sm", contents: [] };
                chunk.forEach(item => {
                    rowBox.contents.push({
                        type: "box", layout: "vertical", flex: 1, 
                        contents: [
                            { type: "image", url: forceHttps(item.img), aspectRatio: cur.body.productRatio, aspectMode: "cover", size: "full" },
                            { type: "box", layout: "vertical", backgroundColor: "#000000", paddingAll: "xs", contents: [{ type: "text", text: item.title || "å•†å“", color: "#FFFFFF", size: "xxs", align: "center", weight: "bold", wrap: true }] }
                        ],
                        action: { type: "uri", label: "item", uri: forceHttps(item.url) }
                    });
                });
                while (rowBox.contents.length < cols) { rowBox.contents.push({ type: "box", layout: "vertical", flex: 1, contents: [] }); }
                rows.push(rowBox);
            }
            
            const footItems = [];
            if (cur.footer.textEnabled && cur.footer.text) {
                footItems.push({ type: "text", text: cur.footer.text, size: "xs", wrap: true, align: cur.footer.textAlign, color: cur.footer.textColor, margin: "md" });
            }
            footItems.push({ type: "box", layout: "horizontal", spacing: "md", contents: [
                { type: "button", style: "primary", height: "sm", color: cur.footer.btn1.color, action: { type: "uri", label: cur.footer.btn1.label, uri: forceHttps(cur.footer.btn1.uri) } },
                { type: "button", style: "primary", height: "sm", color: cur.footer.btn2.color, action: { type: "uri", label: cur.footer.btn2.label, uri: forceHttps(cur.footer.btn2.uri) } }
            ]});

            const flex = { type: "bubble", size: "mega", body: { type: "box", layout: "vertical", paddingAll: "5px", backgroundColor: cur.body.bgColor, contents: rows }, footer: { type: "box", layout: "vertical", paddingAll: "md", contents: footItems } };
            
            // ä¿®å¾©é—œéµé»ï¼šä¿®æ­£ cur å‘½åï¼Œä¸¦ç”Ÿæˆ Hero
            if (cur.hero.type === 'video' && cur.hero.videoUrl) {
                flex.hero = {
                    type: "video", url: forceHttps(cur.hero.videoUrl), previewUrl: forceHttps(cur.hero.url), aspectRatio: cur.hero.aspectRatio,
                    altContent: { type: "image", url: forceHttps(cur.hero.url), size: "full", aspectMode: "cover" }
                };
            } else if (cur.hero.type === 'image' && cur.hero.url) {
                flex.hero = { type: "image", url: forceHttps(cur.hero.url), size: "full", aspectRatio: cur.hero.aspectRatio, aspectMode: "cover", action: { type: "uri", label: "hero", uri: forceHttps(cur.hero.link || 'https://line.me') } };
            }
            return flex;
        });

        const copyJson = () => { const raw = JSON.stringify(flexJson.value, null, 2); const el = document.createElement('textarea'); el.value = raw; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); alert('JSON å·²è¤‡è£½ï¼'); };
        return { state, flexJson, copyJson, chunkedItems, addEcomItem: () => state.value.body.items.push({ title: "æ–°å•†å“", img: "https://lihi.cc/mwMvo", url: "https://line.me" }), getAspectClass: (a) => ({ '1:1':'aspect-1-1','16:9':'aspect-16-9','1.91:1':'aspect-1_91-1' }[a] || 'aspect-16-9') };
    }
};

createApp({
    components: { 'sidebar-item': { props: ['icon', 'label', 'active', 'collapsed'], template: `<a href="#" @click.prevent="$emit('click')" :class="[active ? 'sidebar-item-active' : '', collapsed ? 'justify-center px-0' : 'px-6 justify-start']" class="flex items-center py-4 hover:bg-gray-700 transition-colors sidebar-transition"><i :class="icon" class="w-8 text-center text-lg"></i><span v-if="!collapsed" class="ml-2 font-medium">{{label}}</span></a>` }, 'sub-item': { props: ['label', 'active'], template: `<a href="#" @click.prevent="$emit('click')" :class="active ? 'submenu-item-active' : ''" class="flex items-center pl-16 py-2.5 text-sm hover:text-white transition-colors">{{label}}</a>` }, 'article-editor': ArticleEditor, 'ecommerce-editor': EcommerceEditor },
    setup() {
        const isSidebarCollapsed = ref(false); const isMessageMenuOpen = ref(true);
        const currentTab = ref('dashboard'); const currentSubTab = ref('single'); const isLoggedIn = ref(false);
        const flexData = ref({ imageUrl: 'https://aiwe.cc/wp-content/uploads/2026/01/a635f6d04823512343614d4ddc692545.jpg', aspectRatio: '20:13', title: 'æœ€æ–°ç„¦é»', subtitle: 'å…§å®¹æè¿°...', buttons: [{ label: 'äº†è§£æ›´å¤š', uri: 'https://line.me', color: '#00B900' }], titleAlign: 'center' });
        
        // è£œå…¨é›»å•†é è¨­ç¯„ä¾‹ç¶²å€ (è€³æ©Ÿç‰¹è³£ç¯„ä¾‹)
        const ecomState = ref({ altText: 'å•†åŸæ´»å‹•', hero: { type: 'video', aspectRatio: '16:9', url: "https://lihi.cc/5OXMZ", videoUrl: "https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/mp4", link: "https://line.me" }, body: { columns: 3, bgColor: "#F8F8F8", productRatio: '1:1', items: [{ title: "ç¶“å…¸é»‘", img: "https://lihi.cc/mwMvo", url: "https://line.me" }, { title: "é…·ç‚«è—", img: "https://lihi.cc/2Nu8G", url: "https://line.me" }, { title: "ç†±æƒ…ç´…", img: "https://lihi.cc/mwMvo", url: "https://line.me" }] }, footer: { textEnabled: true, text: "â€» å…¨é¤¨äº”æŠ˜èµ·ï¼Œé™æ™‚ç‰¹è³£ä¸­ï¼", textColor: "#666666", textAlign: "center", btn1: { label: "é€²å…¥å®˜ç¶²", color: "#000000", uri: "https://line.me" }, btn2: { label: "å¥½å‹åˆ†äº«", color: "#CC0000", uri: "https://line.me" } } });
        
        const handlePush = ({ json, altText }) => { if (!liff.isLoggedIn()) { liff.login(); return; } liff.shareTargetPicker([{ type: "flex", altText: altText || "ç²¾é¸è¨Šæ¯", contents: cleanJson(json) }]).then(res => { if (res) alert("æ¨æ’­æˆåŠŸï¼"); }).catch(err => alert("ç™¼é€å¤±æ•—ï¼šç¶²å€éœ€ç‚º HTTPSã€‚")); };
        onMounted(async () => { try { await liff.init({ liffId: "2008541971-Wgvz6gD8" }); isLoggedIn.value = liff.isLoggedIn(); } catch (e) {} });
        return { isSidebarCollapsed, isMessageMenuOpen, currentTab, currentSubTab, isLoggedIn, flexData, ecomState, pageTitle: computed(() => currentTab.value === 'dashboard' ? 'ä¸»å„€è¡¨æ¿' : { single:'æ–‡ç« å‹æ¨¡çµ„', ecommerce:'é›»å•†å‹æ¨¡çµ„' }[currentSubTab.value]), toggleSidebarMenu: () => { isMessageMenuOpen.value = !isMessageMenuOpen.value; }, login: () => liff.login(), handleSave: () => alert("å·²å„²å­˜å‹•ä½œ"), handlePush };
    }
}).component('json-viewer', { props: ['json'], template: `<div class="mt-8 mb-4 font-mono text-[10px] text-green-400 bg-[#1e2124] p-4 rounded-xl overflow-hidden shadow-inner"><pre class="h-48 overflow-y-auto no-scrollbar font-mono">{{ JSON.stringify(json, null, 2) }}</pre></div>` }).mount('#app');
</script>
</body>
</html>
