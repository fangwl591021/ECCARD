<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>video.html</title>
    <!-- å¼•å…¥ LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        
        /* å´é‚Šæ¬„ */
        .sidebar-container { background-color: #1e2124; height: 100vh; width: 256px; display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        
        /* é–‹æ”¾å¼é è¦½å€ */
        .open-preview-area { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }
        .chat-room-bg { background-color: #8c9bad; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 60px 20px; }
        
        .flex-bubble-container { width: 100%; max-width: 300px; position: relative; }
        .flex-bubble { background: #FFFFFF; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3); }
        
        .header-box { padding: 10px; display: flex; align-items: center; gap: 10px; }
        .video-hero { position: relative; background: #000; width: 100%; aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .grid-item { padding: 10px; border-radius: 10px; text-align: center; }

        .flex-badge-preview { 
            position: absolute; top: 10px; right: 10px; color: white; 
            padding: 5px 20px 3px 20px; border-radius: 30px; 
            font-size: 11px; font-weight: bold; z-index: 20; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            display: inline-block; white-space: nowrap; width: auto;
        }

        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <!-- å´é‚Šæ¬„å°è¦½ -->
    <aside class="sidebar-container text-gray-400 shadow-2xl">
        <div class="h-16 flex items-center px-6 border-b border-gray-700 shrink-0">
            <i class="fab fa-line text-3xl line-green"></i>
            <span class="ml-4 text-white font-bold tracking-tighter uppercase font-mono">Video Pro</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <a href="index.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-home w-8 text-center"></i>
                <span class="ml-2 font-medium">è¿”å›ä¸»å„€è¡¨æ¿</span>
            </a>
            <div class="sidebar-item-active flex items-center py-4 px-6">
                <i class="fas fa-video w-8 text-center"></i>
                <span class="ml-2 font-medium">å½±ç‰‡åç‰‡é–‹ç™¼</span>
            </div>
            <a href="mix.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-clone w-8 text-center"></i>
                <span class="ml-2 font-medium">æ··åˆå¤šé é–‹ç™¼</span>
            </a>
            <a href="project.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-box w-8 text-center"></i>
                <span class="ml-2 font-medium">å°ˆæ¡ˆç®¡ç†ç³»çµ±</span>
            </a>
        </nav>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <div class="flex items-center gap-3">
                <h2 class="text-xl font-bold text-gray-800">å½±ç‰‡åç‰‡æ’ä»¶é–‹ç™¼</h2>
            </div>
            <div class="flex items-center gap-4">
                <!-- å„²å­˜å°ˆæ¡ˆæŒ‰éˆ• -->
                <button @click="initSave" class="px-5 py-2 border border-line-green text-line-green rounded-xl text-sm font-bold hover:bg-green-50 flex items-center gap-2 transition-all">
                    <i class="fas fa-cloud-upload-alt"></i> å„²å­˜å°ˆæ¡ˆ
                </button>
                <button @click="copyJson" class="px-5 py-2 bg-slate-700 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-slate-800 flex items-center gap-2 transition-all">
                    <i class="fas fa-copy"></i> è¤‡è£½ JSON
                </button>
                <button @click="pushVideoCard" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-blue-600 flex items-center gap-2 transition-all">
                    <i class="fas fa-paper-plane"></i> ğŸš€ æ¨æ’­ç™¼é€
                </button>
            </div>
        </header>

        <div class="flex-grow flex overflow-hidden">
            <!-- ç·¨è¼¯å™¨å€å¡Š -->
            <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
                <div class="max-w-4xl mx-auto space-y-8 pb-20">
                    
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                        <label class="input-label text-blue-800">èŠå¤©å®¤é€šçŸ¥æ–‡å­— (altText)</label>
                        <input type="text" v-model="data.altText" class="w-full px-4 py-2 border rounded-xl text-sm outline-none shadow-sm focus:ring-2 focus:ring-blue-200">
                    </div>

                    <!-- è¦–è¦ºæ¨¡å¼åˆ‡æ› -->
                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                        <h4 class="text-sm font-bold text-gray-700 flex items-center"><i class="fas fa-film mr-2 text-line-green"></i> è¦–è¦ºå…§å®¹æ¨¡å¼</h4>
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-300">
                            <button @click="data.visualMode = 'video'" :class="data.visualMode === 'video' ? 'bg-white shadow-sm text-line-green font-bold' : 'text-slate-500'" class="flex-1 py-2 text-xs rounded transition-all">å½±ç‰‡æ¨¡å¼ (Video)</button>
                            <button @click="data.visualMode = 'image'" :class="data.visualMode === 'image' ? 'bg-white shadow-sm text-line-green font-bold' : 'text-slate-500'" class="flex-1 py-2 text-xs rounded transition-all">éœæ…‹åœ–ç‰‡æ¨¡å¼</button>
                        </div>
                        
                        <div v-if="data.visualMode === 'video'" class="space-y-4 animate-in fade-in duration-300">
                            <div><label class="input-label">å½±ç‰‡æª”æ¡ˆé€£çµ (.mp4)</label><input type="text" v-model="data.videoUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green shadow-sm"></div>
                            <div><label class="input-label">å½±ç‰‡é è¦½å°é¢ç¶²å€</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green shadow-sm"></div>
                        </div>
                        <div v-else class="space-y-4 animate-in fade-in duration-300">
                            <div><label class="input-label">å±•ç¤ºåœ–ç‰‡ç¶²å€</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green shadow-sm"></div>
                            <div><label class="input-label">åœ–ç‰‡é»æ“Šè·³è½‰ç¶²å€</label><input type="text" v-model="data.imageActionUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green shadow-sm"></div>
                        </div>
                    </div>

                    <!-- Header å“ç‰Œè¨­å®š -->
                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-6">
                        <h4 class="text-sm font-bold text-gray-700 flex items-center"><i class="fas fa-id-card mr-2 text-line-green"></i> Header å“ç‰Œèˆ‡èƒŒæ™¯é…è‰²</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="input-label">å§“å</label><input type="text" v-model="data.headerName" class="w-full px-4 py-2 border rounded-lg text-sm shadow-sm"></div>
                            <div><label class="input-label">æ•˜è¿° (20å­—)</label><input type="text" v-model="data.headerDescription" maxlength="20" class="w-full px-4 py-2 border rounded-lg text-sm shadow-sm"></div>
                            <div class="col-span-2"><label class="input-label">é ­åƒé€£çµ</label><input type="text" v-model="data.headerImg" class="w-full px-4 py-2 border rounded-lg text-sm shadow-sm"></div>
                            <div><label class="input-label">Header èƒŒæ™¯</label><input type="color" v-model="data.headerBgColor" class="w-full h-10 border rounded"></div>
                            <div><label class="input-label">Header æ–‡å­—é¡è‰²</label><input type="color" v-model="data.headerTextColor" class="w-full h-10 border rounded"></div>
                        </div>
                    </div>

                    <!-- ç¶²æ ¼æŒ‰éˆ•è¨­å®š -->
                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-sm font-bold text-gray-700">åŠŸèƒ½ç¶²æ ¼ (åŒæ­¥é…è‰²)</h4>
                            <div class="flex items-center gap-2"><span class="text-[10px] text-gray-400 font-bold">æŒ‰éˆ•èƒŒæ™¯</span><input type="color" v-model="data.gridBgColor"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div v-for="(grid, idx) in data.gridButtons" :key="idx" class="p-4 bg-white border rounded-xl shadow-sm space-y-2 group transition-all hover:border-line-green">
                                <div class="flex gap-2"><input type="text" v-model="grid.emoji" class="w-10 border rounded text-sm text-center shadow-inner"><input type="text" v-model="grid.label" class="flex-1 border rounded px-2 py-1 text-xs shadow-inner" placeholder="æŒ‰éˆ•æ¨™é¡Œ"></div>
                                <input type="text" v-model="grid.uri" class="w-full border rounded px-2 py-1 text-[10px] shadow-inner" placeholder="https://...">
                            </div>
                        </div>
                    </div>

                    <!-- åº•éƒ¨æŒ‰éˆ• -->
                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                        <h4 class="text-sm font-bold text-gray-700 mb-4">åº•éƒ¨è¡Œç‚ºæŒ‰éˆ• (å›ºå®š Sm)</h4>
                        <div v-for="(vBtn, idx) in data.videoFooterButtons" :key="idx" class="flex gap-3 items-center mb-3 p-4 bg-white border rounded-xl shadow-sm">
                            <input type="color" v-model="vBtn.color">
                            <div class="flex-1"><input type="text" v-model="vBtn.label" class="w-full border rounded-lg p-2 text-sm font-bold shadow-sm" placeholder="æ–‡å­—"></div>
                            <div class="flex-[2]"><input type="text" v-model="vBtn.uri" class="w-full border rounded-lg p-2 text-sm shadow-sm" placeholder="https://..."></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šé–‹æ”¾é è¦½å€ -->
            <div class="w-[450px] shrink-0 open-preview-area shadow-inner bg-slate-200/50 overflow-y-auto no-scrollbar">
                <div class="chat-room-bg no-scrollbar">
                    <div class="flex-bubble-container">
                        <div class="flex-bubble">
                            <div class="header-box" :style="{ backgroundColor: data.headerBgColor }">
                                <img :src="data.headerImg" class="w-10 h-10 rounded-full object-cover border border-gray-700 shadow-sm">
                                <div class="flex flex-col overflow-hidden">
                                    <span class="text-[11px] font-bold uppercase truncate" :style="{ color: data.headerTextColor }">{{ data.headerName || 'å§“å' }}</span>
                                    <span class="text-[8px] leading-tight truncate" :style="{ color: data.headerTextColor, opacity: 0.8 }">{{ data.headerDescription || 'æ•˜è¿°' }}</span>
                                </div>
                            </div>
                            <div class="video-hero">
                                <img :src="data.previewUrl" class="w-full h-full object-cover opacity-60">
                                <i v-if="data.visualMode === 'video'" class="fas fa-play-circle text-white text-4xl absolute opacity-90 drop-shadow-xl"></i>
                            </div>
                            <div class="grid-box" :style="{ backgroundColor: data.headerBgColor }">
                                <div v-for="grid in data.gridButtons" class="grid-item shadow-sm" :style="{ backgroundColor: data.gridBgColor }">
                                    <div class="text-xl mb-1">{{ grid.emoji }}</div>
                                    <div class="text-[8px] text-gray-300 font-bold uppercase truncate px-1">{{ grid.label || 'é¸å–®' }}</div>
                                </div>
                            </div>
                            <div class="p-3 pt-0 space-y-2" :style="{ backgroundColor: data.headerBgColor }">
                                <button v-for="vBtn in data.videoFooterButtons" class="w-full py-2 text-[10px] font-bold rounded shadow-md" :style="{ backgroundColor: vBtn.color, color: '#fff' }">{{ vBtn.label }}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- å„²å­˜å°ˆæ¡ˆå½ˆçª— -->
    <div v-if="showSaveModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] backdrop-blur-sm">
        <div class="bg-white rounded-[32px] p-10 max-w-md w-full shadow-2xl animate-in zoom-in duration-300">
            <h3 class="text-2xl font-bold mb-2 text-gray-800">å„²å­˜å½±ç‰‡åç‰‡å°ˆæ¡ˆ</h3>
            <p class="text-xs text-gray-400 mb-8 font-medium">å°‡åŒæ­¥å¯«å…¥ cards å·¥ä½œè¡¨ä¸¦ç™¼é€æ¨æ’­</p>
            <div class="space-y-6">
                <div>
                    <label class="input-label">å°ˆæ¡ˆåç¨± (cardTitle)</label>
                    <input type="text" v-model="projectName" class="w-full border rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-line-green text-lg font-bold" placeholder="ä¾‹å¦‚ï¼šTony çš„å½±ç‰‡åç‰‡">
                </div>
            </div>
            <div class="flex gap-3 mt-10">
                <button @click="showSaveModal = false" class="flex-1 py-3 text-gray-400 font-bold hover:text-gray-600 transition-colors">å–æ¶ˆ</button>
                <button @click="confirmSave" :disabled="isSaving" class="flex-[2] py-3 bg-line-green text-white rounded-2xl font-bold shadow-lg hover:brightness-110 transition-all flex items-center justify-center gap-2">
                    <i v-if="isSaving" class="fas fa-circle-notch animate-spin"></i>
                    <span>{{ isSaving ? 'å‚³é€ä¸­...' : 'ç¢ºèªå„²å­˜' }}</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

const forceHttps = (u) => {
    if (!u || u.trim() === "" || u === "#") return "https://line.me";
    let url = u.trim();
    if (url.startsWith("http://")) return url.replace("http://", "https://");
    return url.startsWith("https://") ? url : "https://" + url;
};

// --- è«‹æ›´æ›ç‚ºæ‚¨çš„çœŸå¯¦ Worker ç¶²å€ ---
const workerUrl = "https://lineoa.fangwl591021.workers.dev"; 

createApp({
    setup() {
        const isLoggedIn = ref(false);
        const userProfile = ref({ userId: '', displayName: '', pictureUrl: '' });
        const showSaveModal = ref(false);
        const isSaving = ref(false);
        const projectName = ref('');

        const data = ref({
            altText: 'å½±ç‰‡åç‰‡è¨Šæ¯',
            visualMode: 'video', 
            imageActionUrl: 'https://line.me',
            headerName: 'TONY',
            headerDescription: 'ç³»çµ±é–‹ç™¼æœå‹™',
            headerImg: 'https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png',
            headerBgColor: '#1A1B1E',
            headerTextColor: '#D4AF37',
            bodyBgColor: '#0F0F10',
            gridBgColor: '#2A2C31',
            videoUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/mp4',
            previewUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/m800x1200',
            gridButtons: [ 
                { emoji: 'ğŸ¤–', label: 'AI è«®è©¢', uri: 'https://line.me' }, 
                { emoji: 'ğŸ¥', label: 'ç”¢å“ä»‹ç´¹', uri: 'https://line.me' }, 
                { emoji: 'ğŸ§¾', label: 'å•†å“å‹éŒ„', uri: 'https://line.me' }, 
                { emoji: 'ğŸ“', label: 'é–€å¸‚è³‡è¨Š', uri: 'https://line.me' } 
            ], 
            videoFooterButtons: [ 
                { label: 'ğŸš€ å•Ÿå‹• AI å°å¹«æ‰‹', uri: 'https://line.me', color: '#C9A24D' }, 
                { label: 'ğŸ“¤ åˆ†äº«å¥½å‹', uri: 'https://line.me', color: '#2A2C31' } 
            ]
        });

        const flexJson = computed(() => {
            const cur = data.value;
            const bubble = {
                type: "bubble", size: "mega",
                header: {
                    type: "box", layout: "horizontal", spacing: "md", paddingAll: "8px", backgroundColor: cur.headerBgColor,
                    contents: [
                        { type: "image", url: forceHttps(cur.headerImg), size: "xs", aspectRatio: "1:1", aspectMode: "cover", gravity: "center" },
                        { type: "box", layout: "vertical", spacing: "xs", flex: 3, contents: [
                            { type: "text", text: cur.headerName || "å§“å", weight: "bold", size: "lg", color: cur.headerTextColor },
                            { type: "text", text: cur.headerDescription || "æè¿°", size: "xs", color: cur.headerTextColor, wrap: true }
                        ]}
                    ]
                },
                body: {
                    type: "box", layout: "vertical", paddingAll: "8px", backgroundColor: cur.headerBgColor,
                    contents: [{
                        type: "box", layout: "vertical", spacing: "sm", paddingAll: "12px", backgroundColor: cur.headerBgColor, cornerRadius: "14px",
                        contents: [
                            { type: "box", layout: "horizontal", spacing: "sm", contents: cur.gridButtons.slice(0, 2).map(g => ({
                                type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: cur.gridBgColor, cornerRadius: "12px",
                                action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) },
                                contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "GRID", size: "sm", align: "center", color: "#E6E6E6" }]
                            }))},
                            { type: "box", layout: "horizontal", spacing: "sm", contents: cur.gridButtons.slice(2, 4).map(g => ({
                                type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: cur.gridBgColor, cornerRadius: "12px",
                                action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) },
                                contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "GRID", size: "sm", align: "center", color: "#E6E6E6" }]
                            }))}
                        ]
                    }]
                },
                footer: {
                    type: "box", layout: "vertical", spacing: "sm", paddingAll: "8px", backgroundColor: cur.headerBgColor,
                    contents: cur.videoFooterButtons.map(b => ({
                        type: "button", style: "primary", height: "sm", color: b.color,
                        action: { type: "uri", label: b.label || "OK", uri: forceHttps(b.uri) }
                    }))
                }
            };
            if (cur.visualMode === 'video') {
                bubble.hero = { type: "video", url: forceHttps(cur.videoUrl), previewUrl: forceHttps(cur.previewUrl), aspectRatio: "16:9", altContent: { type: "image", url: forceHttps(cur.previewUrl), size: "full", aspectMode: "cover" } };
            } else {
                bubble.hero = { type: "image", url: forceHttps(cur.previewUrl), size: "full", aspectRatio: "16:9", aspectMode: "cover", action: { type: "uri", label: "hero", uri: forceHttps(cur.imageActionUrl) } };
            }
            return bubble;
        });

        const initSave = () => { showSaveModal.value = true; };

        const confirmSave = async () => {
            if (!projectName.value) { alert("è«‹è¼¸å…¥å°ˆæ¡ˆåç¨±"); return; }
            isSaving.value = true;
            
            const cur = data.value;
            const now = new Date().toISOString();

            const payload = {
                userId: userProfile.value.userId || 'GUEST',
                displayName: userProfile.value.displayName || 'è¨ªå®¢',
                pictureUrl: userProfile.value.pictureUrl || '',
                cardId: 'ID_' + Date.now(),
                cardType: 'card', // å°æ‡‰å°ˆæ¡ˆç®¡ç†ä¸­çš„é¡å‹
                cardTitle: projectName.value,
                isActive: true,
                shareSlug: Math.random().toString(36).substring(2, 10),
                'header.name': cur.headerName,
                'header.subtitle': cur.headerDescription,
                'header.avatarUrl': cur.headerImg,
                'header.bgColor': cur.headerBgColor,
                'hero.mode': cur.visualMode,
                'hero.video.url': cur.videoUrl,
                'hero.video.previewUrl': cur.previewUrl,
                'hero.image.url': cur.previewUrl,
                createdAt: now, updatedAt: now,
                cardJson: JSON.stringify(flexJson.value),
                flexPayload: flexJson.value 
            };

            try {
                const res = await fetch(workerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await res.json();
                if (result.status === 'success') {
                    alert("å½±ç‰‡åç‰‡å°ˆæ¡ˆå„²å­˜æˆåŠŸä¸”æ¨æ’­å·²ç™¼é€ï¼");
                    showSaveModal.value = false;
                    projectName.value = '';
                } else { alert("å„²å­˜å¤±æ•—: " + result.message); }
            } catch (e) { alert("é€£ç·šå¤±æ•—ï¼Œè«‹ç¢ºèª Worker URLã€‚"); }
            finally { isSaving.value = false; }
        };

        const pushVideoCard = () => {
            if (!liff.isLoggedIn()) { liff.login(); return; }
            liff.shareTargetPicker([{ type: "flex", altText: data.value.altText || "å½±ç‰‡åç‰‡", contents: flexJson.value }])
            .then(res => { if (res) alert("æ¨æ’­æˆåŠŸï¼"); });
        };

        const copyJson = () => {
            navigator.clipboard.writeText(JSON.stringify(flexJson.value, null, 2));
            alert('å½±ç‰‡åç‰‡ JSON å·²è¤‡è£½ï¼');
        };

        onMounted(async () => {
            try { 
                await liff.init({ liffId: "2008541971-Wgvz6gD8" }); 
                isLoggedIn.value = liff.isLoggedIn();
                if (isLoggedIn.value) userProfile.value = await liff.getProfile();
            } catch (e) {}
        });

        return { data, flexJson, isLoggedIn, userProfile, pushVideoCard, copyJson, initSave, confirmSave, showSaveModal, projectName, isSaving };
    }
}).mount('#app');
</script>
</body>
</html>
