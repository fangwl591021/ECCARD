<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>video.html</title>
    <!-- å¼•å…¥ LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f6; overflow: hidden; }
        .line-green { color: #00B900; }
        .bg-line-green { background-color: #00B900; }
        
        .sidebar-container { background-color: #1e2124; height: 100vh; width: 256px; display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .sidebar-item-active { background-color: #374151; color: white; border-left: 4px solid #00B900; }
        
        .preview-window { width: 300px; height: 560px; background: #0F0F10; border: 10px solid #333; border-radius: 32px; overflow-y: auto; position: relative; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); }
        .preview-window::-webkit-scrollbar { width: 0px; }
        .flex-bubble { background: #FFFFFF; border-radius: 12px; overflow: hidden; width: 250px; margin: 0 auto; border: 1px solid #333; }
        .flex-bubble-dark { background: #1F2024; color: white; }
        
        .header-box { padding: 10px; display: flex; align-items: center; gap: 10px; }
        .video-hero { position: relative; background: #000; width: 100%; aspect-ratio: 800/500; display: flex; align-items: center; justify-content: center; }
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .grid-item { padding: 10px; border-radius: 10px; text-align: center; transition: background-color 0.3s; }

        .input-label { @apply block text-[11px] font-bold text-gray-500 uppercase mb-1 ml-1 tracking-wider; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 24px; height: 24px; cursor: pointer; background: none; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: 1px solid #ddd; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="app" class="flex h-screen overflow-hidden text-gray-800">
    <aside class="sidebar-container text-gray-400 shadow-2xl">
        <div class="h-16 flex items-center px-6 border-b border-gray-700 shrink-0">
            <i class="fab fa-line text-3xl line-green"></i>
            <span class="ml-4 text-white font-bold whitespace-nowrap tracking-tighter uppercase font-mono">Video Pro</span>
        </div>
        <nav class="mt-6 flex-grow overflow-y-auto no-scrollbar whitespace-nowrap">
            <a href="index.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-home w-8 text-center"></i>
                <span class="ml-2 font-medium">è¿”å›ä¸»å„€è¡¨æ¿</span>
            </a>
            <div class="sidebar-item-active flex items-center py-4 px-6">
                <i class="fas fa-video w-8 text-center"></i>
                <span class="ml-2 font-medium">å½±ç‰‡åç‰‡é–‹ç™¼</span>
            </div>
            <a href="mix.html" class="flex items-center py-4 px-6 hover:bg-gray-700 transition-colors">
                <i class="fas fa-clone w-8 text-center"></i>
                <span class="ml-2 font-medium">æ··åˆå¤šé é–‹ç™¼</span>
            </a>
        </nav>
        <div class="p-6 text-[10px] text-gray-500 border-t border-gray-700 font-mono text-center">
            LIFF ID: Wgvz6gD8
        </div>
    </aside>

    <main class="flex-grow flex flex-col h-full relative overflow-hidden bg-[#f8fafc]">
        <header class="h-16 bg-white border-b flex items-center justify-between px-8 shrink-0 shadow-sm z-10">
            <div class="flex items-center gap-3">
                <h2 class="text-xl font-bold text-gray-800">å½±ç‰‡åç‰‡æ’ä»¶é–‹ç™¼</h2>
                <span class="px-2 py-0.5 bg-green-100 text-green-600 text-[10px] font-bold rounded">JSON FIXED</span>
            </div>
            <div class="flex items-center gap-4">
                <div v-if="isLoggedIn" class="flex items-center gap-2 px-4 py-1.5 bg-green-50 rounded-full border border-green-100 shadow-sm">
                    <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-[10px] text-green-700 font-bold uppercase">Connected</span>
                </div>
                <div class="flex gap-2">
                    <button @click="copyJson" class="px-5 py-2 bg-slate-700 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-slate-800 flex items-center gap-2 transition-all">
                        <i class="fas fa-copy"></i> è¤‡è£½ JSON
                    </button>
                    <button @click="pushVideoCard" class="px-6 py-2 bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-blue-600 flex items-center gap-2 transition-all">
                        <i class="fas fa-paper-plane"></i> ğŸš€ æ¨æ’­ç™¼é€æ¸¬è©¦
                    </button>
                </div>
            </div>
        </header>

        <div class="flex-grow flex overflow-hidden">
            <div class="flex-grow overflow-y-auto p-8 bg-white border-r no-scrollbar">
                <div class="max-w-4xl mx-auto space-y-8 pb-20">
                    
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                        <label class="input-label text-blue-800">èŠå¤©å®¤é€šçŸ¥æ–‡å­— (altText)</label>
                        <input type="text" v-model="data.altText" class="w-full px-4 py-2 border rounded-xl text-sm outline-none shadow-sm focus:ring-2 focus:ring-blue-200">
                    </div>

                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-6">
                        <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center"><i class="fas fa-id-card mr-2 text-line-green"></i> Header å“ç‰Œèˆ‡èƒŒæ™¯é…è‰²</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="input-label">å§“å / å“ç‰Œå</label><input type="text" v-model="data.headerName" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                            <div><label class="input-label">æ•˜è¿°æè¿° (é™20å­—)</label><input type="text" v-model="data.headerDescription" maxlength="20" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                            <div class="col-span-2"><label class="input-label">é ­åƒç¶²å€ (HTTPS)</label><input type="text" v-model="data.headerImg" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                            <div>
                                <label class="input-label">Header èƒŒæ™¯è‰²</label>
                                <div class="flex items-center gap-2 bg-white p-1.5 border rounded-lg"><input type="color" v-model="data.headerBgColor"><span class="text-[10px] font-mono">{{data.headerBgColor}}</span></div>
                            </div>
                            <div>
                                <label class="input-label">Header æ–‡å­—é¡è‰²</label>
                                <div class="flex items-center gap-2 bg-white p-1.5 border rounded-lg"><input type="color" v-model="data.headerTextColor"><span class="text-[10px] font-mono">{{data.headerTextColor}}</span></div>
                            </div>
                            <div class="col-span-2">
                                <label class="input-label">Body èƒŒæ™¯è‰²</label>
                                <div class="flex items-center gap-2 bg-white p-1.5 border rounded-lg"><input type="color" v-model="data.bodyBgColor"><span class="text-[10px] font-mono">{{data.bodyBgColor}}</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm space-y-4">
                        <h4 class="text-sm font-bold text-gray-700 flex items-center"><i class="fas fa-film mr-2 text-line-green"></i> è¦–è¦ºå…§å®¹æ¨¡å¼è¨­å®š</h4>
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-300">
                            <button @click="data.visualMode = 'video'" :class="data.visualMode === 'video' ? 'bg-white shadow-sm text-line-green font-bold' : 'text-slate-500'" class="flex-1 py-2 text-xs rounded transition-all">å½±ç‰‡æ’­æ”¾æ¨¡å¼</button>
                            <button @click="data.visualMode = 'image'" :class="data.visualMode === 'image' ? 'bg-white shadow-sm text-line-green font-bold' : 'text-slate-500'" class="flex-1 py-2 text-xs rounded transition-all">éœæ…‹åœ–ç‰‡æ¨¡å¼</button>
                        </div>
                        
                        <div v-if="data.visualMode === 'video'" class="space-y-4 fade-in">
                            <div><label class="input-label">å½±ç‰‡é€£çµ (Video MP4 URL)</label><input type="text" v-model="data.videoUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                            <div><label class="input-label">å½±ç‰‡é è¦½å°é¢ç¶²å€ (Preview URL)</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                        </div>
                        <div v-else class="space-y-4 fade-in">
                            <div><label class="input-label">å±•ç¤ºåœ–ç‰‡ç¶²å€ (Image URL)</label><input type="text" v-model="data.previewUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                            <div><label class="input-label">åœ–ç‰‡é»æ“Šè·³è½‰ç¶²å€ (Action URL)</label><input type="text" v-model="data.imageActionUrl" class="w-full px-4 py-2 border rounded-lg text-sm focus:border-line-green outline-none"></div>
                        </div>
                    </div>

                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-sm font-bold text-gray-700">ç¶²æ ¼åŠŸèƒ½æŒ‰éˆ• (åŒæ­¥é…è‰²)</h4>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] text-gray-400 font-bold uppercase">æŒ‰éˆ•èƒŒæ™¯è‰²</span>
                                <input type="color" v-model="data.gridBgColor">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div v-for="(grid, idx) in data.gridButtons" :key="idx" class="p-4 bg-white border rounded-xl shadow-sm space-y-2">
                                <div class="flex gap-2 mb-1">
                                    <input type="text" v-model="grid.emoji" class="w-10 border rounded text-sm text-center">
                                    <input type="text" v-model="grid.label" class="flex-1 border rounded px-2 py-1 text-xs">
                                </div>
                                <label class="input-label">è·³è½‰ç¶²å€</label>
                                <input type="text" v-model="grid.uri" class="w-full border rounded px-2 py-1 text-[10px]">
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#f8fafc] p-6 rounded-2xl border shadow-sm">
                        <h4 class="text-sm font-bold text-gray-700 mb-4">åº•éƒ¨è¡Œç‚ºæŒ‰éˆ•è¨­å®š (å›ºå®š Sm)</h4>
                        <div v-for="(vBtn, idx) in data.videoFooterButtons" :key="idx" class="flex gap-3 items-center mb-3 p-4 bg-white border rounded-xl shadow-sm transition-all hover:border-green-100">
                            <div class="shrink-0 text-center"><label class="text-[9px] block text-gray-400 font-bold uppercase tracking-tight">èƒŒæ™¯</label><input type="color" v-model="vBtn.color"></div>
                            <div class="flex-1"><label class="input-label">æŒ‰éˆ•åç¨±</label><input type="text" v-model="vBtn.label" class="w-full border rounded-lg p-2 text-sm font-bold"></div>
                            <div class="flex-[2]"><label class="input-label">é»æ“Šé€£çµ</label><input type="text" v-model="vBtn.uri" class="w-full border rounded-lg p-2 text-sm"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-[360px] shrink-0 bg-gray-50 flex items-center justify-center py-8 no-scrollbar shadow-inner">
                <div class="preview-window">
                    <div class="p-3 border-b border-gray-800 bg-[#1A1B1E] flex items-center gap-2 sticky top-0 z-50">
                        <i class="fas fa-chevron-left text-gray-600 text-xs"></i>
                        <span class="text-[9px] font-bold text-gray-500 uppercase tracking-tighter">LINE Preview</span>
                    </div>
                    <div class="p-4 h-full" :style="{ backgroundColor: data.bodyBgColor }">
                        <div class="flex-bubble flex-bubble-dark shadow-2xl mt-4" :style="{ backgroundColor: data.bodyBgColor }">
                            <!-- Header -->
                            <div class="header-box" :style="{ backgroundColor: data.headerBgColor }">
                                <img :src="data.headerImg" class="w-10 h-10 rounded-full object-cover border border-gray-700 shadow-sm">
                                <div class="flex flex-col overflow-hidden">
                                    <span class="text-[11px] font-bold uppercase truncate" :style="{ color: data.headerTextColor }">{{ data.headerName || 'å§“å' }}</span>
                                    <span class="text-[8px] opacity-80 leading-tight truncate" :style="{ color: data.headerTextColor }">{{ data.headerDescription || 'æ•˜è¿°' }}</span>
                                </div>
                            </div>
                            <!-- Hero -->
                            <div class="video-hero">
                                <img :src="data.previewUrl" class="w-full h-full object-cover opacity-60">
                                <i v-if="data.visualMode === 'video'" class="fas fa-play-circle text-white text-4xl absolute opacity-90 drop-shadow-xl"></i>
                            </div>
                            <!-- Grid -->
                            <div class="grid-box" :style="{ backgroundColor: data.bodyBgColor }">
                                <div v-for="grid in data.gridButtons" class="grid-item shadow-sm" :style="{ backgroundColor: data.gridBgColor }">
                                    <div class="text-xl mb-1">{{ grid.emoji }}</div>
                                    <div class="text-[8px] text-gray-300 font-bold uppercase truncate">{{ grid.label }}</div>
                                </div>
                            </div>
                            <!-- Footer Buttons -->
                            <div class="p-3 pt-0 space-y-2" :style="{ backgroundColor: data.bodyBgColor }">
                                <button v-for="(vBtn, vI) in data.videoFooterButtons" class="w-full py-2 text-[10px] font-bold rounded shadow-md" 
                                    :style="{ backgroundColor: vBtn.color, color: '#fff' }">
                                    {{ vBtn.label }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

const forceHttps = (u) => {
    if (!u || u.trim() === "" || u === "#") return "https://line.me";
    let url = u.trim();
    if (url.startsWith("http://")) return url.replace("http://", "https://");
    if (!url.startsWith("https://") && !url.startsWith("line://")) return "https://" + url;
    return url;
};

const cleanJson = (obj) => JSON.parse(JSON.stringify(obj));

createApp({
    setup() {
        const isLoggedIn = ref(false);

        const data = ref({
            altText: 'æ‚¨æ”¶åˆ°äº†ä¸€å‰‡åç‰‡è¨Šæ¯',
            visualMode: 'video', 
            imageActionUrl: 'https://line.me',
            headerName: 'TONY',
            headerDescription: 'ç³»çµ±é–‹ç™¼æœå‹™',
            headerImg: 'https://aiwe.cc/wp-content/uploads/2025/04/f9ebd0672d3b0ac370272909a493d4db.png',
            headerBgColor: '#1A1B1E',
            headerTextColor: '#D4AF37',
            bodyBgColor: '#0F0F10',
            gridBgColor: '#2A2C31',
            videoUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/mp4',
            previewUrl: 'https://voom-obs.line-scdn.net/ho1sEMNWDLB8UUD8RLAYrZjJoJzAxV3cPGT8MeBQ_J2YzD3JIGgELJDl3bm4xeSUUJy9_IhBjCiYfajYJIBEMORdaCXUceRQXDigUOQpZHg/m800x1200',
            gridButtons: [ 
                { emoji: 'ğŸ¤–', label: 'AI è«®è©¢', uri: 'https://liff.line.me/2006625044-bPGxrB53/' }, 
                { emoji: 'ğŸ¥', label: 'ç”¢å“ä»‹ç´¹', uri: 'https://line.me' }, 
                { emoji: 'ğŸ§¾', label: 'å•†å“å‹éŒ„', uri: 'https://line.me' }, 
                { emoji: 'ğŸ“', label: 'é–€å¸‚è³‡è¨Š', uri: 'https://line.me' } 
            ], 
            videoFooterButtons: [ 
                { label: 'ğŸš€ å•Ÿå‹• AI å°å¹«æ‰‹', uri: 'https://liff.line.me/2006625044-bPGxrB53/index.php/colt_sp/6502/', color: '#C9A24D' }, 
                { label: 'ğŸ“¤ åˆ†äº«å¥½å‹', uri: 'https://liff.line.me/2006625044-J42EzjkZ/index.php/linecard_12/6816/', color: '#2A2C31' } 
            ]
        });

        const flexJson = computed(() => {
            const current = data.value;
            const bubble = {
                type: "bubble",
                size: "mega",
                header: {
                    type: "box", layout: "horizontal", spacing: "md", paddingAll: "8px", backgroundColor: current.headerBgColor,
                    contents: [
                        { type: "image", url: forceHttps(current.headerImg), size: "xs", aspectRatio: "1:1", aspectMode: "cover", gravity: "center" },
                        { type: "box", layout: "vertical", spacing: "xs", flex: 3, contents: [
                            { type: "text", text: current.headerName || "TONY", weight: "bold", size: "lg", color: current.headerTextColor },
                            { type: "text", text: "LINEè¡ŒéŠ·é”äºº", size: "sm", color: current.headerTextColor },
                            { type: "text", text: current.headerDescription || "æœå‹™ä»‹ç´¹", size: "xs", color: current.headerTextColor, wrap: true }
                        ]}
                    ]
                },
                body: {
                    type: "box", layout: "vertical", paddingAll: "8px", backgroundColor: current.bodyBgColor,
                    contents: [{
                        type: "box", layout: "vertical", spacing: "sm", paddingAll: "12px", backgroundColor: current.bodyBgColor, cornerRadius: "14px",
                        contents: [
                            { type: "box", layout: "horizontal", spacing: "sm", contents: current.gridButtons.slice(0, 2).map(g => ({
                                type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: current.gridBgColor, cornerRadius: "12px",
                                action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) },
                                contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "GRID", size: "sm", align: "center", color: "#E6E6E6" }]
                            }))},
                            { type: "box", layout: "horizontal", spacing: "sm", contents: current.gridButtons.slice(2, 4).map(g => ({
                                type: "box", layout: "vertical", paddingAll: "10px", backgroundColor: current.gridBgColor, cornerRadius: "12px",
                                action: { type: "uri", label: g.label || "grid", uri: forceHttps(g.uri) },
                                contents: [{ type: "text", text: g.emoji || "ğŸ”˜", align: "center", size: "xl" }, { type: "text", text: g.label || "GRID", size: "sm", align: "center", color: "#E6E6E6" }]
                            }))}
                        ]
                    }]
                },
                footer: {
                    type: "box", layout: "vertical", spacing: "sm", paddingAll: "8px", backgroundColor: current.bodyBgColor,
                    contents: current.videoFooterButtons.map(b => ({
                        type: "button", style: "primary", height: "sm", color: b.color,
                        action: { type: "uri", label: b.label || "OK", uri: forceHttps(b.uri) }
                    }))
                },
                styles: { body: { backgroundColor: current.bodyBgColor }, footer: { backgroundColor: current.bodyBgColor } }
            };

            if (current.visualMode === 'video') {
                bubble.hero = {
                    type: "video", url: forceHttps(current.videoUrl), previewUrl: forceHttps(current.previewUrl), aspectRatio: "800:500",
                    altContent: { 
                        type: "image", url: forceHttps(current.previewUrl), size: "full", aspectMode: "cover" 
                    }
                };
            } else {
                bubble.hero = {
                    type: "image", url: forceHttps(current.previewUrl), size: "full", aspectRatio: "800:500", aspectMode: "cover",
                    action: { type: "uri", label: "HeroLink", uri: forceHttps(current.imageActionUrl) }
                };
            }
            return bubble;
        });

        const copyJson = () => {
            const raw = JSON.stringify(flexJson.value, null, 2);
            const el = document.createElement('textarea');
            el.value = raw;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert('JSON å·²è¤‡è£½ï¼');
        };

        const pushVideoCard = () => {
            if (!liff.isLoggedIn()) { liff.login(); return; }
            const payload = cleanJson(flexJson.value);
            liff.shareTargetPicker([{ type: "flex", altText: data.value.altText || "å½±ç‰‡åç‰‡", contents: payload }])
            .then(res => { if (res) alert("æ¨æ’­ç™¼é€æˆåŠŸï¼"); })
            .catch(err => { alert("ç™¼é€å¤±æ•—ï¼šè«‹ç¢ºä¿é€£çµç¶²å€ç‚º HTTPS ä¸”ä¸åŒ…å« opacity ç­‰ä¸æ”¯æ´æ¬„ä½ã€‚"); });
        };

        onMounted(async () => {
            try { await liff.init({ liffId: "2008541971-Wgvz6gD8" }); isLoggedIn.value = liff.isLoggedIn(); } catch (e) {}
        });

        return { data, flexJson, isLoggedIn, pushVideoCard, copyJson, login: () => liff.login() };
    }
}).mount('#app');
</script>
</body>
</html>
