<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>個人單頁名片生成器 - 旗艦整合版 (v2.5.2)</title>
    <!-- 核心庫載入 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide 圖示載入 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f8fafc; 
            margin: 0; 
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        
        .chat-room-bg {
            background-color: #8491a3;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .flex-bubble-shadow {
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        input:focus, select:focus, textarea:focus {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
            outline: none;
        }
        
        .transition-all-300 { transition: all 0.3s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, memo } = React;

        // --- 全局常數定義 ---
        const SOCIAL_DATA = {
            NONE: { url: "", label: "無圖示" },
            FB: { url: "https://cdn-icons-png.flaticon.com/512/733/733547.png", label: "Facebook" },
            IG: { url: "https://cdn-icons-png.flaticon.com/512/2111/2111463.png", label: "Instagram" },
            TIKTOK: { url: "https://cdn-icons-png.flaticon.com/512/3046/3046121.png", label: "TikTok" },
            YOUTUBE: { url: "https://cdn-icons-png.flaticon.com/512/1384/1384060.png", label: "YouTube" },
            LINE: { url: "https://cdn-icons-png.flaticon.com/512/124/124027.png", label: "LINE" },
            LINE_AT: { url: "https://vos.line-scdn.net/bot-designer-template-images/bot-designer-icon.png", label: "LINE@" }, 
            PHONE: { url: "https://cdn-icons-png.flaticon.com/512/3616/3616215.png", label: "電話聯繫" },
            MAIL: { url: "https://cdn-icons-png.flaticon.com/512/732/732200.png", label: "電子郵件" },
            MAP: { url: "https://cdn-icons-png.flaticon.com/512/355/355980.png", label: "Google Map" },
            WEB: { url: "https://cdn-icons-png.flaticon.com/512/1006/1006771.png", label: "官方網站" }
        };

        const ASPECT_RATIOS = ['1:1', '4:3', '16:9', '9:16', '2:3', '20:13'];
        const BUBBLE_SIZES = ['mega', 'giga'];
        const CORNER_RADIUS_OPTIONS = ['none', 'xs', 'sm', 'md', 'lg', 'xl', 'xxl', '40px', '100px'];

        const initialFlex = {
            size: "mega",
            media: {
                url: "https://lihi.cc/5OXMZ",
                uri: "https://line.me",
                aspectRatio: "16:9",
                gravity: "center",
                badgeText: "精選推薦",
                badgeUri: "https://line.me",
                badgeBg: "#ef4444", // 預設紅色
                badgePos: "left"
            },
            avatar: {
                show: true,
                url: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200",
                borderColor: "#ffffff",
                gravity: "center",
                cornerRadius: "100px"
            },
            content: {
                name: "陳大文",
                nameSize: "lg",
                nameAlign: "start",
                nameColor: "#0f172a",
                desc: "專業 LINE Bot 解決方案\n致力於提供最流暢的互動體驗",
                descSize: "xs",
                descAlign: "start",
                descColor: "#475569"
            },
            footer: {
                longBtns: [
                    { label: "立即預約", uri: "https://line.me", themeColor: "#10b981", textColor: "#ffffff", isSolid: true }
                ],
                shortBtns: [
                    { type: "PHONE", label: "電話", uri: "tel:0912345678", themeColor: "#f1f5f9", textColor: "#444444", isSolid: true },
                    { type: "LINE", label: "LINE", uri: "https://line.me", themeColor: "#f1f5f9", textColor: "#444444", isSolid: true },
                    { type: "WEB", label: "官網", uri: "https://line.me", themeColor: "#f1f5f9", textColor: "#444444", isSolid: true }
                ]
            }
        };

        const App = () => {
            const [data, setData] = useState(initialFlex);
            const [activeTab, setActiveTab] = useState('editor');
            const [mediaType, setMediaType] = useState('image');
            const [videoConfig, setVideoConfig] = useState({
                url: "https://lihi.cc/YsmAp",
                previewUrl: "https://lihi.cc/5OXMZ"
            });
            const [copyStatus, setCopyStatus] = useState("複製 JSON");

            // --- 核心邏輯：生成 JSON ---
            const buildFinalJson = useCallback(() => {
                const bubble = {
                    type: "bubble",
                    size: data.size,
                    body: { type: "box", layout: "vertical", paddingAll: "0px", contents: [] }
                };
                const [w, h] = data.media.aspectRatio.split(':').map(Number);
                const baseW = data.size === 'giga' ? 420 : 300;
                const mediaH = (h / w) * baseW;

                if (mediaType === 'video') {
                    bubble.hero = {
                        type: "video", url: videoConfig.url, previewUrl: videoConfig.previewUrl, aspectRatio: data.media.aspectRatio,
                        altContent: { type: "image", size: "full", aspectRatio: data.media.aspectRatio, aspectMode: "cover", url: videoConfig.previewUrl, backgroundColor: "#000000", animated: true }
                    };
                } else {
                    bubble.body.contents.push({
                        type: "box", layout: "vertical",
                        contents: [
                            { 
                                type: "image", url: data.media.url, size: "full", aspectRatio: data.media.aspectRatio, aspectMode: "cover", gravity: data.media.gravity,
                                animated: true, action: data.media.uri ? { type: "uri", uri: data.media.uri } : undefined
                            },
                            {
                                type: "box", layout: "vertical", position: "absolute", backgroundColor: data.media.badgeBg, cornerRadius: "15px", height: "25px", paddingAll: "4px", paddingStart: "10px", paddingEnd: "10px", offsetTop: "10px", [data.media.badgePos === 'left' ? 'offsetStart' : 'offsetEnd']: "10px",
                                justifyContent: "center",
                                action: data.media.badgeUri ? { type: "uri", uri: data.media.badgeUri } : undefined,
                                contents: [{ type: "text", text: data.media.badgeText, color: "#ffffff", align: "center", size: "xs", weight: "bold" }]
                            }
                        ]
                    });
                }

                const txtPad = data.avatar.show ? (mediaType === 'video' ? "95px" : "45px") : "15px";
                const infoBox = {
                    type: "box", layout: "vertical", paddingAll: "15px",
                    paddingTop: txtPad,
                    contents: [
                        { type: "text", text: data.content.name, weight: "bold", size: data.content.nameSize, align: data.content.nameAlign, color: data.content.nameColor },
                        { type: "text", text: data.content.desc, wrap: true, color: data.content.descColor, size: data.content.descSize, margin: "md", align: data.content.descAlign }
                    ]
                };

                if (data.avatar.show) {
                    const avatarBox = {
                        type: "box", layout: "vertical", position: "absolute",
                        offsetTop: mediaType === 'video' ? "10px" : `${mediaH - 45}px`,
                        offsetStart: "0px", offsetEnd: "0px", alignItems: "center",
                        contents: [
                            {
                                type: "box", layout: "vertical", width: "80px", height: "80px", cornerRadius: data.avatar.cornerRadius, borderWidth: "3px", borderColor: data.avatar.borderColor,
                                contents: [{ type: "image", url: data.avatar.url, size: "full", aspectRatio: "1:1", aspectMode: "cover", gravity: data.avatar.gravity, animated: true }]
                            }
                        ]
                    };
                    bubble.body.contents.push(avatarBox);
                }
                bubble.body.contents.splice(data.avatar.show ? bubble.body.contents.length - 1 : bubble.body.contents.length, 0, infoBox);

                bubble.footer = {
                    type: "box", layout: "vertical", spacing: "md", paddingAll: "10px",
                    contents: data.footer.longBtns.map(btn => ({
                        type: "box", layout: "vertical", contents: [{ type: "text", text: btn.label, align: "center", color: btn.textColor, size: "sm", weight: "bold" }],
                        paddingAll: "10px", borderWidth: "1px", borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : undefined, cornerRadius: "md", action: { type: "uri", uri: btn.uri }
                    }))
                };

                if (data.footer.shortBtns.length > 0) {
                    bubble.footer.contents.push({
                        type: "box", layout: "horizontal", spacing: "md",
                        contents: data.footer.shortBtns.map(btn => ({
                            type: "box", layout: "vertical", spacing: "xs", paddingAll: "8px", borderWidth: "1px", borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : undefined, cornerRadius: "sm", action: { type: "uri", uri: btn.uri },
                            contents: [
                                { type: "image", url: SOCIAL_DATA[btn.type]?.url || SOCIAL_DATA.WEB.url, size: "xxs", aspectRatio: "1:1", animated: true },
                                { type: "text", text: btn.label, align: "center", color: btn.textColor, size: "xxs" }
                            ]
                        }))
                    });
                }
                return bubble;
            }, [data, mediaType, videoConfig]);

            // --- 輔助功能 ---
            const handleUpdate = useCallback((section, field, value) => {
                setData(prev => {
                    if (section === 'root') return { ...prev, [field]: value };
                    return { ...prev, [section]: { ...prev[section], [field]: value } };
                });
            }, []);

            const copyJson = useCallback(() => {
                const json = JSON.stringify(buildFinalJson(), null, 2);
                navigator.clipboard.writeText(json).then(() => {
                    setCopyStatus("已複製！");
                    setTimeout(() => setCopyStatus("複製 JSON"), 2000);
                });
            }, [buildFinalJson]);

            const updateLongBtn = useCallback((idx, field, value) => {
                setData(prev => {
                    const newList = [...prev.footer.longBtns];
                    newList[idx] = { ...newList[idx], [field]: value };
                    return { ...prev, footer: { ...prev.footer, longBtns: newList } };
                });
            }, []);

            const updateShortBtn = useCallback((idx, field, value) => {
                setData(prev => {
                    const newList = [...prev.footer.shortBtns];
                    if (field === 'icon_data') {
                        newList[idx].type = value.type;
                        newList[idx].label = value.label;
                        if (value.type === 'PHONE') newList[idx].uri = "tel:0912345678";
                        else if (value.type === 'MAIL') newList[idx].uri = "mailto:a@gmail.com";
                        else newList[idx].uri = "https://line.me";
                    } else {
                        newList[idx][field] = value;
                    }
                    return { ...prev, footer: { ...prev.footer, shortBtns: newList } };
                });
            }, []);

            // --- 解析器 ---
            const parseJsonToState = useCallback((json) => {
                if (!json) return;
                try {
                    const bubble = typeof json === 'string' ? JSON.parse(json) : json;
                    const newState = JSON.parse(JSON.stringify(initialFlex));
                    newState.size = bubble.size || "mega";

                    if (bubble.hero && bubble.hero.type === 'video') {
                        setMediaType('video');
                        setVideoConfig({ url: bubble.hero.url || "", previewUrl: bubble.hero.previewUrl || "" });
                        newState.media.aspectRatio = bubble.hero.aspectRatio || "16:9";
                    } else {
                        setMediaType('image');
                        const imgBox = bubble.body?.contents?.find(c => c.type === 'box' && c.contents?.[0]?.type === 'image');
                        if (imgBox) {
                            newState.media.url = imgBox.contents[0].url || "";
                            newState.media.aspectRatio = imgBox.contents[0].aspectRatio || "16:9";
                            newState.media.uri = imgBox.contents[0].action?.uri || "";
                            const badge = imgBox.contents.find(c => c.position === 'absolute');
                            if (badge) {
                                newState.media.badgeText = badge.contents[0].text;
                                newState.media.badgeBg = badge.backgroundColor;
                                newState.media.badgePos = badge.offsetStart ? 'left' : 'right';
                            }
                        }
                    }

                    const infoBox = bubble.body?.contents?.find(c => c.type === 'box' && c.paddingAll === '15px');
                    if (infoBox) {
                        newState.content.name = infoBox.contents[0].text;
                        newState.content.nameColor = infoBox.contents[0].color;
                        newState.content.nameAlign = infoBox.contents[0].align;
                        newState.content.desc = infoBox.contents[1].text;
                        newState.content.descColor = infoBox.contents[1].color;
                        newState.content.descAlign = infoBox.contents[1].align;
                    }

                    const avBox = bubble.body?.contents?.find(c => c.alignItems === 'center');
                    if (avBox) {
                        newState.avatar.show = true;
                        newState.avatar.url = avBox.contents[0].contents[0].url;
                        newState.avatar.cornerRadius = avBox.contents[0].cornerRadius;
                        newState.avatar.borderColor = avBox.contents[0].borderColor;
                    } else newState.avatar.show = false;

                    if (bubble.footer) {
                        const lBtns = bubble.footer.contents.filter(c => c.layout === 'vertical');
                        newState.footer.longBtns = lBtns.map(b => ({
                            label: b.contents[0].text, uri: b.action?.uri || "", themeColor: b.borderColor, textColor: b.contents[0].color, isSolid: !!b.backgroundColor
                        }));
                        const sBox = bubble.footer.contents.find(c => c.layout === 'horizontal');
                        if (sBox) {
                            newState.footer.shortBtns = sBox.contents.map(b => {
                                let type = "WEB";
                                Object.keys(SOCIAL_DATA).forEach(k => { if(SOCIAL_DATA[k].url === b.contents[0].url) type = k; });
                                return { type, label: b.contents[1].text, uri: b.action?.uri || "", themeColor: b.borderColor, textColor: b.contents[1].color, isSolid: !!b.backgroundColor };
                            });
                        }
                    }
                    setData(newState);
                } catch (e) { console.error("Parse Error", e); }
            }, []);

            useEffect(() => {
                const handleMessage = (e) => { if (e.data?.type === 'LOAD_FLEX_DATA') parseJsonToState(e.data.json); };
                window.addEventListener('message', handleMessage);
                window.parent.postMessage({ type: 'CHILD_READY' }, '*');
                return () => window.removeEventListener('message', handleMessage);
            }, [parseJsonToState]);

            useEffect(() => {
                const currentJson = buildFinalJson();
                window.parent.postMessage({ type: 'SYNC_FLEX_DATA', json: JSON.stringify(currentJson, null, 2) }, '*');
            }, [data, mediaType, videoConfig, buildFinalJson]);

            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [data, activeTab, mediaType]);

            // --- 視覺預覽組件 ---
            const Preview = () => {
                const bubbleW = data.size === 'giga' ? '420px' : '300px';
                const [w, h] = data.media.aspectRatio.split(':').map(Number);
                const mediaH = (h / w) * (data.size === 'giga' ? 420 : 300);
                const avatarOff = mediaType === 'video' ? mediaH + 10 : mediaH - 45;
                const txtPad = data.avatar.show ? (mediaType === 'video' ? 95 : 45) : 15;

                return (
                    <div className="flex justify-center p-4 min-h-full">
                        <div className="bg-white rounded-2xl overflow-hidden flex-bubble-shadow border border-slate-200 h-fit relative transition-all duration-500" style={{ width: bubbleW }}>
                            <div className="relative bg-black overflow-hidden" style={{ height: `${mediaH}px` }}>
                                {mediaType === 'image' ? <img src={data.media.url} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center relative"><img src={videoConfig.previewUrl} className="absolute inset-0 w-full h-full object-cover opacity-60" /><i data-lucide="play-circle" className="w-16 h-16 text-white relative z-10 opacity-90 drop-shadow-xl"></i></div>}
                                
                                {/* 標籤顯示 (修正位置) */}
                                {mediaType === 'image' && (
                                    <div className="absolute px-3 text-white font-bold shadow-sm text-[10px] flex items-center justify-center whitespace-nowrap" style={{ 
                                        top: '10px', 
                                        [data.media.badgePos === 'left' ? 'left' : 'right']: '10px', 
                                        backgroundColor: data.media.badgeBg, 
                                        borderRadius: '15px',
                                        height: '25px',
                                        minWidth: '50px'
                                    }}>{data.media.badgeText}</div>
                                )}
                            </div>
                            
                            <div style={{ padding: '15px', paddingTop: `${txtPad}px` }}>
                                <div className="font-bold" style={{ textAlign: data.content.nameAlign, fontSize: '19px', color: data.content.nameColor }}>{data.content.name}</div>
                                <div className="mt-1 text-[13px] leading-snug whitespace-pre-wrap" style={{ color: data.content.descColor, textAlign: data.content.descAlign }}>{data.content.desc}</div>
                            </div>
                            
                            {data.avatar.show && <div className="absolute w-full flex justify-center transition-all duration-500" style={{ top: `${avatarOff}px` }}><div className="overflow-hidden bg-white shadow-xl" style={{ width: '80px', height: '80px', border: `3px solid ${data.avatar.borderColor}`, borderRadius: data.avatar.cornerRadius.includes('px') ? data.avatar.cornerRadius : '12px' }}><img src={data.avatar.url} className="w-full h-full object-cover" /></div></div>}
                            
                            <div className="flex flex-col gap-3 p-[10px] pt-0">
                                {data.footer.longBtns.map((btn, i) => <div key={i} className="py-2.5 text-center rounded-md border font-bold text-[14px]" style={{ borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : 'transparent', color: btn.textColor }}>{btn.label}</div>)}
                                <div className="flex gap-2">{data.footer.shortBtns.map((btn, i) => <div key={i} className="flex-1 py-2 flex flex-col items-center gap-1 rounded-sm border shadow-sm" style={{ borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : 'transparent' }}><img src={SOCIAL_DATA[btn.type]?.url} className="w-4 h-4 object-contain" /><span className="text-[10px] font-medium" style={{ color: btn.textColor }}>{btn.label}</span></div>)}</div>
                            </div>
                        </div>
                    </div>
                );
            };

            const AlignButtons = ({ value, onChange }) => (
                <div className="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                    {[{ id: 'start', icon: 'align-left' }, { id: 'center', icon: 'align-center' }, { id: 'end', icon: 'align-right' }].map(btn => (
                        <button key={btn.id} onClick={() => onChange(btn.id)} className={`flex-1 flex justify-center py-2 rounded-md transition-all ${value === btn.id ? 'bg-white shadow-sm text-emerald-600' : 'text-slate-400'}`}><i data-lucide={btn.icon} className="w-4 h-4"></i></button>
                    ))}
                </div>
            );

            return (
                <div className="flex h-screen bg-slate-100 text-slate-900 overflow-hidden font-black">
                    <div className="w-[500px] bg-white border-r border-slate-300 flex flex-col shadow-xl z-10">
                        <div className="p-6 bg-white border-b border-slate-200 flex items-center justify-between shrink-0">
                            <div className="flex items-center gap-3">
                                <div className="bg-emerald-500 p-2 rounded-lg text-white"><i data-lucide="layout-grid" className="w-6 h-6"></i></div>
                                <h1 className="font-bold text-lg uppercase tracking-tight">旗艦整合設計 <span className="text-emerald-500">v2.5.2</span></h1>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">
                            
                            {/* 01. 媒體模式 & 標籤設定 */}
                            <section className="space-y-4">
                                <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="monitor" className="w-4 h-4"></i> 01. 媒體與標籤設定</h3>
                                <div className="flex bg-slate-100 p-1.5 rounded-lg border border-slate-200 mb-3">
                                    <button onClick={() => setMediaType('image')} className={`flex-1 py-2 text-xs font-bold rounded-md transition ${mediaType === 'image' ? 'bg-white shadow-sm text-emerald-600' : 'text-slate-500'}`}>圖片模式</button>
                                    <button onClick={() => setMediaType('video')} className={`flex-1 py-2 text-xs font-bold rounded-md transition ${mediaType === 'video' ? 'bg-white shadow-sm text-emerald-600' : 'text-slate-500'}`}>影片模式</button>
                                </div>
                                
                                <div className="space-y-3">
                                    {mediaType === 'image' ? (
                                        <div className="space-y-3">
                                            <input type="text" value={data.media.url} onChange={(e) => handleUpdate('media', 'url', e.target.value)} className="w-full p-3 text-xs border border-slate-200 rounded-xl bg-slate-50 font-mono" placeholder="主圖網址..." />
                                            {/* 標籤輸入 UI */}
                                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3">
                                                <div className="flex gap-2">
                                                    <input type="text" maxLength={10} value={data.media.badgeText} onChange={(e) => handleUpdate('media', 'badgeText', e.target.value)} className="flex-1 p-3 text-xs border border-slate-200 rounded-xl" placeholder="標籤文字 (限10字)" />
                                                    <input type="color" value={data.media.badgeBg} onChange={(e) => handleUpdate('media', 'badgeBg', e.target.value)} className="w-12 h-12 p-1 border border-slate-200 rounded-xl bg-white cursor-pointer shadow-sm" />
                                                </div>
                                                <div className="flex bg-white p-1 rounded-lg border">
                                                    <button onClick={() => handleUpdate('media', 'badgePos', 'left')} className={`flex-1 py-1.5 text-[10px] font-black rounded ${data.media.badgePos === 'left' ? 'bg-slate-800 text-white' : 'text-slate-400'}`}>靠左</button>
                                                    <button onClick={() => handleUpdate('media', 'badgePos', 'right')} className={`flex-1 py-1.5 text-[10px] font-black rounded ${data.media.badgePos === 'right' ? 'bg-slate-800 text-white' : 'text-slate-400'}`}>靠右</button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            <input type="text" value={videoConfig.url} onChange={(e) => setVideoConfig({...videoConfig, url: e.target.value})} className="w-full p-3 text-xs border border-slate-200 rounded-xl bg-slate-50 font-mono" placeholder="影片網址 (.mp4)..." />
                                            <input type="text" value={videoConfig.previewUrl} onChange={(e) => setVideoConfig({...videoConfig, previewUrl: e.target.value})} className="w-full p-3 text-xs border border-slate-200 rounded-xl bg-slate-50 font-mono" placeholder="預覽圖片網址..." />
                                        </div>
                                    )}
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <select value={data.media.aspectRatio} onChange={(e) => handleUpdate('media', 'aspectRatio', e.target.value)} className="p-3 text-sm border border-slate-200 rounded-xl bg-slate-50">{ASPECT_RATIOS.map(r => <option key={r} value={r}>{r}</option>)}</select>
                                    <select value={data.size} onChange={(e) => handleUpdate('root', 'size', e.target.value)} className="p-3 text-sm border border-slate-200 rounded-xl bg-slate-50 uppercase">{BUBBLE_SIZES.map(s => <option key={s} value={s}>{s}</option>)}</select>
                                </div>
                            </section>

                            {/* 02. 姓名排版 */}
                            <section className="space-y-4">
                                <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="type" className="w-4 h-4"></i> 02. 姓名排版 (字體固定: LG)</h3>
                                <div className="bg-slate-50 p-4 rounded-2xl border border-slate-200 space-y-4">
                                    <div className="flex gap-2">
                                        <input type="text" value={data.content.name} onChange={(e) => handleUpdate('content', 'name', e.target.value)} className="flex-1 p-3 text-sm font-bold border border-slate-200 rounded-xl" placeholder="姓名" />
                                        <input type="color" value={data.content.nameColor} onChange={(e) => handleUpdate('content', 'nameColor', e.target.value)} className="w-12 h-12 p-1 border border-slate-200 rounded-xl bg-white cursor-pointer shadow-sm" />
                                    </div>
                                    <AlignButtons value={data.content.nameAlign} onChange={(val) => handleUpdate('content', 'nameAlign', val)} />
                                </div>
                            </section>

                            {/* 03. 說明排版 */}
                            <section className="space-y-4">
                                <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="align-left" className="w-4 h-4"></i> 03. 說明排版 (字體固定: XS)</h3>
                                <div className="bg-slate-50 p-4 rounded-2xl border border-slate-200 space-y-4">
                                    <textarea value={data.content.desc} onChange={(e) => handleUpdate('content', 'desc', e.target.value)} className="w-full p-3 text-xs border border-slate-200 rounded-xl h-24 resize-none leading-relaxed" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <AlignButtons value={data.content.descAlign} onChange={(val) => handleUpdate('content', 'descAlign', val)} />
                                        <input type="color" value={data.content.descColor} onChange={(e) => handleUpdate('content', 'descColor', e.target.value)} className="w-full h-11 p-1 border border-slate-200 rounded-xl bg-white cursor-pointer" />
                                    </div>
                                </div>
                            </section>

                            {/* 04. 個人頭像 */}
                            <section className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="user" className="w-4 h-4"></i> 04. 個人頭像</h3>
                                    <input type="checkbox" checked={data.avatar.show} onChange={() => handleUpdate('avatar', 'show', !data.avatar.show)} className="accent-emerald-500 h-5 w-5" />
                                </div>
                                {data.avatar.show && (
                                    <div className="bg-slate-50 p-4 rounded-2xl border border-slate-200 space-y-3">
                                        <input type="text" value={data.avatar.url} onChange={(e) => handleUpdate('avatar', 'url', e.target.value)} className="w-full p-3 text-xs border border-slate-200 rounded-xl bg-white font-mono" />
                                        <div className="grid grid-cols-2 gap-3">
                                            <select value={data.avatar.cornerRadius} onChange={(e) => handleUpdate('avatar', 'cornerRadius', e.target.value)} className="p-3 text-xs border border-slate-200 rounded-xl bg-white">{CORNER_RADIUS_OPTIONS.map(r => <option key={r} value={r}>圓角: {r}</option>)}</select>
                                            <input type="color" value={data.avatar.borderColor} onChange={(e) => handleUpdate('avatar', 'borderColor', e.target.value)} className="w-full h-11 p-1 border border-slate-200 rounded-xl bg-white cursor-pointer" />
                                        </div>
                                    </div>
                                )}
                            </section>

                            {/* 05. 主按鈕 */}
                            <section className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="layers" className="w-4 h-4"></i> 05. 主按鈕區</h3>
                                    <button onClick={() => setData(prev => ({...prev, footer: {...prev.footer, longBtns: [...prev.footer.longBtns, { label: "新按鈕", uri: "https://line.me", themeColor: "#10b981", textColor: "#ffffff", isSolid: true }]}}))} className="text-[10px] font-black bg-emerald-500 text-white px-3 py-1.5 rounded-lg">+ 新增</button>
                                </div>
                                {data.footer.longBtns.map((btn, idx) => (
                                    <div key={idx} className="bg-slate-50 p-4 border border-slate-200 rounded-2xl relative group mb-3">
                                        <button onClick={() => setData(prev => ({...prev, footer: {...prev.footer, longBtns: prev.footer.longBtns.filter((_, i) => i !== idx)}}))} className="absolute -top-2 -right-2 bg-rose-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md"><i data-lucide="x" className="w-3 h-3"></i></button>
                                        <div className="grid grid-cols-2 gap-2 mb-2">
                                            <input type="text" value={btn.label} onChange={(e) => updateLongBtn(idx, 'label', e.target.value)} className="p-2 text-xs border border-slate-200 rounded-lg bg-white font-bold" />
                                            <input type="text" value={btn.uri} onChange={(e) => updateLongBtn(idx, 'uri', e.target.value)} className="p-2 text-xs border border-slate-200 rounded-lg bg-white font-mono" />
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <div className="flex gap-2">
                                                <input type="color" value={btn.themeColor} onChange={(e) => updateLongBtn(idx, 'themeColor', e.target.value)} className="w-8 h-8 p-1 border border-slate-200 rounded-lg" />
                                                <input type="color" value={btn.textColor} onChange={(e) => updateLongBtn(idx, 'textColor', e.target.value)} className="w-8 h-8 p-1 border border-slate-200 rounded-lg" />
                                            </div>
                                            <button onClick={() => updateLongBtn(idx, 'isSolid', !btn.isSolid)} className={`px-3 py-1.5 rounded-lg text-[10px] font-black ${btn.isSolid ? 'bg-slate-800 text-white' : 'bg-slate-200 text-slate-500'}`}>{btn.isSolid ? '實心' : '空心'}</button>
                                        </div>
                                    </div>
                                ))}
                            </section>

                            {/* 06. 社群快捷 */}
                            <section className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <h3 className="text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2"><i data-lucide="share-2" className="w-4 h-4"></i> 06. 社群快捷</h3>
                                    <button onClick={() => setData(prev => ({...prev, footer: {...prev.footer, shortBtns: [...prev.footer.shortBtns, { type: "WEB", label: "官網", uri: "https://line.me", themeColor: "#f1f5f9", textColor: "#444444", isSolid: true }]}}))} className="text-[10px] font-black bg-emerald-500 text-white px-3 py-1.5 rounded-lg">+ 新增</button>
                                </div>
                                {data.footer.shortBtns.map((btn, idx) => (
                                    <div key={idx} className="bg-slate-50 p-4 border border-slate-200 rounded-2xl relative group mb-3">
                                        <button onClick={() => setData(prev => ({...prev, footer: {...prev.footer, shortBtns: prev.footer.shortBtns.filter((_, i) => i !== idx)}}))} className="absolute -top-2 -right-2 bg-rose-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md"><i data-lucide="x" className="w-3 h-3"></i></button>
                                        <div className="flex gap-2 overflow-x-auto pb-2 mb-2 scrollbar-hide">
                                            {Object.keys(SOCIAL_DATA).map(k => (
                                                <button key={k} onClick={() => updateShortBtn(idx, 'icon_data', { type: k, label: SOCIAL_DATA[k].label })} className={`p-2 rounded-lg border transition-all ${btn.type === k ? 'bg-emerald-50 border-emerald-500' : 'opacity-40'}`}>
                                                    {k === 'NONE' ? <i data-lucide="minus" className="w-4 h-4"></i> : <img src={SOCIAL_DATA[k].url} className="w-5 h-5 object-contain" />}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input type="text" value={btn.label} onChange={(e) => updateShortBtn(idx, 'label', e.target.value)} className="p-2 text-xs border border-slate-200 rounded-lg bg-white" />
                                            <input type="text" value={btn.uri} onChange={(e) => updateShortBtn(idx, 'uri', e.target.value)} className="p-2 text-xs border border-slate-200 rounded-lg bg-white font-mono" />
                                        </div>
                                    </div>
                                ))}
                            </section>
                            <div className="h-20"></div>
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col overflow-hidden bg-slate-200 relative">
                        <div className="h-[70px] bg-white border-b border-slate-200 flex items-center px-10 gap-10 shrink-0 z-30 shadow-sm">
                            <button onClick={() => setActiveTab('editor')} className={`text-sm font-black h-full relative tracking-widest flex items-center gap-2 ${activeTab === 'editor' ? 'text-emerald-500 border-b-4 border-emerald-500' : 'text-slate-400'}`}><i data-lucide="eye" className="w-4 h-4"></i> 視覺預覽</button>
                            <button onClick={() => setActiveTab('json')} className={`text-sm font-black h-full relative tracking-widest flex items-center gap-2 ${activeTab === 'json' ? 'text-emerald-500 border-b-4 border-emerald-500' : 'text-slate-400'}`}><i data-lucide="code" className="w-4 h-4"></i> JSON 代碼</button>
                            <div className="flex-1"></div>
                            <button onClick={copyJson} className="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-xl text-xs font-black shadow-lg shadow-emerald-200 active:scale-95 transition-all flex items-center gap-2">
                                <i data-lucide="copy" className="w-3.5 h-3.5"></i> {copyStatus}
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto chat-room-bg flex flex-col">
                            {activeTab === 'editor' ? (
                                <div className="py-12 flex flex-col items-center min-h-full">
                                    <div className="mb-10 px-6 py-3 bg-slate-900/90 backdrop-blur rounded-2xl text-[11px] font-black text-white shadow-2xl border border-white/10 uppercase tracking-[0.2em] flex items-center gap-3">
                                        <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
                                        LINE Flex LIVE PREVIEW
                                    </div>
                                    <Preview />
                                </div>
                            ) : (
                                <div className="p-12 max-w-4xl mx-auto w-full">
                                    <div className="bg-slate-900 p-8 rounded-3xl shadow-2xl border-4 border-slate-800 relative">
                                        <pre className="text-emerald-400 font-mono text-sm overflow-x-auto leading-relaxed custom-scrollbar pt-6">
                                            {JSON.stringify(buildFinalJson(), null, 2)}
                                        </pre>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
