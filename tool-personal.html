<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>個人單頁名片 - 整合版 (v2.3.2)</title>
    <!-- 核心庫載入 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide 圖示載入 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; margin: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #00b900; border-radius: 10px; }
        .lucide { width: 1.2em; height: 1.2em; vertical-align: middle; display: inline-block; }
        input, select, textarea { font-size: 14px !important; }
        
        .chat-room-bg {
            background-color: #7988a0;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .icon-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .icon-btn { padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0; background: white; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; transition: all 0.2s; }
        .icon-btn:hover { border-color: #00b900; background: #f0fff4; }
        .icon-btn.active { border-color: #00b900; background: #dcfce7; }
        .icon-btn img { width: 20px; height: 20px; object-fit: contain; }
        .icon-btn span { font-size: 10px; text-align: center; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- 全局常數定義 ---
        const SOCIAL_DATA = {
            NONE: { url: "https://vos.line-scdn.net/bot-designer-template-images/bot-designer-icon.png", label: "無圖示" },
            FB: { url: "https://cdn-icons-png.flaticon.com/512/733/733547.png", label: "Facebook" },
            IG: { url: "https://cdn-icons-png.flaticon.com/512/2111/2111463.png", label: "Instagram" },
            TIKTOK: { url: "https://cdn-icons-png.flaticon.com/512/3046/3046121.png", label: "TikTok" },
            YOUTUBE: { url: "https://cdn-icons-png.flaticon.com/512/1384/1384060.png", label: "YouTube" },
            LINE: { url: "https://cdn-icons-png.flaticon.com/512/124/124027.png", label: "LINE" },
            LINE_AT: { url: "https://vos.line-scdn.net/bot-designer-template-images/bot-designer-icon.png", label: "LINE@" }, 
            PHONE: { url: "https://cdn-icons-png.flaticon.com/512/3616/3616215.png", label: "電話聯繫" },
            MAIL: { url: "https://cdn-icons-png.flaticon.com/512/732/732200.png", label: "電子郵件" },
            MAP: { url: "https://cdn-icons-png.flaticon.com/512/355/355980.png", label: "Google Map" },
            WEB: { url: "https://cdn-icons-png.flaticon.com/512/1006/1006771.png", label: "官方網站" }
        };

        const FONT_SIZES = ['xxs', 'xs', 'sm', 'md', 'lg', 'xl', 'xxl', '3xl', '4xl', '5xl'];
        const ASPECT_RATIOS = ['1:1', '4:3', '16:9', '9:16', '20:13'];
        const BUBBLE_SIZES = ['mega', 'giga'];
        const CORNER_RADIUS_OPTIONS = ['none', 'xs', 'sm', 'md', 'lg', 'xl', 'xxl', '40px', '100px'];

        const initialFlex = {
            size: "mega",
            media: {
                url: "https://lihi.cc/5OXMZ",
                uri: "https://line.me",
                aspectRatio: "16:9",
                gravity: "center",
                badgeText: "旗艦店",
                badgeUri: "https://line.me",
                badgeBg: "#ff0000",
                badgePos: "left"
            },
            avatar: {
                show: true,
                url: "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200",
                borderColor: "#ffffff",
                gravity: "center",
                cornerRadius: "100px"
            },
            content: {
                name: "王小明",
                nameSize: "xl",
                nameAlign: "start",
                nameColor: "#111111",
                desc: "資深開發工程師\n專業 LINE Bot 解決方案",
                descSize: "sm",
                descAlign: "start",
                descColor: "#666666"
            },
            footer: {
                showShortBtns: true, 
                longBtns: [
                    { label: "立即預約", uri: "https://line.me", themeColor: "#00b900", textColor: "#ffffff", isSolid: true },
                    { label: "查看詳情", uri: "https://line.me", themeColor: "#00b900", textColor: "#00b900", isSolid: false }
                ],
                shortBtns: [
                    { type: "PHONE", label: "電話", uri: "tel:0900000000", themeColor: "#dddddd", textColor: "#444444", isSolid: false },
                    { type: "MAIL", label: "信箱", uri: "mailto:service@example.com", themeColor: "#dddddd", textColor: "#444444", isSolid: false },
                    { type: "MAP", label: "地點", uri: "https://goo.gl/maps/example", themeColor: "#dddddd", textColor: "#444444", isSolid: false }
                ]
            }
        };

        const App = () => {
            const [data, setData] = useState(initialFlex);
            const [activeTab, setActiveTab] = useState('editor');
            const [mediaType, setMediaType] = useState('image');
            const [videoConfig, setVideoConfig] = useState({
                url: "https://lihi.cc/YsmAp",
                previewUrl: "https://lihi.cc/5OXMZ"
            });
            const [editingShortBtn, setEditingShortBtn] = useState(null);
            const [showIconSelector, setShowIconSelector] = useState(false);

            // --- 核心修復：確保 URI 絕對不為空 ---
            const safeUri = (u) => {
                if (!u || u.trim() === "") return "https://line.me";
                return u.trim();
            };

            // --- 生成 Flex Message JSON ---
            const buildFinalJson = useCallback(() => {
                const bubble = {
                    type: "bubble",
                    size: data.size,
                    body: { type: "box", layout: "vertical", paddingAll: "0px", contents: [] }
                };
                
                const [w, h] = data.media.aspectRatio.split(':').map(Number);
                const baseW = data.size === 'giga' ? 420 : 300;
                const mediaH = (h / w) * baseW;

                // Media Layer
                if (mediaType === 'video') {
                    bubble.hero = {
                        type: "video", 
                        url: safeUri(videoConfig.url), 
                        previewUrl: safeUri(videoConfig.previewUrl), 
                        aspectRatio: data.media.aspectRatio,
                        altContent: { 
                            type: "image", size: "full", aspectRatio: data.media.aspectRatio, aspectMode: "cover", 
                            url: safeUri(videoConfig.previewUrl), backgroundColor: "#000000" 
                        }
                    };
                } else {
                    bubble.body.contents.push({
                        type: "box", layout: "vertical",
                        contents: [
                            { 
                                type: "image", url: safeUri(data.media.url), size: "full", aspectRatio: data.media.aspectRatio, aspectMode: "cover", gravity: data.media.gravity,
                                animated: true, action: { type: "uri", uri: safeUri(data.media.uri) }
                            },
                            {
                                type: "box", layout: "vertical", position: "absolute", backgroundColor: data.media.badgeBg, cornerRadius: "15px", paddingAll: "4px", paddingStart: "10px", paddingEnd: "10px", offsetTop: "10px", [data.media.badgePos === 'left' ? 'offsetStart' : 'offsetEnd']: "10px",
                                action: { type: "uri", uri: safeUri(data.media.badgeUri) },
                                contents: [{ type: "text", text: data.media.badgeText || "Tag", color: "#ffffff", align: "center", size: "xs", weight: "bold" }]
                            }
                        ]
                    });
                }

                // Info Box (Name & Desc)
                const txtPad = data.avatar.show ? (mediaType === 'video' ? "95px" : "45px") : "15px";
                const infoBox = {
                    type: "box", layout: "vertical", paddingAll: "15px",
                    paddingTop: txtPad,
                    contents: [
                        { type: "text", text: data.content.name || "未命名", weight: "bold", size: data.content.nameSize, align: data.content.nameAlign, color: data.content.nameColor },
                        { type: "text", text: data.content.desc || "無說明內容", wrap: true, color: data.content.descColor, size: data.content.descSize, margin: "md", align: data.content.descAlign }
                    ]
                };

                // Avatar
                if (data.avatar.show) {
                    const avatarBox = {
                        type: "box", layout: "vertical", position: "absolute",
                        offsetTop: mediaType === 'video' ? "10px" : `${mediaH - 45}px`,
                        offsetStart: "0px", offsetEnd: "0px", alignItems: "center",
                        contents: [
                            {
                                type: "box", layout: "vertical", width: "80px", height: "80px", cornerRadius: data.avatar.cornerRadius, borderWidth: "3px", borderColor: data.avatar.borderColor,
                                contents: [{ type: "image", url: safeUri(data.avatar.url), size: "full", aspectRatio: "1:1", aspectMode: "cover", gravity: data.avatar.gravity, animated: true }]
                            }
                        ]
                    };
                    bubble.body.contents.push(avatarBox);
                }
                bubble.body.contents.splice(data.avatar.show ? bubble.body.contents.length - 1 : bubble.body.contents.length, 0, infoBox);

                // Footer (Buttons)
                bubble.footer = {
                    type: "box", layout: "vertical", spacing: "md", paddingAll: "10px",
                    contents: data.footer.longBtns.map(btn => ({
                        type: "box", layout: "vertical", contents: [{ type: "text", text: btn.label || "按鈕", align: "center", color: btn.textColor, size: "sm", weight: "bold" }],
                        paddingAll: "10px", borderWidth: "1px", borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : undefined, cornerRadius: "md", 
                        action: { type: "uri", uri: safeUri(btn.uri) }
                    }))
                };

                // Short Buttons
                if (data.footer.showShortBtns && data.footer.shortBtns.length > 0) {
                    bubble.footer.contents.push({
                        type: "box", layout: "horizontal", spacing: "md",
                        contents: data.footer.shortBtns.map(btn => ({
                            type: "box", layout: "vertical", spacing: "xs", paddingAll: "8px", borderWidth: "1px", borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : undefined, cornerRadius: "sm", 
                            action: { type: "uri", uri: safeUri(btn.uri) },
                            contents: [
                                { type: "image", url: SOCIAL_DATA[btn.type]?.url || SOCIAL_DATA.WEB.url, size: "xxs", aspectRatio: "1:1" },
                                { type: "text", text: btn.label || "連結", align: "center", color: btn.textColor, size: "xxs" }
                            ]
                        }))
                    });
                }
                return bubble;
            }, [data, mediaType, videoConfig]);

            // --- 通訊邏輯 ---
            useEffect(() => {
                window.parent.postMessage({ type: 'CHILD_READY' }, '*');
            }, []);

            useEffect(() => {
                const currentJson = buildFinalJson();
                window.parent.postMessage({
                    type: 'SYNC_FLEX_DATA',
                    json: JSON.stringify(currentJson, null, 2)
                }, '*');
            }, [data, mediaType, videoConfig, buildFinalJson]);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [data, activeTab, mediaType]);

            // --- UI 輔助函數 ---
            const getMediaHeight = () => {
                const [w, h] = data.media.aspectRatio.split(':').map(Number);
                const baseW = data.size === 'giga' ? 420 : 300;
                return (h / w) * baseW;
            };

            const getPxSize = (size) => {
                const map = { 'xxs': '11px', 'xs': '13px', 'sm': '15px', 'md': '17px', 'lg': '19px', 'xl': '22px', 'xxl': '26px', '3xl': '30px', '4xl': '34px', '5xl': '38px' };
                return map[size] || '17px';
            };

            const handleUpdate = (section, field, value) => {
                setData(prev => ({
                    ...prev,
                    [section]: { ...prev[section], [field]: value }
                }));
            };

            const addShortBtn = () => {
                if (!data.footer.showShortBtns || data.footer.shortBtns.length >= 5) return;
                const newBtn = { type: "WEB", label: "新連結", uri: "https://", themeColor: "#dddddd", textColor: "#444444", isSolid: false };
                setData(prev => ({
                    ...prev,
                    footer: { ...prev.footer, shortBtns: [...prev.footer.shortBtns, newBtn] }
                }));
            };

            const updateShortBtn = (idx, field, value) => {
                const newList = [...data.footer.shortBtns];
                newList[idx][field] = value;
                setData(prev => ({ ...prev, footer: { ...prev.footer, shortBtns: newList } }));
            };

            const removeShortBtn = (idx) => {
                setData(prev => ({
                    ...prev,
                    footer: { ...prev.footer, shortBtns: prev.footer.shortBtns.filter((_, i) => i !== idx) }
                }));
            };

            const openIconSelector = (idx) => {
                setEditingShortBtn(idx);
                setShowIconSelector(true);
            };

            const selectIcon = (iconType, iconLabel) => {
                if (editingShortBtn !== null) {
                    const newList = [...data.footer.shortBtns];
                    newList[editingShortBtn].type = iconType;
                    newList[editingShortBtn].label = iconLabel;
                    setData(prev => ({ ...prev, footer: { ...prev.footer, shortBtns: newList } }));
                }
                setShowIconSelector(false);
                setEditingShortBtn(null);
            };

            // --- 預覽組件 ---
            const Preview = () => {
                const bubbleW = data.size === 'giga' ? '420px' : '300px';
                const mediaH = getMediaHeight();
                const avatarOff = mediaType === 'video' ? mediaH + 10 : mediaH - 45;
                const txtPad = data.avatar.show ? (mediaType === 'video' ? 95 : 45) : 15;

                return (
                    <div className="flex justify-center p-4 min-h-full">
                        <div className="bg-white rounded-2xl overflow-hidden shadow-2xl border border-slate-200 h-fit relative transition-all duration-500" style={{ width: bubbleW }}>
                            <div className="relative bg-black overflow-hidden" style={{ height: `${mediaH}px` }}>
                                {mediaType === 'image' ? <img src={data.media.url} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center relative"><img src={videoConfig.previewUrl} className="absolute inset-0 w-full h-full object-cover opacity-60" /><i data-lucide="play-circle" className="w-16 h-16 text-white relative z-10"></i></div>}
                            </div>
                            <div style={{ padding: '15px', paddingTop: `${txtPad}px` }}>
                                <div className="font-bold" style={{ textAlign: data.content.nameAlign, fontSize: getPxSize(data.content.nameSize), color: data.content.nameColor }}>{data.content.name}</div>
                                <div className="mt-1 leading-snug whitespace-pre-wrap" style={{ color: data.content.descColor, textAlign: data.content.descAlign, fontSize: getPxSize(data.content.descSize) }}>{data.content.desc}</div>
                            </div>
                            {data.avatar.show && <div className="absolute w-full flex justify-center" style={{ top: `${avatarOff}px`, left: 0, zIndex: 30 }}><div className="overflow-hidden bg-white shadow-xl" style={{ width: '80px', height: '80px', border: `4px solid ${data.avatar.borderColor}`, borderRadius: data.avatar.cornerRadius.includes('px') ? data.avatar.cornerRadius : '12px' }}><img src={data.avatar.url} className="w-full h-full object-cover" /></div></div>}
                            <div className="flex flex-col gap-3 p-[10px] pt-0">
                                {data.footer.longBtns.map((btn, i) => <div key={i} className="py-2.5 text-center rounded-md border font-bold text-[14px]" style={{ borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : 'transparent', color: btn.textColor }}>{btn.label}</div>)}
                                {data.footer.showShortBtns && (
                                    <div className="flex gap-2">{data.footer.shortBtns.map((btn, i) => <div key={i} className="flex-1 py-2 flex flex-col items-center gap-1 rounded-sm border shadow-sm" style={{ borderColor: btn.themeColor, backgroundColor: btn.isSolid ? btn.themeColor : 'transparent' }}><img src={SOCIAL_DATA[btn.type]?.url} className="w-4 h-4 object-contain" /><span className="text-[10px]" style={{ color: btn.textColor }}>{btn.label}</span></div>)}</div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex h-screen bg-slate-100 text-slate-900 overflow-hidden">
                    {/* 左側 Sidebar */}
                    <div className="w-1/2 bg-white border-r border-slate-300 flex flex-col shadow-xl z-10">
                        <div className="p-6 bg-white border-b border-slate-300 flex items-center justify-between shrink-0 shadow-sm">
                            <div className="flex items-center gap-3">
                                <div className="bg-[#00b900] p-2 rounded-lg text-white"><i data-lucide="layout-grid" className="w-6 h-6"></i></div>
                                <h1 className="font-bold text-xl text-slate-800 uppercase tracking-tighter">個人名片編輯器</h1>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">
                            {/* 1. 媒體層設定 */}
                            <div className="border-2 border-[#00b900] rounded-xl bg-white overflow-hidden shadow-sm">
                                <div className="p-4 bg-[#00b900] flex items-center gap-2 font-bold text-white text-lg"><i data-lucide="monitor" className="w-5 h-5"></i> 1. 媒體層設定</div>
                                <div className="p-5 space-y-5">
                                    <div className="flex bg-slate-100 p-1.5 rounded-lg border border-slate-300">
                                        <button onClick={() => setMediaType('image')} className={`flex-1 py-2 text-sm font-bold rounded-md transition ${mediaType === 'image' ? 'bg-white shadow-sm text-[#00b900]' : 'text-slate-600'}`}>圖片</button>
                                        <button onClick={() => setMediaType('video')} className={`flex-1 py-2 text-sm font-bold rounded-md transition ${mediaType === 'video' ? 'bg-white shadow-sm text-[#00b900]' : 'text-slate-600'}`}>影片</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <select value={data.size} onChange={(e) => setData({...data, size: e.target.value})} className="w-full text-sm p-3 border rounded-lg bg-white outline-none">{BUBBLE_SIZES.map(s => <option key={s} value={s}>寬度:{s.toUpperCase()}</option>)}</select>
                                        <select value={data.media.aspectRatio} onChange={(e) => handleUpdate('media', 'aspectRatio', e.target.value)} className="w-full text-sm p-3 border rounded-lg bg-white outline-none">{ASPECT_RATIOS.map(r => <option key={r} value={r}>比例:{r}</option>)}</select>
                                    </div>
                                    {mediaType === 'image' ? (
                                        <div className="space-y-4">
                                            <input type="text" value={data.media.url} onChange={(e) => handleUpdate('media', 'url', e.target.value)} className="w-full p-3 text-sm border rounded-lg" placeholder="圖片連結..." />
                                            <input type="text" value={data.media.uri} onChange={(e) => handleUpdate('media', 'uri', e.target.value)} className="w-full p-3 text-sm border rounded-lg" placeholder="圖片點擊跳轉連結..." />
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <input type="text" value={videoConfig.url} onChange={(e) => setVideoConfig({...videoConfig, url: e.target.value})} className="w-full p-3 text-sm border rounded-lg" placeholder="影片連結 (MP4)..." />
                                            <input type="text" value={videoConfig.previewUrl} onChange={(e) => setVideoConfig({...videoConfig, previewUrl: e.target.value})} className="w-full p-3 text-sm border rounded-lg" placeholder="封面圖連結..." />
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* 2. 縮圖設定 */}
                            <div className="border-2 border-[#00b900] rounded-xl bg-white overflow-hidden shadow-sm">
                                <div className="p-4 bg-[#00b900] flex items-center justify-between font-bold text-white text-lg">
                                    <div className="flex items-center gap-2"><i data-lucide="user" className="w-5 h-5"></i> 2. 縮圖設定</div>
                                    <input type="checkbox" checked={data.avatar.show} onChange={() => handleUpdate('avatar', 'show', !data.avatar.show)} className="w-5 h-5 cursor-pointer" />
                                </div>
                                {data.avatar.show && (
                                    <div className="p-5 space-y-4">
                                        <input type="text" value={data.avatar.url} onChange={(e) => handleUpdate('avatar', 'url', e.target.value)} className="w-full p-3 text-sm border rounded-lg" placeholder="縮圖連結..." />
                                        <div className="flex gap-4">
                                            <select value={data.avatar.cornerRadius} onChange={(e) => handleUpdate('avatar', 'cornerRadius', e.target.value)} className="flex-1 p-2 border rounded-lg">{CORNER_RADIUS_OPTIONS.map(r => <option key={r} value={r}>圓角:{r}</option>)}</select>
                                            <input type="color" value={data.avatar.borderColor} onChange={(e) => handleUpdate('avatar', 'borderColor', e.target.value)} className="w-10 h-10 p-0 border-none cursor-pointer" />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* 3. 文字排版 */}
                            <div className="border-2 border-[#00b900] rounded-xl bg-white overflow-hidden shadow-sm">
                                <div className="p-4 bg-[#00b900] font-bold text-white text-lg flex items-center gap-2"><i data-lucide="type" className="w-5 h-5"></i> 3. 文字內容</div>
                                <div className="p-5 space-y-4">
                                    <input type="text" value={data.content.name} onChange={(e) => handleUpdate('content', 'name', e.target.value)} className="w-full p-3 border rounded-lg font-bold" placeholder="標題/姓名" />
                                    <textarea value={data.content.desc} onChange={(e) => handleUpdate('content', 'desc', e.target.value)} className="w-full p-3 border rounded-lg h-24" placeholder="職稱或說明內容..."></textarea>
                                </div>
                            </div>

                            {/* 4. 底部快捷按鈕 (Max 5) - 修改版 */}
                            <div className="border-2 border-[#00b900] rounded-xl bg-white overflow-hidden shadow-sm mb-12">
                                <div className="p-4 bg-[#00b900] flex items-center justify-between font-bold text-white text-lg">
                                    <div className="flex items-center gap-2"><i data-lucide="share-2" className="w-5 h-5"></i> 4. 底部快捷 ({data.footer.shortBtns.length}/5)</div>
                                    <div className="flex items-center gap-3">
                                        <button onClick={addShortBtn} disabled={!data.footer.showShortBtns || data.footer.shortBtns.length >= 5} className="bg-white/20 p-1 rounded-md text-white disabled:opacity-50"><i data-lucide="plus" className="w-4 h-4"></i></button>
                                        <input type="checkbox" checked={data.footer.showShortBtns} onChange={() => handleUpdate('footer', 'showShortBtns', !data.footer.showShortBtns)} className="w-5 h-5 cursor-pointer" />
                                    </div>
                                </div>
                                <div className={`p-5 space-y-4 ${!data.footer.showShortBtns ? 'opacity-30 pointer-events-none' : ''}`}>
                                    {data.footer.shortBtns.map((btn, idx) => (
                                        <div key={idx} className="p-4 bg-slate-50 border rounded-xl space-y-2">
                                            <div className="flex justify-between items-center">
                                                <div className="flex items-center gap-2">
                                                    <img src={SOCIAL_DATA[btn.type]?.url} className="w-5 h-5 object-contain" />
                                                    <span className="font-bold text-sm">{SOCIAL_DATA[btn.type]?.label}</span>
                                                </div>
                                                <button onClick={() => removeShortBtn(idx)} className="text-red-500 hover:text-red-700">
                                                    <i data-lucide="trash-2" className="w-4 h-4"></i>
                                                </button>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <button onClick={() => openIconSelector(idx)} className="flex items-center justify-center gap-2 p-2 border border-slate-300 rounded bg-white hover:bg-slate-50">
                                                    <i data-lucide="image" className="w-4 h-4"></i>
                                                    <span className="text-xs">選擇圖示</span>
                                                </button>
                                                <input type="text" value={btn.uri} onChange={(e) => updateShortBtn(idx, 'uri', e.target.value)} className="p-2 text-xs border rounded" placeholder="連結網址" />
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 右側 Preview */}
                    <div className="flex-1 flex flex-col overflow-hidden bg-slate-200">
                        <div className="h-[60px] bg-white border-b-2 border-slate-300 flex items-center px-10 gap-10 shrink-0">
                            <button onClick={() => setActiveTab('editor')} className={`font-bold h-full border-b-4 flex items-center gap-2 ${activeTab === 'editor' ? 'text-[#00b900] border-[#00b900]' : 'text-slate-400 border-transparent'}`}><i data-lucide="eye"></i> 預覽</button>
                            <button onClick={() => setActiveTab('json')} className={`font-bold h-full border-b-4 flex items-center gap-2 ${activeTab === 'json' ? 'text-[#00b900] border-[#00b900]' : 'text-slate-400 border-transparent'}`}><i data-lucide="code"></i> 代碼</button>
                        </div>
                        <div className="flex-1 overflow-y-auto chat-room-bg">
                            {activeTab === 'editor' ? (
                                <div className="py-4 flex flex-col items-center">
                                    <div className="my-4 px-6 py-2 bg-slate-800 text-white rounded-full text-xs font-bold shadow-xl border border-green-500">LINE Flex Preview</div>
                                    <Preview />
                                </div>
                            ) : (
                                <div className="p-10">
                                    <pre className="bg-slate-900 p-8 rounded-2xl text-green-400 text-xs overflow-x-auto leading-relaxed">{JSON.stringify(buildFinalJson(), null, 2)}</pre>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 圖示選擇器彈窗 */}
                    {showIconSelector && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-lg text-slate-800">選擇圖示</h3>
                                    <button onClick={() => setShowIconSelector(false)} className="text-slate-500 hover:text-slate-700">
                                        <i data-lucide="x" className="w-5 h-5"></i>
                                    </button>
                                </div>
                                <div className="icon-grid">
                                    {Object.keys(SOCIAL_DATA).map((key) => (
                                        <button
                                            key={key}
                                            onClick={() => selectIcon(key, SOCIAL_DATA[key].label)}
                                            className="icon-btn"
                                        >
                                            <img src={SOCIAL_DATA[key].url} alt={SOCIAL_DATA[key].label} />
                                            <span>{SOCIAL_DATA[key].label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
